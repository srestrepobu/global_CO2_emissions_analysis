<html>
<head>
<title>Entrega2.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #7a7e85;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
.ls0 { height: 1px; border-width: 0; color: #43454a; background-color:#43454a}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Entrega2.ipynb</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">#%% md 
<a name="l2"><span class="ln">2    </span></a># Relación entre Emisiones de CO2, Desarrollo Industrial y Calidad de Vida Global 
<a name="l3"><span class="ln">3    </span></a> 
<a name="l4"><span class="ln">4    </span></a>El cambio climático es uno de los desafíos más grandes que enfrenta el mundo actualmente, y uno de sus principales impulsores son las emisiones de dióxido de carbono (CO₂) generadas por la actividad humana. 
<a name="l5"><span class="ln">5    </span></a> 
<a name="l6"><span class="ln">6    </span></a>Para obtener esta información se usó la base de datos de EDGAR - The Emissions Database for Global Atmospheric Research, del cual se descargó los datos de emisiones de CO2 desde el años 1970 hasta el 2024. 
<a name="l7"><span class="ln">7    </span></a>Además se usaron los datos de Life expectancy at birth vs. CO₂ emissions per capita, 2014 to 2023. 
<a name="l8"><span class="ln">8    </span></a> 
<a name="l9"><span class="ln">9    </span></a>Lo primero que hicimos fue organizar nuestros datos ya que alguno venias en formatos diferentes, para esto usamos el editor de texto. 
<a name="l10"><span class="ln">10   </span></a>![image.png](attachment:9f2d19b0-a163-448d-9dce-9cb2fc5d220e.png) 
<a name="l11"><span class="ln">11   </span></a> 
<a name="l12"><span class="ln">12   </span></a> <hr class="ls0"><a name="l13"><span class="ln">13   </span></a>#%% md 
<a name="l14"><span class="ln">14   </span></a>Para la obtención de las graficas se siguieron diferentes tutoriales, entre ellos una pagina que se llama Python Graph Gallery, en esta se suben graficas muy lindas de gente con mas experiencia en los cuales no solo suben el código, sino que con una buena documentación explican cómo se hace. 
<a name="l15"><span class="ln">15   </span></a>Además, ellos nos presentan diferentes CheatSheet que sirven para facilitar la vida, las cuales se adjuntaran a la entrega. 
<a name="l16"><span class="ln">16   </span></a> 
<a name="l17"><span class="ln">17   </span></a>Este gráfico ofrece una visión clara de cómo las emisiones han evolucionado desde 1970 hasta 2024. Al observar esta tendencia a largo plazo, podemos entender el impacto de las decisiones políticas, la expansión de las economías emergentes y los avances tecnológicos en las emisiones globales de CO₂. Es fundamental reconocer estas tendencias para poder implementar estrategias efectivas de mitigación y adaptación al cambio climático. 
<a name="l18"><span class="ln">18   </span></a> <hr class="ls0"><a name="l19"><span class="ln">19   </span></a>#%% 
<a name="l20"><span class="ln">20   </span></a></span><span class="s1"># -------------------------------------------------------------</span>
<a name="l21"><span class="ln">21   </span></a><span class="s1"># IMPORT LIBRARIES</span>
<a name="l22"><span class="ln">22   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l23"><span class="ln">23   </span></a><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd                    </span><span class="s1"># Data manipulation and analysis</span>
<a name="l24"><span class="ln">24   </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt         </span><span class="s1"># Plotting library</span>
<a name="l25"><span class="ln">25   </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">animation </span><span class="s2">as </span><span class="s0">animation </span><span class="s1"># For creating animations</span>
<a name="l26"><span class="ln">26   </span></a><span class="s2">from </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">animation </span><span class="s2">import </span><span class="s0">FuncAnimation </span><span class="s1"># Main function for frame-by-frame animation</span>
<a name="l27"><span class="ln">27   </span></a><span class="s2">import </span><span class="s0">numpy </span><span class="s2">as </span><span class="s0">np                      </span><span class="s1"># Numerical operations</span>
<a name="l28"><span class="ln">28   </span></a><span class="s2">from </span><span class="s0">IPython</span><span class="s3">.</span><span class="s0">display </span><span class="s2">import </span><span class="s0">Image</span>
<a name="l29"><span class="ln">29   </span></a>
<a name="l30"><span class="ln">30   </span></a>
<a name="l31"><span class="ln">31   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l32"><span class="ln">32   </span></a><span class="s1"># LOAD AND PREPARE DATA</span>
<a name="l33"><span class="ln">33   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l34"><span class="ln">34   </span></a>
<a name="l35"><span class="ln">35   </span></a><span class="s1"># Load Excel file (adjust path if necessary)</span>
<a name="l36"><span class="ln">36   </span></a><span class="s0">archivo </span><span class="s3">= </span><span class="s4">'../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx'</span>
<a name="l37"><span class="ln">37   </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">archivo</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'fossil_CO2_totals_by_country'</span><span class="s3">)</span>
<a name="l38"><span class="ln">38   </span></a>
<a name="l39"><span class="ln">39   </span></a><span class="s1"># Select the global total CO₂ emissions row</span>
<a name="l40"><span class="ln">40   </span></a><span class="s1"># Note: row 215 in Excel corresponds to index 213 in pandas (0-based indexing)</span>
<a name="l41"><span class="ln">41   </span></a><span class="s0">fila_co2_global </span><span class="s3">= </span><span class="s0">df</span><span class="s3">.</span><span class="s0">iloc</span><span class="s3">[</span><span class="s5">213</span><span class="s3">]</span>
<a name="l42"><span class="ln">42   </span></a>
<a name="l43"><span class="ln">43   </span></a><span class="s1"># Identify year columns (numeric or string digits)</span>
<a name="l44"><span class="ln">44   </span></a><span class="s0">columnas_años </span><span class="s3">= [</span><span class="s0">col </span><span class="s2">for </span><span class="s0">col </span><span class="s2">in </span><span class="s0">df</span><span class="s3">.</span><span class="s0">columns </span><span class="s2">if </span><span class="s0">isinstance</span><span class="s3">(</span><span class="s0">col</span><span class="s3">, (</span><span class="s0">int</span><span class="s3">, </span><span class="s0">float</span><span class="s3">)) </span><span class="s2">or </span><span class="s3">(</span><span class="s0">isinstance</span><span class="s3">(</span><span class="s0">col</span><span class="s3">, </span><span class="s0">str</span><span class="s3">) </span><span class="s2">and </span><span class="s0">col</span><span class="s3">.</span><span class="s0">isdigit</span><span class="s3">())]</span>
<a name="l45"><span class="ln">45   </span></a>
<a name="l46"><span class="ln">46   </span></a><span class="s1"># Extract year and CO₂ emission values</span>
<a name="l47"><span class="ln">47   </span></a><span class="s0">años </span><span class="s3">= [</span><span class="s0">int</span><span class="s3">(</span><span class="s0">col</span><span class="s3">) </span><span class="s2">for </span><span class="s0">col </span><span class="s2">in </span><span class="s0">columnas_años</span><span class="s3">]</span>
<a name="l48"><span class="ln">48   </span></a><span class="s0">valores_co2 </span><span class="s3">= [</span><span class="s0">fila_co2_global</span><span class="s3">[</span><span class="s0">col</span><span class="s3">] </span><span class="s2">for </span><span class="s0">col </span><span class="s2">in </span><span class="s0">columnas_años</span><span class="s3">]</span>
<a name="l49"><span class="ln">49   </span></a>
<a name="l50"><span class="ln">50   </span></a><span class="s1"># Create a clean DataFrame for animation</span>
<a name="l51"><span class="ln">51   </span></a><span class="s0">df_animation </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">DataFrame</span><span class="s3">({</span>
<a name="l52"><span class="ln">52   </span></a>    <span class="s4">'Año'</span><span class="s3">: </span><span class="s0">años</span><span class="s3">,</span>
<a name="l53"><span class="ln">53   </span></a>    <span class="s4">'CO2'</span><span class="s3">: </span><span class="s0">valores_co2</span>
<a name="l54"><span class="ln">54   </span></a><span class="s3">})</span>
<a name="l55"><span class="ln">55   </span></a>
<a name="l56"><span class="ln">56   </span></a><span class="s1"># Sort by year to ensure chronological order</span>
<a name="l57"><span class="ln">57   </span></a><span class="s0">df_animation </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">.</span><span class="s0">sort_values</span><span class="s3">(</span><span class="s4">'Año'</span><span class="s3">).</span><span class="s0">reset_index</span><span class="s3">(</span><span class="s0">drop</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l58"><span class="ln">58   </span></a>
<a name="l59"><span class="ln">59   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l60"><span class="ln">60   </span></a><span class="s1"># DEFINE HISTORICAL EVENTS</span>
<a name="l61"><span class="ln">61   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l62"><span class="ln">62   </span></a><span class="s1"># Each event includes its year range and label to be displayed during animation</span>
<a name="l63"><span class="ln">63   </span></a><span class="s0">events </span><span class="s3">= [</span>
<a name="l64"><span class="ln">64   </span></a>    <span class="s3">{</span><span class="s4">'year'</span><span class="s3">: </span><span class="s5">1945</span><span class="s3">, </span><span class="s4">'year_start'</span><span class="s3">: </span><span class="s5">1945</span><span class="s3">, </span><span class="s4">'year_end'</span><span class="s3">: </span><span class="s5">1960</span><span class="s3">, </span><span class="s4">'text'</span><span class="s3">: </span><span class="s4">'End of World War II'</span><span class="s3">},</span>
<a name="l65"><span class="ln">65   </span></a>    <span class="s3">{</span><span class="s4">'year'</span><span class="s3">: </span><span class="s5">1973</span><span class="s3">, </span><span class="s4">'year_start'</span><span class="s3">: </span><span class="s5">1973</span><span class="s3">, </span><span class="s4">'year_end'</span><span class="s3">: </span><span class="s5">1985</span><span class="s3">, </span><span class="s4">'text'</span><span class="s3">: </span><span class="s4">'Oil Crisis'</span><span class="s3">},</span>
<a name="l66"><span class="ln">66   </span></a>    <span class="s3">{</span><span class="s4">'year'</span><span class="s3">: </span><span class="s5">1991</span><span class="s3">, </span><span class="s4">'year_start'</span><span class="s3">: </span><span class="s5">1991</span><span class="s3">, </span><span class="s4">'year_end'</span><span class="s3">: </span><span class="s5">2003</span><span class="s3">, </span><span class="s4">'text'</span><span class="s3">: </span><span class="s4">'End of Cold War'</span><span class="s3">},</span>
<a name="l67"><span class="ln">67   </span></a>    <span class="s3">{</span><span class="s4">'year'</span><span class="s3">: </span><span class="s5">1997</span><span class="s3">, </span><span class="s4">'year_start'</span><span class="s3">: </span><span class="s5">1997</span><span class="s3">, </span><span class="s4">'year_end'</span><span class="s3">: </span><span class="s5">2009</span><span class="s3">, </span><span class="s4">'text'</span><span class="s3">: </span><span class="s4">'Kyoto Protocol'</span><span class="s3">},</span>
<a name="l68"><span class="ln">68   </span></a>    <span class="s3">{</span><span class="s4">'year'</span><span class="s3">: </span><span class="s5">2001</span><span class="s3">, </span><span class="s4">'year_start'</span><span class="s3">: </span><span class="s5">2001</span><span class="s3">, </span><span class="s4">'year_end'</span><span class="s3">: </span><span class="s5">2013</span><span class="s3">, </span><span class="s4">'text'</span><span class="s3">: </span><span class="s4">'China joins the WTO'</span><span class="s3">},</span>
<a name="l69"><span class="ln">69   </span></a>    <span class="s3">{</span><span class="s4">'year'</span><span class="s3">: </span><span class="s5">2015</span><span class="s3">, </span><span class="s4">'year_start'</span><span class="s3">: </span><span class="s5">2015</span><span class="s3">, </span><span class="s4">'year_end'</span><span class="s3">: </span><span class="s5">2030</span><span class="s3">, </span><span class="s4">'text'</span><span class="s3">: </span><span class="s4">'Paris Agreement'</span><span class="s3">},</span>
<a name="l70"><span class="ln">70   </span></a><span class="s3">]</span>
<a name="l71"><span class="ln">71   </span></a>
<a name="l72"><span class="ln">72   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l73"><span class="ln">73   </span></a><span class="s1"># FIGURE AND STYLE SETUP</span>
<a name="l74"><span class="ln">74   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l75"><span class="ln">75   </span></a>
<a name="l76"><span class="ln">76   </span></a><span class="s0">fig</span><span class="s3">, </span><span class="s0">ax </span><span class="s3">= </span><span class="s0">plt</span><span class="s3">.</span><span class="s0">subplots</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">14</span><span class="s3">, </span><span class="s5">8</span><span class="s3">))   </span><span class="s1"># Create a large figure</span>
<a name="l77"><span class="ln">77   </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">patch</span><span class="s3">.</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">'white'</span><span class="s3">)          </span><span class="s1"># Set white background for figure</span>
<a name="l78"><span class="ln">78   </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">'white'</span><span class="s3">)                 </span><span class="s1"># White background for plot area</span>
<a name="l79"><span class="ln">79   </span></a>
<a name="l80"><span class="ln">80   </span></a><span class="s1"># Minimalistic design: remove top and right borders</span>
<a name="l81"><span class="ln">81   </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'top'</span><span class="s3">].</span><span class="s0">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l82"><span class="ln">82   </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'right'</span><span class="s3">].</span><span class="s0">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l83"><span class="ln">83   </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'left'</span><span class="s3">].</span><span class="s0">set_color</span><span class="s3">(</span><span class="s4">'#333333'</span><span class="s3">)</span>
<a name="l84"><span class="ln">84   </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'bottom'</span><span class="s3">].</span><span class="s0">set_color</span><span class="s3">(</span><span class="s4">'#333333'</span><span class="s3">)</span>
<a name="l85"><span class="ln">85   </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">tick_params</span><span class="s3">(</span><span class="s0">colors</span><span class="s3">=</span><span class="s4">'#333333'</span><span class="s3">, </span><span class="s0">which</span><span class="s3">=</span><span class="s4">'both'</span><span class="s3">, </span><span class="s0">labelsize</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
<a name="l86"><span class="ln">86   </span></a>
<a name="l87"><span class="ln">87   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l88"><span class="ln">88   </span></a><span class="s1"># INITIAL PLOT ELEMENTS (updated frame-by-frame)</span>
<a name="l89"><span class="ln">89   </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l90"><span class="ln">90   </span></a>
<a name="l91"><span class="ln">91   </span></a><span class="s0">line</span><span class="s3">, = </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">plot</span><span class="s3">([], [], </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#69b3a2'</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">)  </span><span class="s1"># Main CO₂ line</span>
<a name="l92"><span class="ln">92   </span></a><span class="s0">end_point</span><span class="s3">, = </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">plot</span><span class="s3">([], [], </span><span class="s4">'o'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#69b3a2'</span><span class="s3">, </span><span class="s0">markersize</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)  </span><span class="s1"># Moving endpoint</span>
<a name="l93"><span class="ln">93   </span></a>
<a name="l94"><span class="ln">94   </span></a><span class="s1"># Vertical line and text for historical events</span>
<a name="l95"><span class="ln">95   </span></a><span class="s0">event_vline </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">axvline</span><span class="s3">(</span><span class="s0">x</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#e74c3c'</span><span class="s3">, </span><span class="s0">linestyle</span><span class="s3">=</span><span class="s4">'--'</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
<a name="l96"><span class="ln">96   </span></a><span class="s0">event_text </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.94</span><span class="s3">, </span><span class="s4">''</span><span class="s3">, </span><span class="s0">transform</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">.</span><span class="s0">transAxes</span><span class="s3">,</span>
<a name="l97"><span class="ln">97   </span></a>                     <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">22</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#e74c3c'</span><span class="s3">,</span>
<a name="l98"><span class="ln">98   </span></a>                     <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">'top'</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0</span><span class="s3">,</span>
<a name="l99"><span class="ln">99   </span></a>                     <span class="s0">bbox</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span><span class="s0">boxstyle</span><span class="s3">=</span><span class="s4">'round,pad=0.8'</span><span class="s3">, </span><span class="s0">facecolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">,</span>
<a name="l100"><span class="ln">100  </span></a>                               <span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'#e74c3c'</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0</span><span class="s3">))</span>
<a name="l101"><span class="ln">101  </span></a><span class="s0">event_year_text </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.85</span><span class="s3">, </span><span class="s4">''</span><span class="s3">, </span><span class="s0">transform</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">.</span><span class="s0">transAxes</span><span class="s3">,</span>
<a name="l102"><span class="ln">102  </span></a>                          <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#555555'</span><span class="s3">,</span>
<a name="l103"><span class="ln">103  </span></a>                          <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">'top'</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
<a name="l104"><span class="ln">104  </span></a>
<a name="l105"><span class="ln">105  </span></a><span class="s1"># Text showing the current CO₂ value at the end of the line</span>
<a name="l106"><span class="ln">106  </span></a><span class="s0">value_text </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s4">''</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">,</span>
<a name="l107"><span class="ln">107  </span></a>                     <span class="s0">color</span><span class="s3">=</span><span class="s4">'#333333'</span><span class="s3">, </span><span class="s0">ha</span><span class="s3">=</span><span class="s4">'left'</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">'bottom'</span><span class="s3">,</span>
<a name="l108"><span class="ln">108  </span></a>                     <span class="s0">bbox</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span><span class="s0">boxstyle</span><span class="s3">=</span><span class="s4">'round,pad=0.5'</span><span class="s3">, </span><span class="s0">facecolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">,</span>
<a name="l109"><span class="ln">109  </span></a>                               <span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'#69b3a2'</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.5</span><span class="s3">))</span>
<a name="l110"><span class="ln">110  </span></a>
<a name="l111"><span class="ln">111  </span></a><span class="s1"># Large year label displayed in the corner</span>
<a name="l112"><span class="ln">112  </span></a><span class="s0">current_year_text </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s5">0.02</span><span class="s3">, </span><span class="s5">0.95</span><span class="s3">, </span><span class="s4">''</span><span class="s3">, </span><span class="s0">transform</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">.</span><span class="s0">transAxes</span><span class="s3">,</span>
<a name="l113"><span class="ln">113  </span></a>                            <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">32</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#aaaaaa'</span><span class="s3">,</span>
<a name="l114"><span class="ln">114  </span></a>                            <span class="s0">ha</span><span class="s3">=</span><span class="s4">'left'</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">'top'</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">)</span>
<a name="l115"><span class="ln">115  </span></a>
<a name="l116"><span class="ln">116  </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l117"><span class="ln">117  </span></a><span class="s1"># AXES AND STYLE CONFIGURATION</span>
<a name="l118"><span class="ln">118  </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l119"><span class="ln">119  </span></a>
<a name="l120"><span class="ln">120  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xlim</span><span class="s3">(</span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'Año'</span><span class="s3">].</span><span class="s0">min</span><span class="s3">(), </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'Año'</span><span class="s3">].</span><span class="s0">max</span><span class="s3">())</span>
<a name="l121"><span class="ln">121  </span></a><span class="s0">y_min </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'CO2'</span><span class="s3">].</span><span class="s0">min</span><span class="s3">()</span>
<a name="l122"><span class="ln">122  </span></a><span class="s0">y_max </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'CO2'</span><span class="s3">].</span><span class="s0">max</span><span class="s3">()</span>
<a name="l123"><span class="ln">123  </span></a><span class="s0">y_range </span><span class="s3">= </span><span class="s0">y_max </span><span class="s3">- </span><span class="s0">y_min</span>
<a name="l124"><span class="ln">124  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_ylim</span><span class="s3">(</span><span class="s0">y_min </span><span class="s3">- </span><span class="s0">y_range </span><span class="s3">* </span><span class="s5">0.05</span><span class="s3">, </span><span class="s0">y_max </span><span class="s3">+ </span><span class="s0">y_range </span><span class="s3">* </span><span class="s5">0.15</span><span class="s3">)</span>
<a name="l125"><span class="ln">125  </span></a>
<a name="l126"><span class="ln">126  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xlabel</span><span class="s3">(</span><span class="s4">'Year'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">13</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#333333'</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">)</span>
<a name="l127"><span class="ln">127  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_ylabel</span><span class="s3">(</span><span class="s4">'Global CO$_2$ Emissions (million tonnes)'</span><span class="s3">,</span>
<a name="l128"><span class="ln">128  </span></a>              <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">13</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#333333'</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">)</span>
<a name="l129"><span class="ln">129  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_title</span><span class="s3">(</span><span class="s4">'Global CO$_2$ Emission Trends Over Time'</span><span class="s3">,</span>
<a name="l130"><span class="ln">130  </span></a>             <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">18</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#333333'</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">pad</span><span class="s3">=</span><span class="s5">20</span><span class="s3">)</span>
<a name="l131"><span class="ln">131  </span></a>
<a name="l132"><span class="ln">132  </span></a><span class="s1"># Add a subtle grid</span>
<a name="l133"><span class="ln">133  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">grid</span><span class="s3">(</span><span class="s2">True</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0.3</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#cccccc'</span><span class="s3">, </span><span class="s0">linestyle</span><span class="s3">=</span><span class="s4">'-'</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">)</span>
<a name="l134"><span class="ln">134  </span></a>
<a name="l135"><span class="ln">135  </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l136"><span class="ln">136  </span></a><span class="s1"># ANIMATION FUNCTIONS</span>
<a name="l137"><span class="ln">137  </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l138"><span class="ln">138  </span></a>
<a name="l139"><span class="ln">139  </span></a><span class="s2">def </span><span class="s0">init</span><span class="s3">():</span>
<a name="l140"><span class="ln">140  </span></a>    <span class="s6">&quot;&quot;&quot;Initialize the animation with empty elements.&quot;&quot;&quot;</span>
<a name="l141"><span class="ln">141  </span></a>    <span class="s0">line</span><span class="s3">.</span><span class="s0">set_data</span><span class="s3">([], [])</span>
<a name="l142"><span class="ln">142  </span></a>    <span class="s0">end_point</span><span class="s3">.</span><span class="s0">set_data</span><span class="s3">([], [])</span>
<a name="l143"><span class="ln">143  </span></a>    <span class="s0">event_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">''</span><span class="s3">)</span>
<a name="l144"><span class="ln">144  </span></a>    <span class="s0">event_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l145"><span class="ln">145  </span></a>    <span class="s0">event_year_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">''</span><span class="s3">)</span>
<a name="l146"><span class="ln">146  </span></a>    <span class="s0">event_year_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l147"><span class="ln">147  </span></a>    <span class="s0">value_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">''</span><span class="s3">)</span>
<a name="l148"><span class="ln">148  </span></a>    <span class="s0">value_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l149"><span class="ln">149  </span></a>    <span class="s0">current_year_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">''</span><span class="s3">)</span>
<a name="l150"><span class="ln">150  </span></a>    <span class="s0">event_vline</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l151"><span class="ln">151  </span></a>    <span class="s0">event_text</span><span class="s3">.</span><span class="s0">get_bbox_patch</span><span class="s3">().</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l152"><span class="ln">152  </span></a>    <span class="s2">return </span><span class="s0">line</span><span class="s3">, </span><span class="s0">end_point</span><span class="s3">, </span><span class="s0">event_text</span><span class="s3">, </span><span class="s0">event_year_text</span><span class="s3">, </span><span class="s0">value_text</span><span class="s3">, </span><span class="s0">current_year_text</span><span class="s3">, </span><span class="s0">event_vline</span>
<a name="l153"><span class="ln">153  </span></a>
<a name="l154"><span class="ln">154  </span></a>
<a name="l155"><span class="ln">155  </span></a><span class="s2">def </span><span class="s0">animate</span><span class="s3">(</span><span class="s0">frame</span><span class="s3">):</span>
<a name="l156"><span class="ln">156  </span></a>    <span class="s6">&quot;&quot;&quot;Update all graphical elements for each animation frame.&quot;&quot;&quot;</span>
<a name="l157"><span class="ln">157  </span></a>    <span class="s1"># Progressive line update</span>
<a name="l158"><span class="ln">158  </span></a>    <span class="s0">x_data </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'Año'</span><span class="s3">][:</span><span class="s0">frame </span><span class="s3">+ </span><span class="s5">1</span><span class="s3">]</span>
<a name="l159"><span class="ln">159  </span></a>    <span class="s0">y_data </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'CO2'</span><span class="s3">][:</span><span class="s0">frame </span><span class="s3">+ </span><span class="s5">1</span><span class="s3">]</span>
<a name="l160"><span class="ln">160  </span></a>    <span class="s0">line</span><span class="s3">.</span><span class="s0">set_data</span><span class="s3">(</span><span class="s0">x_data</span><span class="s3">, </span><span class="s0">y_data</span><span class="s3">)</span>
<a name="l161"><span class="ln">161  </span></a>
<a name="l162"><span class="ln">162  </span></a>    <span class="s2">if </span><span class="s0">frame </span><span class="s3">&lt; </span><span class="s0">len</span><span class="s3">(</span><span class="s0">df_animation</span><span class="s3">):</span>
<a name="l163"><span class="ln">163  </span></a>        <span class="s0">current_year </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'Año'</span><span class="s3">].</span><span class="s0">iloc</span><span class="s3">[</span><span class="s0">frame</span><span class="s3">]</span>
<a name="l164"><span class="ln">164  </span></a>        <span class="s0">current_value </span><span class="s3">= </span><span class="s0">df_animation</span><span class="s3">[</span><span class="s4">'CO2'</span><span class="s3">].</span><span class="s0">iloc</span><span class="s3">[</span><span class="s0">frame</span><span class="s3">]</span>
<a name="l165"><span class="ln">165  </span></a>
<a name="l166"><span class="ln">166  </span></a>        <span class="s1"># Update endpoint and dynamic text values</span>
<a name="l167"><span class="ln">167  </span></a>        <span class="s0">end_point</span><span class="s3">.</span><span class="s0">set_data</span><span class="s3">([</span><span class="s0">current_year</span><span class="s3">], [</span><span class="s0">current_value</span><span class="s3">])</span>
<a name="l168"><span class="ln">168  </span></a>        <span class="s0">current_year_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">f'</span><span class="s2">{</span><span class="s0">int</span><span class="s3">(</span><span class="s0">current_year</span><span class="s3">)</span><span class="s2">}</span><span class="s4">'</span><span class="s3">)</span>
<a name="l169"><span class="ln">169  </span></a>        <span class="s0">value_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">f'</span><span class="s2">{</span><span class="s0">current_value</span><span class="s2">:</span><span class="s4">,.0f</span><span class="s2">} </span><span class="s4">Mt'</span><span class="s3">)</span>
<a name="l170"><span class="ln">170  </span></a>        <span class="s0">value_text</span><span class="s3">.</span><span class="s0">set_position</span><span class="s3">((</span><span class="s0">current_year</span><span class="s3">, </span><span class="s0">current_value</span><span class="s3">))</span>
<a name="l171"><span class="ln">171  </span></a>        <span class="s0">value_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">1</span><span class="s3">)</span>
<a name="l172"><span class="ln">172  </span></a>
<a name="l173"><span class="ln">173  </span></a>        <span class="s1"># Check if a historical event should appear</span>
<a name="l174"><span class="ln">174  </span></a>        <span class="s0">event_to_show </span><span class="s3">= </span><span class="s2">None</span>
<a name="l175"><span class="ln">175  </span></a>        <span class="s2">for </span><span class="s0">event </span><span class="s2">in </span><span class="s0">events</span><span class="s3">:</span>
<a name="l176"><span class="ln">176  </span></a>            <span class="s2">if </span><span class="s0">event</span><span class="s3">[</span><span class="s4">'year_start'</span><span class="s3">] &lt;= </span><span class="s0">current_year </span><span class="s3">&lt;= </span><span class="s0">event</span><span class="s3">[</span><span class="s4">'year_end'</span><span class="s3">]:</span>
<a name="l177"><span class="ln">177  </span></a>                <span class="s0">event_to_show </span><span class="s3">= </span><span class="s0">event</span>
<a name="l178"><span class="ln">178  </span></a>                <span class="s2">break</span>
<a name="l179"><span class="ln">179  </span></a>
<a name="l180"><span class="ln">180  </span></a>        <span class="s1"># Display event text with smooth fade in/out</span>
<a name="l181"><span class="ln">181  </span></a>        <span class="s2">if </span><span class="s0">event_to_show</span><span class="s3">:</span>
<a name="l182"><span class="ln">182  </span></a>            <span class="s0">event_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'text'</span><span class="s3">])</span>
<a name="l183"><span class="ln">183  </span></a>            <span class="s0">event_year_text</span><span class="s3">.</span><span class="s0">set_text</span><span class="s3">(</span><span class="s4">f&quot;Year </span><span class="s2">{</span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year'</span><span class="s3">]</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l184"><span class="ln">184  </span></a>
<a name="l185"><span class="ln">185  </span></a>            <span class="s1"># Calculate transparency (alpha) for fade effect</span>
<a name="l186"><span class="ln">186  </span></a>            <span class="s0">year_in_range </span><span class="s3">= </span><span class="s0">current_year </span><span class="s3">- </span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year_start'</span><span class="s3">]</span>
<a name="l187"><span class="ln">187  </span></a>            <span class="s0">year_range </span><span class="s3">= </span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year_end'</span><span class="s3">] - </span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year_start'</span><span class="s3">]</span>
<a name="l188"><span class="ln">188  </span></a>
<a name="l189"><span class="ln">189  </span></a>            <span class="s2">if </span><span class="s0">year_in_range </span><span class="s3">&lt; </span><span class="s5">5</span><span class="s3">:  </span><span class="s1"># Fade in (first 5 years)</span>
<a name="l190"><span class="ln">190  </span></a>                <span class="s0">alpha </span><span class="s3">= </span><span class="s0">year_in_range </span><span class="s3">/ </span><span class="s5">5</span>
<a name="l191"><span class="ln">191  </span></a>            <span class="s2">elif </span><span class="s0">year_in_range </span><span class="s3">&gt; </span><span class="s0">year_range </span><span class="s3">- </span><span class="s5">5</span><span class="s3">:  </span><span class="s1"># Fade out (last 5 years)</span>
<a name="l192"><span class="ln">192  </span></a>                <span class="s0">alpha </span><span class="s3">= (</span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year_end'</span><span class="s3">] - </span><span class="s0">current_year</span><span class="s3">) / </span><span class="s5">5</span>
<a name="l193"><span class="ln">193  </span></a>            <span class="s2">else</span><span class="s3">:</span>
<a name="l194"><span class="ln">194  </span></a>                <span class="s0">alpha </span><span class="s3">= </span><span class="s5">1.0  </span><span class="s1"># Fully visible</span>
<a name="l195"><span class="ln">195  </span></a>
<a name="l196"><span class="ln">196  </span></a>            <span class="s1"># Apply transparency to text and vertical line</span>
<a name="l197"><span class="ln">197  </span></a>            <span class="s0">alpha </span><span class="s3">= </span><span class="s0">min</span><span class="s3">(</span><span class="s5">1.0</span><span class="s3">, </span><span class="s0">max</span><span class="s3">(</span><span class="s5">0.0</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">))</span>
<a name="l198"><span class="ln">198  </span></a>            <span class="s0">event_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s0">alpha</span><span class="s3">)</span>
<a name="l199"><span class="ln">199  </span></a>            <span class="s0">event_year_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s0">alpha</span><span class="s3">)</span>
<a name="l200"><span class="ln">200  </span></a>            <span class="s0">event_text</span><span class="s3">.</span><span class="s0">get_bbox_patch</span><span class="s3">().</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s0">alpha </span><span class="s3">* </span><span class="s5">0.9</span><span class="s3">)</span>
<a name="l201"><span class="ln">201  </span></a>            <span class="s0">event_vline</span><span class="s3">.</span><span class="s0">set_xdata</span><span class="s3">([</span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year'</span><span class="s3">], </span><span class="s0">event_to_show</span><span class="s3">[</span><span class="s4">'year'</span><span class="s3">]])</span>
<a name="l202"><span class="ln">202  </span></a>            <span class="s0">event_vline</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s0">alpha </span><span class="s3">* </span><span class="s5">0.6</span><span class="s3">)</span>
<a name="l203"><span class="ln">203  </span></a>        <span class="s2">else</span><span class="s3">:</span>
<a name="l204"><span class="ln">204  </span></a>            <span class="s1"># Hide event elements when not active</span>
<a name="l205"><span class="ln">205  </span></a>            <span class="s0">event_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l206"><span class="ln">206  </span></a>            <span class="s0">event_year_text</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l207"><span class="ln">207  </span></a>            <span class="s0">event_text</span><span class="s3">.</span><span class="s0">get_bbox_patch</span><span class="s3">().</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l208"><span class="ln">208  </span></a>            <span class="s0">event_vline</span><span class="s3">.</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l209"><span class="ln">209  </span></a>
<a name="l210"><span class="ln">210  </span></a>    <span class="s2">return </span><span class="s0">line</span><span class="s3">, </span><span class="s0">end_point</span><span class="s3">, </span><span class="s0">event_text</span><span class="s3">, </span><span class="s0">event_year_text</span><span class="s3">, </span><span class="s0">value_text</span><span class="s3">, </span><span class="s0">current_year_text</span><span class="s3">, </span><span class="s0">event_vline</span>
<a name="l211"><span class="ln">211  </span></a>
<a name="l212"><span class="ln">212  </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l213"><span class="ln">213  </span></a><span class="s1"># CREATE AND SAVE ANIMATION</span>
<a name="l214"><span class="ln">214  </span></a><span class="s1"># -------------------------------------------------------------</span>
<a name="l215"><span class="ln">215  </span></a>
<a name="l216"><span class="ln">216  </span></a><span class="s0">frames </span><span class="s3">= </span><span class="s0">len</span><span class="s3">(</span><span class="s0">df_animation</span><span class="s3">)  </span><span class="s1"># Total frames (one per year)</span>
<a name="l217"><span class="ln">217  </span></a><span class="s0">anim </span><span class="s3">= </span><span class="s0">FuncAnimation</span><span class="s3">(</span><span class="s0">fig</span><span class="s3">, </span><span class="s0">animate</span><span class="s3">, </span><span class="s0">init_func</span><span class="s3">=</span><span class="s0">init</span><span class="s3">, </span><span class="s0">frames</span><span class="s3">=</span><span class="s0">frames</span><span class="s3">,</span>
<a name="l218"><span class="ln">218  </span></a>                     <span class="s0">interval</span><span class="s3">=</span><span class="s5">100</span><span class="s3">, </span><span class="s0">blit</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s0">repeat</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l219"><span class="ln">219  </span></a>
<a name="l220"><span class="ln">220  </span></a><span class="s1"># Save animation as GIF (requires 'pillow' installed)</span>
<a name="l221"><span class="ln">221  </span></a><span class="s0">anim</span><span class="s3">.</span><span class="s0">save</span><span class="s3">(</span><span class="s4">'../Graphs/co2_animation.gif'</span><span class="s3">, </span><span class="s0">writer</span><span class="s3">=</span><span class="s4">'pillow'</span><span class="s3">, </span><span class="s0">fps</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s0">dpi</span><span class="s3">=</span><span class="s5">200</span><span class="s3">)</span>
<a name="l222"><span class="ln">222  </span></a><span class="s0">Image</span><span class="s3">(</span><span class="s0">filename</span><span class="s3">=</span><span class="s4">'../Graphs/co2_animation.gif'</span><span class="s3">)</span>
<a name="l223"><span class="ln">223  </span></a>
<a name="l224"><span class="ln">224  </span></a><span class="s1"># Display final animation</span>
<a name="l225"><span class="ln">225  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">tight_layout</span><span class="s3">()</span>
<a name="l226"><span class="ln">226  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span><hr class="ls0"><a name="l227"><span class="ln">227  </span></a><span class="s0">#%% 
<a name="l228"><span class="ln">228  </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l229"><span class="ln">229  </span></a><span class="s2">import </span><span class="s0">plotly</span><span class="s3">.</span><span class="s0">express </span><span class="s2">as </span><span class="s0">px</span>
<a name="l230"><span class="ln">230  </span></a>
<a name="l231"><span class="ln">231  </span></a><span class="s1"># === Load and preprocess data ===</span>
<a name="l232"><span class="ln">232  </span></a>
<a name="l233"><span class="ln">233  </span></a><span class="s1"># Path to the Excel file containing CO₂ emission data</span>
<a name="l234"><span class="ln">234  </span></a><span class="s0">archivo </span><span class="s3">= </span><span class="s4">'../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx'</span>
<a name="l235"><span class="ln">235  </span></a>
<a name="l236"><span class="ln">236  </span></a><span class="s1"># Read the sheet containing fossil CO₂ totals by country</span>
<a name="l237"><span class="ln">237  </span></a><span class="s1"># Requires the 'openpyxl' library to read .xlsx files.</span>
<a name="l238"><span class="ln">238  </span></a><span class="s1"># If you get the error:</span>
<a name="l239"><span class="ln">239  </span></a><span class="s1">#   ImportError: Missing optional dependency 'openpyxl'</span>
<a name="l240"><span class="ln">240  </span></a><span class="s1"># fix it by running: pip install openpyxl</span>
<a name="l241"><span class="ln">241  </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">archivo</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'fossil_CO2_totals_by_country'</span><span class="s3">)</span>
<a name="l242"><span class="ln">242  </span></a>
<a name="l243"><span class="ln">243  </span></a><span class="s1"># === Filter out non-country entries ===</span>
<a name="l244"><span class="ln">244  </span></a><span class="s1"># Exclude global and regional aggregates that could distort the results.</span>
<a name="l245"><span class="ln">245  </span></a><span class="s0">exclusions </span><span class="s3">= [</span><span class="s4">'GLOBAL TOTAL'</span><span class="s3">, </span><span class="s4">'EU27'</span><span class="s3">, </span><span class="s4">'INTERNATIONAL SHIPPING'</span><span class="s3">, </span><span class="s4">'INTERNATIONAL AVIATION'</span><span class="s3">]</span>
<a name="l246"><span class="ln">246  </span></a><span class="s0">mask </span><span class="s3">= ~</span><span class="s0">df</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">].</span><span class="s0">str</span><span class="s3">.</span><span class="s0">upper</span><span class="s3">().</span><span class="s0">isin</span><span class="s3">(</span><span class="s0">exclusions</span><span class="s3">)</span>
<a name="l247"><span class="ln">247  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df</span><span class="s3">[</span><span class="s0">mask</span><span class="s3">].</span><span class="s0">copy</span><span class="s3">()</span>
<a name="l248"><span class="ln">248  </span></a>
<a name="l249"><span class="ln">249  </span></a><span class="s1"># === Extract CO₂ emissions for the year 2024 ===</span>
<a name="l250"><span class="ln">250  </span></a><span class="s1"># Some datasets may store column names as strings (&quot;2024&quot;) or integers (2024).</span>
<a name="l251"><span class="ln">251  </span></a><span class="s0">year_col </span><span class="s3">= </span><span class="s5">2024 </span><span class="s2">if </span><span class="s5">2024 </span><span class="s2">in </span><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">columns </span><span class="s2">else </span><span class="s4">'2024'</span>
<a name="l252"><span class="ln">252  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[[</span><span class="s4">'Country'</span><span class="s3">, </span><span class="s0">year_col</span><span class="s3">]].</span><span class="s0">copy</span><span class="s3">()</span>
<a name="l253"><span class="ln">253  </span></a><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">columns </span><span class="s3">= [</span><span class="s4">'Country'</span><span class="s3">, </span><span class="s4">'CO2_2024'</span><span class="s3">]</span>
<a name="l254"><span class="ln">254  </span></a>
<a name="l255"><span class="ln">255  </span></a><span class="s1"># Keep only positive emission values</span>
<a name="l256"><span class="ln">256  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">] &gt; </span><span class="s5">0</span><span class="s3">].</span><span class="s0">dropna</span><span class="s3">()</span>
<a name="l257"><span class="ln">257  </span></a>
<a name="l258"><span class="ln">258  </span></a><span class="s1"># === Map countries to continents ===</span>
<a name="l259"><span class="ln">259  </span></a><span class="s1"># This dictionary allows grouping countries by continent for visualization.</span>
<a name="l260"><span class="ln">260  </span></a><span class="s0">continent_map </span><span class="s3">= {</span>
<a name="l261"><span class="ln">261  </span></a>    <span class="s1"># North America</span>
<a name="l262"><span class="ln">262  </span></a>    <span class="s4">'USA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'UNITED STATES'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'UNITED STATES OF AMERICA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l263"><span class="ln">263  </span></a>    <span class="s4">'CANADA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'MEXICO'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l264"><span class="ln">264  </span></a>    <span class="s4">'GUATEMALA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'HONDURAS'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'EL SALVADOR'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l265"><span class="ln">265  </span></a>    <span class="s4">'NICARAGUA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'COSTA RICA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'PANAMA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l266"><span class="ln">266  </span></a>    <span class="s4">'CUBA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'JAMAICA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'HAITI'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l267"><span class="ln">267  </span></a>    <span class="s4">'DOMINICAN REPUBLIC'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'TRINIDAD AND TOBAGO'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l268"><span class="ln">268  </span></a>
<a name="l269"><span class="ln">269  </span></a>    <span class="s1"># South America</span>
<a name="l270"><span class="ln">270  </span></a>    <span class="s4">'BRAZIL'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'ARGENTINA'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'CHILE'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l271"><span class="ln">271  </span></a>    <span class="s4">'COLOMBIA'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'VENEZUELA'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l272"><span class="ln">272  </span></a>    <span class="s4">'VENEZUELA (BOLIVARIAN REPUBLIC OF)'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l273"><span class="ln">273  </span></a>    <span class="s4">'PERU'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'ECUADOR'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'BOLIVIA'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l274"><span class="ln">274  </span></a>    <span class="s4">'BOLIVIA (PLURINATIONAL STATE OF)'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l275"><span class="ln">275  </span></a>    <span class="s4">'PARAGUAY'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'URUGUAY'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'SURINAME'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l276"><span class="ln">276  </span></a>    <span class="s4">'GUYANA'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l277"><span class="ln">277  </span></a>
<a name="l278"><span class="ln">278  </span></a>    <span class="s1"># Europe</span>
<a name="l279"><span class="ln">279  </span></a>    <span class="s4">'GERMANY'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'UNITED KINGDOM'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'FRANCE'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'ITALY'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l280"><span class="ln">280  </span></a>    <span class="s4">'SPAIN'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'POLAND'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'NETHERLANDS'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'BELGIUM'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l281"><span class="ln">281  </span></a>    <span class="s4">'GREECE'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'PORTUGAL'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'AUSTRIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'SWEDEN'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l282"><span class="ln">282  </span></a>    <span class="s4">'FINLAND'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'DENMARK'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'NORWAY'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'IRELAND'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l283"><span class="ln">283  </span></a>    <span class="s4">'SWITZERLAND'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'ROMANIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'CZECHIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l284"><span class="ln">284  </span></a>    <span class="s4">'CZECH REPUBLIC'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'HUNGARY'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'SLOVAKIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l285"><span class="ln">285  </span></a>    <span class="s4">'BULGARIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'CROATIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'SERBIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'SLOVENIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l286"><span class="ln">286  </span></a>    <span class="s4">'LITHUANIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'LATVIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'ESTONIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'ICELAND'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l287"><span class="ln">287  </span></a>    <span class="s4">'LUXEMBOURG'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'MALTA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'CYPRUS'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l288"><span class="ln">288  </span></a>    <span class="s4">'ALBANIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'NORTH MACEDONIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'MONTENEGRO'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l289"><span class="ln">289  </span></a>    <span class="s4">'BOSNIA AND HERZEGOVINA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'UKRAINE'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'BELARUS'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l290"><span class="ln">290  </span></a>    <span class="s4">'MOLDOVA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l291"><span class="ln">291  </span></a>
<a name="l292"><span class="ln">292  </span></a>    <span class="s1"># Asia</span>
<a name="l293"><span class="ln">293  </span></a>    <span class="s4">'CHINA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'CHINA (MAINLAND)'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'INDIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'JAPAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l294"><span class="ln">294  </span></a>    <span class="s4">'KOREA (SOUTH)'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'INDONESIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'SAUDI ARABIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l295"><span class="ln">295  </span></a>    <span class="s4">'IRAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'IRAN (ISLAMIC REPUBLIC OF)'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'THAILAND'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l296"><span class="ln">296  </span></a>    <span class="s4">'MALAYSIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'SINGAPORE'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'PHILIPPINES'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'VIETNAM'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l297"><span class="ln">297  </span></a>    <span class="s4">'VIET NAM'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'PAKISTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'BANGLADESH'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'IRAQ'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l298"><span class="ln">298  </span></a>    <span class="s4">'UNITED ARAB EMIRATES'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'QATAR'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'KUWAIT'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'OMAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l299"><span class="ln">299  </span></a>    <span class="s4">'ISRAEL'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'LEBANON'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'JORDAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'SYRIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l300"><span class="ln">300  </span></a>    <span class="s4">'YEMEN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'SRI LANKA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'MYANMAR'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'CAMBODIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l301"><span class="ln">301  </span></a>    <span class="s4">'LAOS'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'NEPAL'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'AFGHANISTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'MONGOLIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l302"><span class="ln">302  </span></a>    <span class="s4">'KOREA (NORTH)'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'TAIWAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'BAHRAIN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'BRUNEI'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l303"><span class="ln">303  </span></a>    <span class="s4">'MALDIVES'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'BHUTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'TIMOR-LESTE'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l304"><span class="ln">304  </span></a>    <span class="s4">'AZERBAIJAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'ARMENIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'GEORGIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l305"><span class="ln">305  </span></a>    <span class="s4">'KAZAKHSTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'UZBEKISTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'TURKMENISTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l306"><span class="ln">306  </span></a>    <span class="s4">'KYRGYZSTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'TAJIKISTAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l307"><span class="ln">307  </span></a>
<a name="l308"><span class="ln">308  </span></a>    <span class="s1"># Africa</span>
<a name="l309"><span class="ln">309  </span></a>    <span class="s4">'SOUTH AFRICA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'EGYPT'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'NIGERIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'ALGERIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l310"><span class="ln">310  </span></a>    <span class="s4">'MOROCCO'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'LIBYA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'TUNISIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'KENYA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l311"><span class="ln">311  </span></a>    <span class="s4">'ETHIOPIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'GHANA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'ANGOLA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'SUDAN'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l312"><span class="ln">312  </span></a>    <span class="s4">'TANZANIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'TANZANIA (UNITED REPUBLIC OF)'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l313"><span class="ln">313  </span></a>    <span class="s4">'CAMEROON'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'UGANDA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'ZIMBABWE'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'ZAMBIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l314"><span class="ln">314  </span></a>    <span class="s4">'SENEGAL'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'MOZAMBIQUE'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'MADAGASCAR'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l315"><span class="ln">315  </span></a>    <span class="s4">'CÔTE D</span><span class="s2">\'</span><span class="s4">IVOIRE'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'MALI'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'BURKINA FASO'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l316"><span class="ln">316  </span></a>    <span class="s4">'NIGER'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'MALAWI'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'GUINEA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'RWANDA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l317"><span class="ln">317  </span></a>    <span class="s4">'BENIN'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'BURUNDI'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'CHAD'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'SOMALIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l318"><span class="ln">318  </span></a>    <span class="s4">'CONGO'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'CONGO (DEMOCRATIC REPUBLIC OF THE)'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l319"><span class="ln">319  </span></a>    <span class="s4">'GABON'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'MAURITANIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'NAMIBIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'BOTSWANA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l320"><span class="ln">320  </span></a>    <span class="s4">'MAURITIUS'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'TOGO'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'SIERRA LEONE'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'LIBERIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l321"><span class="ln">321  </span></a>
<a name="l322"><span class="ln">322  </span></a>    <span class="s1"># Oceania</span>
<a name="l323"><span class="ln">323  </span></a>    <span class="s4">'AUSTRALIA'</span><span class="s3">: </span><span class="s4">'Oceania'</span><span class="s3">, </span><span class="s4">'NEW ZEALAND'</span><span class="s3">: </span><span class="s4">'Oceania'</span><span class="s3">, </span><span class="s4">'PAPUA NEW GUINEA'</span><span class="s3">: </span><span class="s4">'Oceania'</span><span class="s3">,</span>
<a name="l324"><span class="ln">324  </span></a>    <span class="s4">'FIJI'</span><span class="s3">: </span><span class="s4">'Oceania'</span><span class="s3">,</span>
<a name="l325"><span class="ln">325  </span></a>
<a name="l326"><span class="ln">326  </span></a>    <span class="s1"># Russia (classified as Europe for simplicity)</span>
<a name="l327"><span class="ln">327  </span></a>    <span class="s4">'RUSSIA'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'RUSSIAN FEDERATION'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'TURKEY'</span><span class="s3">: </span><span class="s4">'Europe'</span>
<a name="l328"><span class="ln">328  </span></a><span class="s3">}</span>
<a name="l329"><span class="ln">329  </span></a>
<a name="l330"><span class="ln">330  </span></a><span class="s1"># Convert country names to uppercase and map to continents</span>
<a name="l331"><span class="ln">331  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Country_Upper'</span><span class="s3">] = </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">].</span><span class="s0">str</span><span class="s3">.</span><span class="s0">upper</span><span class="s3">().</span><span class="s0">str</span><span class="s3">.</span><span class="s0">strip</span><span class="s3">()</span>
<a name="l332"><span class="ln">332  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Continent'</span><span class="s3">] = </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Country_Upper'</span><span class="s3">].</span><span class="s0">map</span><span class="s3">(</span><span class="s0">continent_map</span><span class="s3">)</span>
<a name="l333"><span class="ln">333  </span></a>
<a name="l334"><span class="ln">334  </span></a><span class="s1"># Debug: identify any countries missing a continent assignment</span>
<a name="l335"><span class="ln">335  </span></a><span class="s0">missing </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Continent'</span><span class="s3">].</span><span class="s0">isna</span><span class="s3">()]</span>
<a name="l336"><span class="ln">336  </span></a><span class="s2">if </span><span class="s0">len</span><span class="s3">(</span><span class="s0">missing</span><span class="s3">) &gt; </span><span class="s5">0</span><span class="s3">:</span>
<a name="l337"><span class="ln">337  </span></a>    <span class="s0">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">Countries without continent mapping:&quot;</span><span class="s3">)</span>
<a name="l338"><span class="ln">338  </span></a>    <span class="s0">print</span><span class="s3">(</span><span class="s0">missing</span><span class="s3">[[</span><span class="s4">'Country'</span><span class="s3">, </span><span class="s4">'Country_Upper'</span><span class="s3">, </span><span class="s4">'CO2_2024'</span><span class="s3">]].</span><span class="s0">head</span><span class="s3">(</span><span class="s5">20</span><span class="s3">))</span>
<a name="l339"><span class="ln">339  </span></a>
<a name="l340"><span class="ln">340  </span></a><span class="s1"># Keep only countries with assigned continents</span>
<a name="l341"><span class="ln">341  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Continent'</span><span class="s3">].</span><span class="s0">notna</span><span class="s3">()].</span><span class="s0">copy</span><span class="s3">()</span>
<a name="l342"><span class="ln">342  </span></a>
<a name="l343"><span class="ln">343  </span></a><span class="s1"># === Summary statistics ===</span>
<a name="l344"><span class="ln">344  </span></a><span class="s0">print</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">\n</span><span class="s4">Processed countries: </span><span class="s2">{</span><span class="s0">len</span><span class="s3">(</span><span class="s0">df_countries</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l345"><span class="ln">345  </span></a><span class="s0">print</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">Top 10 emitters:&quot;</span><span class="s3">)</span>
<a name="l346"><span class="ln">346  </span></a><span class="s0">print</span><span class="s3">(</span><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">nlargest</span><span class="s3">(</span><span class="s5">10</span><span class="s3">, </span><span class="s4">'CO2_2024'</span><span class="s3">)[[</span><span class="s4">'Country'</span><span class="s3">, </span><span class="s4">'Continent'</span><span class="s3">, </span><span class="s4">'CO2_2024'</span><span class="s3">]])</span>
<a name="l347"><span class="ln">347  </span></a>
<a name="l348"><span class="ln">348  </span></a><span class="s1"># Compute global total and share per country</span>
<a name="l349"><span class="ln">349  </span></a><span class="s0">total_global </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">].</span><span class="s0">sum</span><span class="s3">()</span>
<a name="l350"><span class="ln">350  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Percentage'</span><span class="s3">] = (</span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">] / </span><span class="s0">total_global</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l351"><span class="ln">351  </span></a>
<a name="l352"><span class="ln">352  </span></a><span class="s1"># Aggregate by continent</span>
<a name="l353"><span class="ln">353  </span></a><span class="s0">continent_totals </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">groupby</span><span class="s3">(</span><span class="s4">'Continent'</span><span class="s3">)[</span><span class="s4">'CO2_2024'</span><span class="s3">].</span><span class="s0">sum</span><span class="s3">().</span><span class="s0">reset_index</span><span class="s3">()</span>
<a name="l354"><span class="ln">354  </span></a><span class="s0">continent_totals</span><span class="s3">[</span><span class="s4">'Cont_Percentage'</span><span class="s3">] = (</span><span class="s0">continent_totals</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">] / </span><span class="s0">total_global</span><span class="s3">) * </span><span class="s5">100</span>
<a name="l355"><span class="ln">355  </span></a>
<a name="l356"><span class="ln">356  </span></a>
<a name="l357"><span class="ln">357  </span></a><span class="s1"># === Label customization for better treemap readability ===</span>
<a name="l358"><span class="ln">358  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Label'</span><span class="s3">] = </span><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">apply</span><span class="s3">(</span>
<a name="l359"><span class="ln">359  </span></a>    <span class="s2">lambda </span><span class="s0">x</span><span class="s3">: </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">x</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">]</span><span class="s2">}</span><span class="s4">&lt;br&gt;</span><span class="s2">{</span><span class="s0">x</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">]</span><span class="s2">:</span><span class="s4">.0f</span><span class="s2">} </span><span class="s4">Mt&lt;br&gt;</span><span class="s2">{</span><span class="s0">x</span><span class="s3">[</span><span class="s4">'Percentage'</span><span class="s3">]</span><span class="s2">:</span><span class="s4">.1f</span><span class="s2">}</span><span class="s4">%&quot;</span>
<a name="l360"><span class="ln">360  </span></a>    <span class="s2">if </span><span class="s0">x</span><span class="s3">[</span><span class="s4">'Percentage'</span><span class="s3">] &gt; </span><span class="s5">1.0 </span><span class="s2">else</span>
<a name="l361"><span class="ln">361  </span></a>    <span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">x</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">]</span><span class="s2">}</span><span class="s4">&quot; </span><span class="s2">if </span><span class="s0">x</span><span class="s3">[</span><span class="s4">'Percentage'</span><span class="s3">] &gt; </span><span class="s5">0.3 </span><span class="s2">else </span><span class="s4">&quot;&quot;</span><span class="s3">,</span>
<a name="l362"><span class="ln">362  </span></a>    <span class="s0">axis</span><span class="s3">=</span><span class="s5">1</span>
<a name="l363"><span class="ln">363  </span></a><span class="s3">)</span>
<a name="l364"><span class="ln">364  </span></a>
<a name="l365"><span class="ln">365  </span></a><span class="s1"># === Color mapping for continents ===</span>
<a name="l366"><span class="ln">366  </span></a><span class="s0">continent_colors </span><span class="s3">= {</span>
<a name="l367"><span class="ln">367  </span></a>    <span class="s4">'North America'</span><span class="s3">: </span><span class="s4">'#2ecc71'</span><span class="s3">,  </span><span class="s1"># Green</span>
<a name="l368"><span class="ln">368  </span></a>    <span class="s4">'South America'</span><span class="s3">: </span><span class="s4">'#27ae60'</span><span class="s3">,  </span><span class="s1"># Dark green</span>
<a name="l369"><span class="ln">369  </span></a>    <span class="s4">'Europe'</span><span class="s3">: </span><span class="s4">'#f39c12'</span><span class="s3">,         </span><span class="s1"># Orange</span>
<a name="l370"><span class="ln">370  </span></a>    <span class="s4">'Asia'</span><span class="s3">: </span><span class="s4">'#e74c3c'</span><span class="s3">,           </span><span class="s1"># Red</span>
<a name="l371"><span class="ln">371  </span></a>    <span class="s4">'Africa'</span><span class="s3">: </span><span class="s4">'#3498db'</span><span class="s3">,         </span><span class="s1"># Blue</span>
<a name="l372"><span class="ln">372  </span></a>    <span class="s4">'Oceania'</span><span class="s3">: </span><span class="s4">'#9b59b6'         </span><span class="s1"># Purple</span>
<a name="l373"><span class="ln">373  </span></a><span class="s3">}</span>
<a name="l374"><span class="ln">374  </span></a>
<a name="l375"><span class="ln">375  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Color'</span><span class="s3">] = </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Continent'</span><span class="s3">].</span><span class="s0">map</span><span class="s3">(</span><span class="s0">continent_colors</span><span class="s3">)</span>
<a name="l376"><span class="ln">376  </span></a>
<a name="l377"><span class="ln">377  </span></a><span class="s1"># === Build the Treemap using Plotly Express ===</span>
<a name="l378"><span class="ln">378  </span></a><span class="s0">fig </span><span class="s3">= </span><span class="s0">px</span><span class="s3">.</span><span class="s0">treemap</span><span class="s3">(</span>
<a name="l379"><span class="ln">379  </span></a>    <span class="s0">df_countries</span><span class="s3">,</span>
<a name="l380"><span class="ln">380  </span></a>    <span class="s0">path</span><span class="s3">=[</span><span class="s4">'Continent'</span><span class="s3">, </span><span class="s4">'Country'</span><span class="s3">],</span>
<a name="l381"><span class="ln">381  </span></a>    <span class="s0">values</span><span class="s3">=</span><span class="s4">'CO2_2024'</span><span class="s3">,</span>
<a name="l382"><span class="ln">382  </span></a>    <span class="s0">color</span><span class="s3">=</span><span class="s4">'Continent'</span><span class="s3">,</span>
<a name="l383"><span class="ln">383  </span></a>    <span class="s0">color_discrete_map</span><span class="s3">=</span><span class="s0">continent_colors</span><span class="s3">,</span>
<a name="l384"><span class="ln">384  </span></a>    <span class="s0">custom_data</span><span class="s3">=[</span><span class="s4">'CO2_2024'</span><span class="s3">, </span><span class="s4">'Percentage'</span><span class="s3">, </span><span class="s4">'Country'</span><span class="s3">]</span>
<a name="l385"><span class="ln">385  </span></a><span class="s3">)</span>
<a name="l386"><span class="ln">386  </span></a>
<a name="l387"><span class="ln">387  </span></a><span class="s1"># === Customize treemap text and hover info ===</span>
<a name="l388"><span class="ln">388  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">update_traces</span><span class="s3">(</span>
<a name="l389"><span class="ln">389  </span></a>    <span class="s0">textposition</span><span class="s3">=</span><span class="s4">'middle center'</span><span class="s3">,</span>
<a name="l390"><span class="ln">390  </span></a>    <span class="s0">texttemplate</span><span class="s3">=</span><span class="s4">'%{customdata[2]}&lt;br&gt;&lt;b&gt;%{customdata[0]:.0f} Mt&lt;/b&gt;&lt;br&gt;%{customdata[1]:.1f}%'</span><span class="s3">,</span>
<a name="l391"><span class="ln">391  </span></a>    <span class="s0">textfont</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span><span class="s0">size</span><span class="s3">=</span><span class="s5">11</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">, </span><span class="s0">family</span><span class="s3">=</span><span class="s4">'Arial, sans-serif'</span><span class="s3">),</span>
<a name="l392"><span class="ln">392  </span></a>    <span class="s0">hovertemplate</span><span class="s3">=</span><span class="s4">'&lt;b&gt;%{customdata[2]}&lt;/b&gt;&lt;br&gt;CO₂: %{customdata[0]:,.0f} Mt&lt;br&gt;%{customdata[1]:.2f}% of global emissions&lt;extra&gt;&lt;/extra&gt;'</span><span class="s3">,</span>
<a name="l393"><span class="ln">393  </span></a>    <span class="s0">marker</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span>
<a name="l394"><span class="ln">394  </span></a>        <span class="s0">line</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span><span class="s0">width</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">),</span>
<a name="l395"><span class="ln">395  </span></a>        <span class="s0">pad</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span><span class="s0">t</span><span class="s3">=</span><span class="s5">30</span><span class="s3">, </span><span class="s0">l</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s0">r</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s0">b</span><span class="s3">=</span><span class="s5">5</span><span class="s3">)</span>
<a name="l396"><span class="ln">396  </span></a>    <span class="s3">)</span>
<a name="l397"><span class="ln">397  </span></a><span class="s3">)</span>
<a name="l398"><span class="ln">398  </span></a>
<a name="l399"><span class="ln">399  </span></a><span class="s1"># === Layout settings for appearance and readability ===</span>
<a name="l400"><span class="ln">400  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">update_layout</span><span class="s3">(</span>
<a name="l401"><span class="ln">401  </span></a>    <span class="s0">title</span><span class="s3">={</span>
<a name="l402"><span class="ln">402  </span></a>        <span class="s4">'text'</span><span class="s3">: </span><span class="s4">'Who has contributed most to global CO₂ emissions?&lt;br&gt;&lt;sub&gt;CO₂ emissions in 2024 (million tonnes)&lt;/sub&gt;'</span><span class="s3">,</span>
<a name="l403"><span class="ln">403  </span></a>        <span class="s4">'x'</span><span class="s3">: </span><span class="s5">0.5</span><span class="s3">,</span>
<a name="l404"><span class="ln">404  </span></a>        <span class="s4">'xanchor'</span><span class="s3">: </span><span class="s4">'center'</span><span class="s3">,</span>
<a name="l405"><span class="ln">405  </span></a>        <span class="s4">'font'</span><span class="s3">: {</span><span class="s4">'size'</span><span class="s3">: </span><span class="s5">28</span><span class="s3">, </span><span class="s4">'color'</span><span class="s3">: </span><span class="s4">'#2C3E50'</span><span class="s3">, </span><span class="s4">'family'</span><span class="s3">: </span><span class="s4">'Arial'</span><span class="s3">}</span>
<a name="l406"><span class="ln">406  </span></a>    <span class="s3">},</span>
<a name="l407"><span class="ln">407  </span></a>    <span class="s0">width</span><span class="s3">=</span><span class="s5">1400</span><span class="s3">,</span>
<a name="l408"><span class="ln">408  </span></a>    <span class="s0">height</span><span class="s3">=</span><span class="s5">800</span><span class="s3">,</span>
<a name="l409"><span class="ln">409  </span></a>    <span class="s0">paper_bgcolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">,</span>
<a name="l410"><span class="ln">410  </span></a>    <span class="s0">font</span><span class="s3">=</span><span class="s0">dict</span><span class="s3">(</span><span class="s0">family</span><span class="s3">=</span><span class="s4">'Arial'</span><span class="s3">, </span><span class="s0">size</span><span class="s3">=</span><span class="s5">14</span><span class="s3">)</span>
<a name="l411"><span class="ln">411  </span></a><span class="s3">)</span>
<a name="l412"><span class="ln">412  </span></a>
<a name="l413"><span class="ln">413  </span></a><span class="s1"># === Export interactive chart as HTML ===</span>
<a name="l414"><span class="ln">414  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">write_html</span><span class="s3">(</span><span class="s4">'../Graphs/co2_treemap_2024_v1.html'</span><span class="s3">)</span>
<a name="l415"><span class="ln">415  </span></a><span class="s2">from </span><span class="s0">IPython</span><span class="s3">.</span><span class="s0">display </span><span class="s2">import </span><span class="s0">HTML</span>
<a name="l416"><span class="ln">416  </span></a>
<a name="l417"><span class="ln">417  </span></a><span class="s0">HTML</span><span class="s3">(</span><span class="s0">fig</span><span class="s3">.</span><span class="s0">to_html</span><span class="s3">(</span><span class="s0">include_plotlyjs</span><span class="s3">=</span><span class="s4">'cdn'</span><span class="s3">, </span><span class="s0">full_html</span><span class="s3">=</span><span class="s2">False</span><span class="s3">))</span>
<a name="l418"><span class="ln">418  </span></a>
<a name="l419"><span class="ln">419  </span></a>
<a name="l420"><span class="ln">420  </span></a><span class="s1"># Show in browser / interactive window</span>
<a name="l421"><span class="ln">421  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span><hr class="ls0"><a name="l422"><span class="ln">422  </span></a><span class="s0">#%% md 
<a name="l423"><span class="ln">423  </span></a>Después de analizar las emisiones globales de CO₂ por país, es importante comprender qué sectores económicos son los principales responsables de estas emisiones. Las actividades industriales, el transporte y la generación de energía eléctrica continúan siendo los mayores contribuyentes a nivel mundial. A lo largo del período comprendido entre 2015 y 2024, se observa un crecimiento sostenido en casi todos los sectores, impulsado por el aumento de la demanda energética, el desarrollo urbano y la expansión del transporte. 
<a name="l424"><span class="ln">424  </span></a>Aunque algunos sectores, como los procesos industriales y la agricultura, mantienen niveles más estables, el sector energético (particularmente la generación de electricidad a partir de combustibles fósiles) sigue siendo el mayor responsable del aumento global de CO₂. Este análisis permite identificar las áreas prioritarias donde deben enfocarse las políticas de descarbonización y transición hacia energías limpias. 
<a name="l425"><span class="ln">425  </span></a> <hr class="ls0"><a name="l426"><span class="ln">426  </span></a>#%% 
<a name="l427"><span class="ln">427  </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l428"><span class="ln">428  </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt</span>
<a name="l429"><span class="ln">429  </span></a><span class="s2">import </span><span class="s0">numpy </span><span class="s2">as </span><span class="s0">np</span>
<a name="l430"><span class="ln">430  </span></a>
<a name="l431"><span class="ln">431  </span></a><span class="s1"># Read the Excel file</span>
<a name="l432"><span class="ln">432  </span></a><span class="s0">archivo </span><span class="s3">= </span><span class="s4">'../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx'</span>
<a name="l433"><span class="ln">433  </span></a>
<a name="l434"><span class="ln">434  </span></a><span class="s1"># Read the &quot;fossil_CO2_by_sector_country_su&quot; sheet</span>
<a name="l435"><span class="ln">435  </span></a><span class="s0">df_sectores </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">archivo</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'fossil_CO2_by_sector_country_su'</span><span class="s3">)</span>
<a name="l436"><span class="ln">436  </span></a>
<a name="l437"><span class="ln">437  </span></a><span class="s1"># Extract rows 1462 to 1469 (indices 1461 to 1468 in pandas)</span>
<a name="l438"><span class="ln">438  </span></a><span class="s0">df_sectores_filtrado </span><span class="s3">= </span><span class="s0">df_sectores</span><span class="s3">.</span><span class="s0">iloc</span><span class="s3">[</span><span class="s5">1461</span><span class="s3">:</span><span class="s5">1469</span><span class="s3">]</span>
<a name="l439"><span class="ln">439  </span></a>
<a name="l440"><span class="ln">440  </span></a><span class="s1"># Last 10 years to analyze</span>
<a name="l441"><span class="ln">441  </span></a><span class="s0">ultimos_10_años </span><span class="s3">= [</span><span class="s5">2015</span><span class="s3">, </span><span class="s5">2016</span><span class="s3">, </span><span class="s5">2017</span><span class="s3">, </span><span class="s5">2018</span><span class="s3">, </span><span class="s5">2019</span><span class="s3">, </span><span class="s5">2020</span><span class="s3">, </span><span class="s5">2021</span><span class="s3">, </span><span class="s5">2022</span><span class="s3">, </span><span class="s5">2023</span><span class="s3">, </span><span class="s5">2024</span><span class="s3">]</span>
<a name="l442"><span class="ln">442  </span></a>
<a name="l443"><span class="ln">443  </span></a><span class="s1"># Define the order of sectors (bottom to top in the stacked bar)</span>
<a name="l444"><span class="ln">444  </span></a><span class="s0">sector_order </span><span class="s3">= [</span>
<a name="l445"><span class="ln">445  </span></a>    <span class="s4">'Power Industry'</span><span class="s3">,</span>
<a name="l446"><span class="ln">446  </span></a>    <span class="s4">'Transport'</span><span class="s3">,</span>
<a name="l447"><span class="ln">447  </span></a>    <span class="s4">'Industrial Combustion'</span><span class="s3">,</span>
<a name="l448"><span class="ln">448  </span></a>    <span class="s4">'Buildings'</span><span class="s3">,</span>
<a name="l449"><span class="ln">449  </span></a>    <span class="s4">'Processes'</span><span class="s3">,</span>
<a name="l450"><span class="ln">450  </span></a>    <span class="s4">'Fuel Exploitation'</span><span class="s3">,</span>
<a name="l451"><span class="ln">451  </span></a>    <span class="s4">'Waste'</span><span class="s3">,</span>
<a name="l452"><span class="ln">452  </span></a>    <span class="s4">'Agriculture'</span>
<a name="l453"><span class="ln">453  </span></a><span class="s3">]</span>
<a name="l454"><span class="ln">454  </span></a>
<a name="l455"><span class="ln">455  </span></a><span class="s1"># Assign colors for each sector</span>
<a name="l456"><span class="ln">456  </span></a><span class="s0">colors </span><span class="s3">= {</span>
<a name="l457"><span class="ln">457  </span></a>    <span class="s4">'Power Industry'</span><span class="s3">: </span><span class="s4">'#e74c3c'</span><span class="s3">,  </span><span class="s1"># Red</span>
<a name="l458"><span class="ln">458  </span></a>    <span class="s4">'Transport'</span><span class="s3">: </span><span class="s4">'#3498db'</span><span class="s3">,  </span><span class="s1"># Blue</span>
<a name="l459"><span class="ln">459  </span></a>    <span class="s4">'Industrial Combustion'</span><span class="s3">: </span><span class="s4">'#2ecc71'</span><span class="s3">,  </span><span class="s1"># Green</span>
<a name="l460"><span class="ln">460  </span></a>    <span class="s4">'Buildings'</span><span class="s3">: </span><span class="s4">'#f39c12'</span><span class="s3">,  </span><span class="s1"># Orange</span>
<a name="l461"><span class="ln">461  </span></a>    <span class="s4">'Processes'</span><span class="s3">: </span><span class="s4">'#9b59b6'</span><span class="s3">,  </span><span class="s1"># Purple</span>
<a name="l462"><span class="ln">462  </span></a>    <span class="s4">'Fuel Exploitation'</span><span class="s3">: </span><span class="s4">'#1abc9c'</span><span class="s3">,  </span><span class="s1"># Teal</span>
<a name="l463"><span class="ln">463  </span></a>    <span class="s4">'Waste'</span><span class="s3">: </span><span class="s4">'#95a5a6'</span><span class="s3">,  </span><span class="s1"># Gray</span>
<a name="l464"><span class="ln">464  </span></a>    <span class="s4">'Agriculture'</span><span class="s3">: </span><span class="s4">'#e67e22'</span><span class="s3">,  </span><span class="s1"># Dark orange</span>
<a name="l465"><span class="ln">465  </span></a><span class="s3">}</span>
<a name="l466"><span class="ln">466  </span></a>
<a name="l467"><span class="ln">467  </span></a><span class="s1"># Prepare data matrix for stacked bar plot</span>
<a name="l468"><span class="ln">468  </span></a><span class="s0">data_matrix </span><span class="s3">= []</span>
<a name="l469"><span class="ln">469  </span></a>
<a name="l470"><span class="ln">470  </span></a><span class="s2">for </span><span class="s0">sector </span><span class="s2">in </span><span class="s0">sector_order</span><span class="s3">:</span>
<a name="l471"><span class="ln">471  </span></a>    <span class="s0">sector_values </span><span class="s3">= []</span>
<a name="l472"><span class="ln">472  </span></a>    <span class="s2">for </span><span class="s0">year </span><span class="s2">in </span><span class="s0">ultimos_10_años</span><span class="s3">:</span>
<a name="l473"><span class="ln">473  </span></a>        <span class="s1"># Find the row for this sector</span>
<a name="l474"><span class="ln">474  </span></a>        <span class="s0">sector_row </span><span class="s3">= </span><span class="s0">df_sectores_filtrado</span><span class="s3">[</span><span class="s0">df_sectores_filtrado</span><span class="s3">[</span><span class="s4">'Sector'</span><span class="s3">] == </span><span class="s0">sector</span><span class="s3">]</span>
<a name="l475"><span class="ln">475  </span></a>        <span class="s2">if not </span><span class="s0">sector_row</span><span class="s3">.</span><span class="s0">empty </span><span class="s2">and </span><span class="s0">year </span><span class="s2">in </span><span class="s0">sector_row</span><span class="s3">.</span><span class="s0">columns</span><span class="s3">:</span>
<a name="l476"><span class="ln">476  </span></a>            <span class="s0">value </span><span class="s3">= </span><span class="s0">sector_row</span><span class="s3">[</span><span class="s0">year</span><span class="s3">].</span><span class="s0">values</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
<a name="l477"><span class="ln">477  </span></a>            <span class="s2">if </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">notna</span><span class="s3">(</span><span class="s0">value</span><span class="s3">) </span><span class="s2">and </span><span class="s0">value </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">:</span>
<a name="l478"><span class="ln">478  </span></a>                <span class="s0">sector_values</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s0">value</span><span class="s3">)</span>
<a name="l479"><span class="ln">479  </span></a>            <span class="s2">else</span><span class="s3">:</span>
<a name="l480"><span class="ln">480  </span></a>                <span class="s0">sector_values</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l481"><span class="ln">481  </span></a>        <span class="s2">else</span><span class="s3">:</span>
<a name="l482"><span class="ln">482  </span></a>            <span class="s0">sector_values</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
<a name="l483"><span class="ln">483  </span></a>    <span class="s0">data_matrix</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s0">sector_values</span><span class="s3">)</span>
<a name="l484"><span class="ln">484  </span></a>
<a name="l485"><span class="ln">485  </span></a><span class="s1"># Convert to DataFrame for easier manipulation</span>
<a name="l486"><span class="ln">486  </span></a><span class="s0">df_plot </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">DataFrame</span><span class="s3">(</span><span class="s0">data_matrix</span><span class="s3">, </span><span class="s0">index</span><span class="s3">=</span><span class="s0">sector_order</span><span class="s3">, </span><span class="s0">columns</span><span class="s3">=</span><span class="s0">ultimos_10_años</span><span class="s3">).</span><span class="s0">T</span>
<a name="l487"><span class="ln">487  </span></a>
<a name="l488"><span class="ln">488  </span></a><span class="s1"># Calculate totals per year</span>
<a name="l489"><span class="ln">489  </span></a><span class="s0">totals </span><span class="s3">= </span><span class="s0">df_plot</span><span class="s3">.</span><span class="s0">sum</span><span class="s3">(</span><span class="s0">axis</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l490"><span class="ln">490  </span></a>
<a name="l491"><span class="ln">491  </span></a><span class="s1"># Create figure with extra space for legend</span>
<a name="l492"><span class="ln">492  </span></a><span class="s0">fig</span><span class="s3">, </span><span class="s0">ax </span><span class="s3">= </span><span class="s0">plt</span><span class="s3">.</span><span class="s0">subplots</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">16</span><span class="s3">, </span><span class="s5">8</span><span class="s3">))</span>
<a name="l493"><span class="ln">493  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">patch</span><span class="s3">.</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">'white'</span><span class="s3">)</span>
<a name="l494"><span class="ln">494  </span></a>
<a name="l495"><span class="ln">495  </span></a><span class="s1"># Create stacked bar plot</span>
<a name="l496"><span class="ln">496  </span></a><span class="s0">bottom </span><span class="s3">= </span><span class="s0">np</span><span class="s3">.</span><span class="s0">zeros</span><span class="s3">(</span><span class="s0">len</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">))</span>
<a name="l497"><span class="ln">497  </span></a><span class="s0">bar_width </span><span class="s3">= </span><span class="s5">0.6</span>
<a name="l498"><span class="ln">498  </span></a>
<a name="l499"><span class="ln">499  </span></a><span class="s2">for </span><span class="s0">sector </span><span class="s2">in </span><span class="s0">sector_order</span><span class="s3">:</span>
<a name="l500"><span class="ln">500  </span></a>    <span class="s0">values </span><span class="s3">= </span><span class="s0">df_plot</span><span class="s3">[</span><span class="s0">sector</span><span class="s3">].</span><span class="s0">values</span>
<a name="l501"><span class="ln">501  </span></a>    <span class="s0">bars </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">bar</span><span class="s3">(</span>
<a name="l502"><span class="ln">502  </span></a>        <span class="s0">ultimos_10_años</span><span class="s3">,</span>
<a name="l503"><span class="ln">503  </span></a>        <span class="s0">values</span><span class="s3">,</span>
<a name="l504"><span class="ln">504  </span></a>        <span class="s0">bar_width</span><span class="s3">,</span>
<a name="l505"><span class="ln">505  </span></a>        <span class="s0">bottom</span><span class="s3">=</span><span class="s0">bottom</span><span class="s3">,</span>
<a name="l506"><span class="ln">506  </span></a>        <span class="s0">label</span><span class="s3">=</span><span class="s0">sector</span><span class="s3">,</span>
<a name="l507"><span class="ln">507  </span></a>        <span class="s0">color</span><span class="s3">=</span><span class="s0">colors</span><span class="s3">[</span><span class="s0">sector</span><span class="s3">],</span>
<a name="l508"><span class="ln">508  </span></a>        <span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">,</span>
<a name="l509"><span class="ln">509  </span></a>        <span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.5</span>
<a name="l510"><span class="ln">510  </span></a>    <span class="s3">)</span>
<a name="l511"><span class="ln">511  </span></a>
<a name="l512"><span class="ln">512  </span></a>    <span class="s1"># Add text labels for larger segments (&gt;5% of total)</span>
<a name="l513"><span class="ln">513  </span></a>    <span class="s2">for </span><span class="s0">i</span><span class="s3">, (</span><span class="s0">year</span><span class="s3">, </span><span class="s0">value</span><span class="s3">) </span><span class="s2">in </span><span class="s0">enumerate</span><span class="s3">(</span><span class="s0">zip</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">, </span><span class="s0">values</span><span class="s3">)):</span>
<a name="l514"><span class="ln">514  </span></a>        <span class="s2">if </span><span class="s0">value </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">:</span>
<a name="l515"><span class="ln">515  </span></a>            <span class="s0">percentage </span><span class="s3">= (</span><span class="s0">value </span><span class="s3">/ </span><span class="s0">totals</span><span class="s3">.</span><span class="s0">iloc</span><span class="s3">[</span><span class="s0">i</span><span class="s3">]) * </span><span class="s5">100</span>
<a name="l516"><span class="ln">516  </span></a>            <span class="s2">if </span><span class="s0">percentage </span><span class="s3">&gt; </span><span class="s5">5</span><span class="s3">:  </span><span class="s1"># Only label significant segments</span>
<a name="l517"><span class="ln">517  </span></a>                <span class="s0">text_y </span><span class="s3">= </span><span class="s0">bottom</span><span class="s3">[</span><span class="s0">i</span><span class="s3">] + </span><span class="s0">value </span><span class="s3">/ </span><span class="s5">2</span>
<a name="l518"><span class="ln">518  </span></a>                <span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span>
<a name="l519"><span class="ln">519  </span></a>                    <span class="s0">year</span><span class="s3">, </span><span class="s0">text_y</span><span class="s3">,</span>
<a name="l520"><span class="ln">520  </span></a>                    <span class="s4">f'</span><span class="s2">{</span><span class="s0">int</span><span class="s3">(</span><span class="s0">value</span><span class="s3">)</span><span class="s2">:</span><span class="s4">,</span><span class="s2">}</span><span class="s4">'</span><span class="s3">,</span>
<a name="l521"><span class="ln">521  </span></a>                    <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">,</span>
<a name="l522"><span class="ln">522  </span></a>                    <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">9</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">,</span>
<a name="l523"><span class="ln">523  </span></a>                    <span class="s0">color</span><span class="s3">=</span><span class="s4">'white'</span>
<a name="l524"><span class="ln">524  </span></a>                <span class="s3">)</span>
<a name="l525"><span class="ln">525  </span></a>
<a name="l526"><span class="ln">526  </span></a>    <span class="s0">bottom </span><span class="s3">+= </span><span class="s0">values</span>
<a name="l527"><span class="ln">527  </span></a>
<a name="l528"><span class="ln">528  </span></a><span class="s1"># Add total values on top of each bar</span>
<a name="l529"><span class="ln">529  </span></a><span class="s2">for </span><span class="s0">i</span><span class="s3">, (</span><span class="s0">year</span><span class="s3">, </span><span class="s0">total</span><span class="s3">) </span><span class="s2">in </span><span class="s0">enumerate</span><span class="s3">(</span><span class="s0">zip</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">, </span><span class="s0">totals</span><span class="s3">)):</span>
<a name="l530"><span class="ln">530  </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span>
<a name="l531"><span class="ln">531  </span></a>        <span class="s0">year</span><span class="s3">, </span><span class="s0">total </span><span class="s3">+ </span><span class="s5">500</span><span class="s3">,</span>
<a name="l532"><span class="ln">532  </span></a>        <span class="s4">f'</span><span class="s2">{</span><span class="s0">int</span><span class="s3">(</span><span class="s0">total</span><span class="s3">)</span><span class="s2">:</span><span class="s4">,</span><span class="s2">}</span><span class="s4">'</span><span class="s3">,</span>
<a name="l533"><span class="ln">533  </span></a>        <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">'bottom'</span><span class="s3">,</span>
<a name="l534"><span class="ln">534  </span></a>        <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">,</span>
<a name="l535"><span class="ln">535  </span></a>        <span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span>
<a name="l536"><span class="ln">536  </span></a>    <span class="s3">)</span>
<a name="l537"><span class="ln">537  </span></a>
<a name="l538"><span class="ln">538  </span></a><span class="s1"># Customize axes</span>
<a name="l539"><span class="ln">539  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xlabel</span><span class="s3">(</span><span class="s4">'Year'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">14</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span><span class="s3">, </span><span class="s0">labelpad</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
<a name="l540"><span class="ln">540  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_ylabel</span><span class="s3">(</span><span class="s4">'Million tonnes CO$_2$'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">14</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span><span class="s3">, </span><span class="s0">labelpad</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
<a name="l541"><span class="ln">541  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_title</span><span class="s3">(</span><span class="s4">'Global CO$_2$ Emissions by Sector</span><span class="s2">\n</span><span class="s4">Evolution from 2015 to 2024'</span><span class="s3">,</span>
<a name="l542"><span class="ln">542  </span></a>             <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">20</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span><span class="s3">, </span><span class="s0">pad</span><span class="s3">=</span><span class="s5">20</span><span class="s3">)</span>
<a name="l543"><span class="ln">543  </span></a>
<a name="l544"><span class="ln">544  </span></a><span class="s1"># Format y-axis</span>
<a name="l545"><span class="ln">545  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">yaxis</span><span class="s3">.</span><span class="s0">set_major_formatter</span><span class="s3">(</span><span class="s0">plt</span><span class="s3">.</span><span class="s0">FuncFormatter</span><span class="s3">(</span><span class="s2">lambda </span><span class="s0">x</span><span class="s3">, </span><span class="s0">p</span><span class="s3">: </span><span class="s4">f'</span><span class="s2">{</span><span class="s0">int</span><span class="s3">(</span><span class="s0">x</span><span class="s3">)</span><span class="s2">:</span><span class="s4">,</span><span class="s2">}</span><span class="s4">'</span><span class="s3">))</span>
<a name="l546"><span class="ln">546  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">tick_params</span><span class="s3">(</span><span class="s0">axis</span><span class="s3">=</span><span class="s4">'both'</span><span class="s3">, </span><span class="s0">labelsize</span><span class="s3">=</span><span class="s5">11</span><span class="s3">, </span><span class="s0">colors</span><span class="s3">=</span><span class="s4">'#555555'</span><span class="s3">)</span>
<a name="l547"><span class="ln">547  </span></a>
<a name="l548"><span class="ln">548  </span></a><span class="s1"># Set x-axis ticks</span>
<a name="l549"><span class="ln">549  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xticks</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">)</span>
<a name="l550"><span class="ln">550  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xticklabels</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'600'</span><span class="s3">)</span>
<a name="l551"><span class="ln">551  </span></a>
<a name="l552"><span class="ln">552  </span></a><span class="s1"># Grid</span>
<a name="l553"><span class="ln">553  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">grid</span><span class="s3">(</span><span class="s0">axis</span><span class="s3">=</span><span class="s4">'y'</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0.3</span><span class="s3">, </span><span class="s0">linestyle</span><span class="s3">=</span><span class="s4">'--'</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">0.7</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#cccccc'</span><span class="s3">)</span>
<a name="l554"><span class="ln">554  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_axisbelow</span><span class="s3">(</span><span class="s2">True</span><span class="s3">)</span>
<a name="l555"><span class="ln">555  </span></a>
<a name="l556"><span class="ln">556  </span></a><span class="s1"># Spines</span>
<a name="l557"><span class="ln">557  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'top'</span><span class="s3">].</span><span class="s0">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l558"><span class="ln">558  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'right'</span><span class="s3">].</span><span class="s0">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l559"><span class="ln">559  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'left'</span><span class="s3">].</span><span class="s0">set_color</span><span class="s3">(</span><span class="s4">'#999999'</span><span class="s3">)</span>
<a name="l560"><span class="ln">560  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'bottom'</span><span class="s3">].</span><span class="s0">set_color</span><span class="s3">(</span><span class="s4">'#999999'</span><span class="s3">)</span>
<a name="l561"><span class="ln">561  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'left'</span><span class="s3">].</span><span class="s0">set_linewidth</span><span class="s3">(</span><span class="s5">1.5</span><span class="s3">)</span>
<a name="l562"><span class="ln">562  </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s4">'bottom'</span><span class="s3">].</span><span class="s0">set_linewidth</span><span class="s3">(</span><span class="s5">1.5</span><span class="s3">)</span>
<a name="l563"><span class="ln">563  </span></a>
<a name="l564"><span class="ln">564  </span></a><span class="s1"># Legend - positioned outside to the right</span>
<a name="l565"><span class="ln">565  </span></a><span class="s0">legend </span><span class="s3">= </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">legend</span><span class="s3">(</span>
<a name="l566"><span class="ln">566  </span></a>    <span class="s0">loc</span><span class="s3">=</span><span class="s4">'center left'</span><span class="s3">,</span>
<a name="l567"><span class="ln">567  </span></a>    <span class="s0">bbox_to_anchor</span><span class="s3">=(</span><span class="s5">1.02</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">),</span>
<a name="l568"><span class="ln">568  </span></a>    <span class="s0">ncol</span><span class="s3">=</span><span class="s5">1</span><span class="s3">,</span>
<a name="l569"><span class="ln">569  </span></a>    <span class="s0">frameon</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
<a name="l570"><span class="ln">570  </span></a>    <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">,</span>
<a name="l571"><span class="ln">571  </span></a>    <span class="s0">title</span><span class="s3">=</span><span class="s4">'Sectors'</span><span class="s3">,</span>
<a name="l572"><span class="ln">572  </span></a>    <span class="s0">title_fontsize</span><span class="s3">=</span><span class="s5">13</span><span class="s3">,</span>
<a name="l573"><span class="ln">573  </span></a>    <span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'#cccccc'</span><span class="s3">,</span>
<a name="l574"><span class="ln">574  </span></a>    <span class="s0">fancybox</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
<a name="l575"><span class="ln">575  </span></a>    <span class="s0">shadow</span><span class="s3">=</span><span class="s2">True</span>
<a name="l576"><span class="ln">576  </span></a><span class="s3">)</span>
<a name="l577"><span class="ln">577  </span></a><span class="s0">legend</span><span class="s3">.</span><span class="s0">get_frame</span><span class="s3">().</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">'white'</span><span class="s3">)</span>
<a name="l578"><span class="ln">578  </span></a><span class="s0">legend</span><span class="s3">.</span><span class="s0">get_frame</span><span class="s3">().</span><span class="s0">set_alpha</span><span class="s3">(</span><span class="s5">0.95</span><span class="s3">)</span>
<a name="l579"><span class="ln">579  </span></a>
<a name="l580"><span class="ln">580  </span></a><span class="s1"># Adjust layout to accommodate legend</span>
<a name="l581"><span class="ln">581  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">subplots_adjust</span><span class="s3">(</span><span class="s0">right</span><span class="s3">=</span><span class="s5">0.82</span><span class="s3">)</span>
<a name="l582"><span class="ln">582  </span></a>
<a name="l583"><span class="ln">583  </span></a><span class="s1"># Save figure</span>
<a name="l584"><span class="ln">584  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">savefig</span><span class="s3">(</span><span class="s4">'../Graphs/co2_stacked_barplot.png'</span><span class="s3">, </span><span class="s0">dpi</span><span class="s3">=</span><span class="s5">300</span><span class="s3">, </span><span class="s0">bbox_inches</span><span class="s3">=</span><span class="s4">'tight'</span><span class="s3">,</span>
<a name="l585"><span class="ln">585  </span></a>            <span class="s0">facecolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">, </span><span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'none'</span><span class="s3">)</span>
<a name="l586"><span class="ln">586  </span></a>
<a name="l587"><span class="ln">587  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span>
<a name="l588"><span class="ln">588  </span></a>
<a name="l589"><span class="ln">589  </span></a><hr class="ls0"><a name="l590"><span class="ln">590  </span></a><span class="s0">#%% 
<a name="l591"><span class="ln">591  </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l592"><span class="ln">592  </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt</span>
<a name="l593"><span class="ln">593  </span></a><span class="s2">from </span><span class="s0">pywaffle </span><span class="s2">import </span><span class="s0">Waffle</span>
<a name="l594"><span class="ln">594  </span></a><span class="s2">import </span><span class="s0">numpy </span><span class="s2">as </span><span class="s0">np</span>
<a name="l595"><span class="ln">595  </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">patches </span><span class="s2">as </span><span class="s0">mpatches</span>
<a name="l596"><span class="ln">596  </span></a>
<a name="l597"><span class="ln">597  </span></a><span class="s1"># Read the Excel file</span>
<a name="l598"><span class="ln">598  </span></a><span class="s1"># If you get an error like:</span>
<a name="l599"><span class="ln">599  </span></a><span class="s1">#   ImportError: Missing optional dependency 'openpyxl'</span>
<a name="l600"><span class="ln">600  </span></a><span class="s1"># it means you need to install the openpyxl library.</span>
<a name="l601"><span class="ln">601  </span></a><span class="s1"># Solution: open the terminal in your virtual environment and run:</span>
<a name="l602"><span class="ln">602  </span></a><span class="s1">#     pip install openpyxl</span>
<a name="l603"><span class="ln">603  </span></a><span class="s1"># or if you use conda:</span>
<a name="l604"><span class="ln">604  </span></a><span class="s1">#     conda install openpyxl</span>
<a name="l605"><span class="ln">605  </span></a><span class="s1"># After installing it, rerun the code and it should work fine.</span>
<a name="l606"><span class="ln">606  </span></a><span class="s0">archivo </span><span class="s3">= </span><span class="s4">'../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx'</span>
<a name="l607"><span class="ln">607  </span></a>
<a name="l608"><span class="ln">608  </span></a><span class="s1"># Read the &quot;fossil_CO2_by_sector_country_su&quot; sheet</span>
<a name="l609"><span class="ln">609  </span></a><span class="s0">df_sectores </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">archivo</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'fossil_CO2_by_sector_country_su'</span><span class="s3">)</span>
<a name="l610"><span class="ln">610  </span></a>
<a name="l611"><span class="ln">611  </span></a><span class="s1"># Extract rows 1462 to 1469 (indices 1461 to 1468 in pandas, since it starts from 0)</span>
<a name="l612"><span class="ln">612  </span></a><span class="s0">df_sectores_filtrado </span><span class="s3">= </span><span class="s0">df_sectores</span><span class="s3">.</span><span class="s0">iloc</span><span class="s3">[</span><span class="s5">1461</span><span class="s3">:</span><span class="s5">1469</span><span class="s3">]</span>
<a name="l613"><span class="ln">613  </span></a>
<a name="l614"><span class="ln">614  </span></a><span class="s1"># Last 10 years to analyze</span>
<a name="l615"><span class="ln">615  </span></a><span class="s0">ultimos_10_años </span><span class="s3">= [</span><span class="s5">2015</span><span class="s3">, </span><span class="s5">2016</span><span class="s3">, </span><span class="s5">2017</span><span class="s3">, </span><span class="s5">2018</span><span class="s3">, </span><span class="s5">2019</span><span class="s3">, </span><span class="s5">2020</span><span class="s3">, </span><span class="s5">2021</span><span class="s3">, </span><span class="s5">2022</span><span class="s3">, </span><span class="s5">2023</span><span class="s3">, </span><span class="s5">2024</span><span class="s3">]</span>
<a name="l616"><span class="ln">616  </span></a>
<a name="l617"><span class="ln">617  </span></a><span class="s1"># Define the order of sectors for consistency in plots</span>
<a name="l618"><span class="ln">618  </span></a><span class="s0">sector_order </span><span class="s3">= [</span>
<a name="l619"><span class="ln">619  </span></a>    <span class="s4">'Power Industry'</span><span class="s3">,</span>
<a name="l620"><span class="ln">620  </span></a>    <span class="s4">'Transport'</span><span class="s3">,</span>
<a name="l621"><span class="ln">621  </span></a>    <span class="s4">'Industrial Combustion'</span><span class="s3">,</span>
<a name="l622"><span class="ln">622  </span></a>    <span class="s4">'Buildings'</span><span class="s3">,</span>
<a name="l623"><span class="ln">623  </span></a>    <span class="s4">'Processes'</span><span class="s3">,</span>
<a name="l624"><span class="ln">624  </span></a>    <span class="s4">'Fuel Exploitation'</span><span class="s3">,</span>
<a name="l625"><span class="ln">625  </span></a>    <span class="s4">'Waste'</span><span class="s3">,</span>
<a name="l626"><span class="ln">626  </span></a>    <span class="s4">'Agriculture'</span>
<a name="l627"><span class="ln">627  </span></a><span class="s3">]</span>
<a name="l628"><span class="ln">628  </span></a>
<a name="l629"><span class="ln">629  </span></a><span class="s1"># Assign colors for each sector</span>
<a name="l630"><span class="ln">630  </span></a><span class="s0">colors </span><span class="s3">= [</span>
<a name="l631"><span class="ln">631  </span></a>    <span class="s4">'#e74c3c'</span><span class="s3">,  </span><span class="s1"># Power Industry - Red</span>
<a name="l632"><span class="ln">632  </span></a>    <span class="s4">'#3498db'</span><span class="s3">,  </span><span class="s1"># Transport - Blue</span>
<a name="l633"><span class="ln">633  </span></a>    <span class="s4">'#2ecc71'</span><span class="s3">,  </span><span class="s1"># Industrial Combustion - Green</span>
<a name="l634"><span class="ln">634  </span></a>    <span class="s4">'#f39c12'</span><span class="s3">,  </span><span class="s1"># Buildings - Orange</span>
<a name="l635"><span class="ln">635  </span></a>    <span class="s4">'#9b59b6'</span><span class="s3">,  </span><span class="s1"># Processes - Purple</span>
<a name="l636"><span class="ln">636  </span></a>    <span class="s4">'#1abc9c'</span><span class="s3">,  </span><span class="s1"># Fuel Exploitation - Teal</span>
<a name="l637"><span class="ln">637  </span></a>    <span class="s4">'#95a5a6'</span><span class="s3">,  </span><span class="s1"># Waste - Gray</span>
<a name="l638"><span class="ln">638  </span></a>    <span class="s4">'#e67e22'</span><span class="s3">,  </span><span class="s1"># Agriculture - Dark orange</span>
<a name="l639"><span class="ln">639  </span></a><span class="s3">]</span>
<a name="l640"><span class="ln">640  </span></a>
<a name="l641"><span class="ln">641  </span></a><span class="s1"># Prepare aggregated data by year</span>
<a name="l642"><span class="ln">642  </span></a><span class="s0">data_by_year </span><span class="s3">= []</span>
<a name="l643"><span class="ln">643  </span></a>
<a name="l644"><span class="ln">644  </span></a><span class="s2">for </span><span class="s0">year </span><span class="s2">in </span><span class="s0">ultimos_10_años</span><span class="s3">:</span>
<a name="l645"><span class="ln">645  </span></a>    <span class="s0">year_dict </span><span class="s3">= {</span><span class="s4">'year'</span><span class="s3">: </span><span class="s0">year</span><span class="s3">}</span>
<a name="l646"><span class="ln">646  </span></a>    <span class="s0">total_year </span><span class="s3">= </span><span class="s5">0</span>
<a name="l647"><span class="ln">647  </span></a>
<a name="l648"><span class="ln">648  </span></a>    <span class="s1"># Iterate through filtered rows and extract CO2 values for each sector</span>
<a name="l649"><span class="ln">649  </span></a>    <span class="s2">for </span><span class="s0">_</span><span class="s3">, </span><span class="s0">row </span><span class="s2">in </span><span class="s0">df_sectores_filtrado</span><span class="s3">.</span><span class="s0">iterrows</span><span class="s3">():</span>
<a name="l650"><span class="ln">650  </span></a>        <span class="s0">sector_name </span><span class="s3">= </span><span class="s0">row</span><span class="s3">[</span><span class="s4">'Sector'</span><span class="s3">]</span>
<a name="l651"><span class="ln">651  </span></a>        <span class="s2">if </span><span class="s0">sector_name </span><span class="s2">in </span><span class="s0">sector_order</span><span class="s3">:</span>
<a name="l652"><span class="ln">652  </span></a>            <span class="s2">try</span><span class="s3">:</span>
<a name="l653"><span class="ln">653  </span></a>                <span class="s0">value </span><span class="s3">= </span><span class="s0">float</span><span class="s3">(</span><span class="s0">row</span><span class="s3">[</span><span class="s0">year</span><span class="s3">])</span>
<a name="l654"><span class="ln">654  </span></a>                <span class="s2">if </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">notna</span><span class="s3">(</span><span class="s0">value</span><span class="s3">) </span><span class="s2">and </span><span class="s0">value </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">:</span>
<a name="l655"><span class="ln">655  </span></a>                    <span class="s0">year_dict</span><span class="s3">[</span><span class="s0">sector_name</span><span class="s3">] = </span><span class="s0">value</span>
<a name="l656"><span class="ln">656  </span></a>                    <span class="s0">total_year </span><span class="s3">+= </span><span class="s0">value</span>
<a name="l657"><span class="ln">657  </span></a>                <span class="s2">else</span><span class="s3">:</span>
<a name="l658"><span class="ln">658  </span></a>                    <span class="s0">year_dict</span><span class="s3">[</span><span class="s0">sector_name</span><span class="s3">] = </span><span class="s5">0</span>
<a name="l659"><span class="ln">659  </span></a>            <span class="s2">except </span><span class="s0">Exception </span><span class="s2">as </span><span class="s0">e</span><span class="s3">:</span>
<a name="l660"><span class="ln">660  </span></a>                <span class="s0">print</span><span class="s3">(</span><span class="s4">f&quot;Error reading </span><span class="s2">{</span><span class="s0">sector_name</span><span class="s2">} </span><span class="s4">for year </span><span class="s2">{</span><span class="s0">year</span><span class="s2">}</span><span class="s4">: </span><span class="s2">{</span><span class="s0">e</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l661"><span class="ln">661  </span></a>                <span class="s0">year_dict</span><span class="s3">[</span><span class="s0">sector_name</span><span class="s3">] = </span><span class="s5">0</span>
<a name="l662"><span class="ln">662  </span></a>
<a name="l663"><span class="ln">663  </span></a>    <span class="s1"># Add the total emissions for that year</span>
<a name="l664"><span class="ln">664  </span></a>    <span class="s0">year_dict</span><span class="s3">[</span><span class="s4">'total'</span><span class="s3">] = </span><span class="s0">total_year</span>
<a name="l665"><span class="ln">665  </span></a>    <span class="s0">data_by_year</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s0">year_dict</span><span class="s3">)</span>
<a name="l666"><span class="ln">666  </span></a>
<a name="l667"><span class="ln">667  </span></a><span class="s1"># Create aggregated DataFrame</span>
<a name="l668"><span class="ln">668  </span></a><span class="s0">df_agg </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">DataFrame</span><span class="s3">(</span><span class="s0">data_by_year</span><span class="s3">)</span>
<a name="l669"><span class="ln">669  </span></a>
<a name="l670"><span class="ln">670  </span></a>
<a name="l671"><span class="ln">671  </span></a><span class="s1"># Find the maximum total emissions to scale the waffle charts</span>
<a name="l672"><span class="ln">672  </span></a><span class="s0">max_year_value </span><span class="s3">= </span><span class="s0">df_agg</span><span class="s3">[</span><span class="s4">'total'</span><span class="s3">].</span><span class="s0">max</span><span class="s3">()</span>
<a name="l673"><span class="ln">673  </span></a>
<a name="l674"><span class="ln">674  </span></a><span class="s1"># Create the figure layout with proper spacing</span>
<a name="l675"><span class="ln">675  </span></a><span class="s0">ncols </span><span class="s3">= </span><span class="s0">len</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">)</span>
<a name="l676"><span class="ln">676  </span></a><span class="s0">fig </span><span class="s3">= </span><span class="s0">plt</span><span class="s3">.</span><span class="s0">figure</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">24</span><span class="s3">, </span><span class="s5">8</span><span class="s3">))</span>
<a name="l677"><span class="ln">677  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">patch</span><span class="s3">.</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">'white'</span><span class="s3">)</span>
<a name="l678"><span class="ln">678  </span></a>
<a name="l679"><span class="ln">679  </span></a><span class="s1"># Use gridspec for better subplot layout control</span>
<a name="l680"><span class="ln">680  </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">gridspec </span><span class="s2">as </span><span class="s0">gridspec</span>
<a name="l681"><span class="ln">681  </span></a>
<a name="l682"><span class="ln">682  </span></a><span class="s0">gs </span><span class="s3">= </span><span class="s0">gridspec</span><span class="s3">.</span><span class="s0">GridSpec</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s0">ncols</span><span class="s3">, </span><span class="s0">figure</span><span class="s3">=</span><span class="s0">fig</span><span class="s3">,</span>
<a name="l683"><span class="ln">683  </span></a>                       <span class="s0">left</span><span class="s3">=</span><span class="s5">0.08</span><span class="s3">, </span><span class="s0">right</span><span class="s3">=</span><span class="s5">0.95</span><span class="s3">,</span>
<a name="l684"><span class="ln">684  </span></a>                       <span class="s0">bottom</span><span class="s3">=</span><span class="s5">0.15</span><span class="s3">, </span><span class="s0">top</span><span class="s3">=</span><span class="s5">0.82</span><span class="s3">,</span>
<a name="l685"><span class="ln">685  </span></a>                       <span class="s0">wspace</span><span class="s3">=</span><span class="s5">0.08</span><span class="s3">)</span>
<a name="l686"><span class="ln">686  </span></a>
<a name="l687"><span class="ln">687  </span></a><span class="s0">axs </span><span class="s3">= [</span><span class="s0">fig</span><span class="s3">.</span><span class="s0">add_subplot</span><span class="s3">(</span><span class="s0">gs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">, </span><span class="s0">i</span><span class="s3">]) </span><span class="s2">for </span><span class="s0">i </span><span class="s2">in </span><span class="s0">range</span><span class="s3">(</span><span class="s0">ncols</span><span class="s3">)]</span>
<a name="l688"><span class="ln">688  </span></a>
<a name="l689"><span class="ln">689  </span></a><span class="s1"># Create waffle charts for each year</span>
<a name="l690"><span class="ln">690  </span></a><span class="s2">for </span><span class="s0">idx</span><span class="s3">, (</span><span class="s0">year</span><span class="s3">, </span><span class="s0">ax</span><span class="s3">) </span><span class="s2">in </span><span class="s0">enumerate</span><span class="s3">(</span><span class="s0">zip</span><span class="s3">(</span><span class="s0">ultimos_10_años</span><span class="s3">, </span><span class="s0">axs</span><span class="s3">)):</span>
<a name="l691"><span class="ln">691  </span></a>    <span class="s1"># Extract emission data for that year in the defined order</span>
<a name="l692"><span class="ln">692  </span></a>    <span class="s0">year_data </span><span class="s3">= </span><span class="s0">df_agg</span><span class="s3">[</span><span class="s0">df_agg</span><span class="s3">[</span><span class="s4">'year'</span><span class="s3">] == </span><span class="s0">year</span><span class="s3">].</span><span class="s0">iloc</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
<a name="l693"><span class="ln">693  </span></a>
<a name="l694"><span class="ln">694  </span></a>    <span class="s0">values </span><span class="s3">= []</span>
<a name="l695"><span class="ln">695  </span></a>    <span class="s0">sector_names </span><span class="s3">= []</span>
<a name="l696"><span class="ln">696  </span></a>    <span class="s2">for </span><span class="s0">sector </span><span class="s2">in </span><span class="s0">sector_order</span><span class="s3">:</span>
<a name="l697"><span class="ln">697  </span></a>        <span class="s2">if </span><span class="s0">sector </span><span class="s2">in </span><span class="s0">year_data </span><span class="s2">and </span><span class="s0">year_data</span><span class="s3">[</span><span class="s0">sector</span><span class="s3">] &gt; </span><span class="s5">0</span><span class="s3">:</span>
<a name="l698"><span class="ln">698  </span></a>            <span class="s0">values</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s0">year_data</span><span class="s3">[</span><span class="s0">sector</span><span class="s3">])</span>
<a name="l699"><span class="ln">699  </span></a>            <span class="s0">sector_names</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s0">sector</span><span class="s3">)</span>
<a name="l700"><span class="ln">700  </span></a>
<a name="l701"><span class="ln">701  </span></a>    <span class="s1"># Sort values in descending order</span>
<a name="l702"><span class="ln">702  </span></a>    <span class="s0">sorted_indices </span><span class="s3">= </span><span class="s0">sorted</span><span class="s3">(</span><span class="s0">range</span><span class="s3">(</span><span class="s0">len</span><span class="s3">(</span><span class="s0">values</span><span class="s3">)), </span><span class="s0">key</span><span class="s3">=</span><span class="s2">lambda </span><span class="s0">i</span><span class="s3">: </span><span class="s0">values</span><span class="s3">[</span><span class="s0">i</span><span class="s3">], </span><span class="s0">reverse</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l703"><span class="ln">703  </span></a>    <span class="s0">values </span><span class="s3">= [</span><span class="s0">values</span><span class="s3">[</span><span class="s0">i</span><span class="s3">] </span><span class="s2">for </span><span class="s0">i </span><span class="s2">in </span><span class="s0">sorted_indices</span><span class="s3">]</span>
<a name="l704"><span class="ln">704  </span></a>
<a name="l705"><span class="ln">705  </span></a>    <span class="s1"># Compute total emissions for this year</span>
<a name="l706"><span class="ln">706  </span></a>    <span class="s0">total_current </span><span class="s3">= </span><span class="s0">sum</span><span class="s3">(</span><span class="s0">values</span><span class="s3">)</span>
<a name="l707"><span class="ln">707  </span></a>
<a name="l708"><span class="ln">708  </span></a>    <span class="s1"># Add white filler to reach the same height as the maximum year</span>
<a name="l709"><span class="ln">709  </span></a>    <span class="s0">values</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s0">max_year_value </span><span class="s3">- </span><span class="s0">total_current</span><span class="s3">)</span>
<a name="l710"><span class="ln">710  </span></a>
<a name="l711"><span class="ln">711  </span></a>    <span class="s1"># Sort colors to match values</span>
<a name="l712"><span class="ln">712  </span></a>    <span class="s0">current_colors </span><span class="s3">= [</span><span class="s0">colors</span><span class="s3">[</span><span class="s0">sector_order</span><span class="s3">.</span><span class="s0">index</span><span class="s3">(</span><span class="s0">sector_names</span><span class="s3">[</span><span class="s0">i</span><span class="s3">])] </span><span class="s2">for </span><span class="s0">i </span><span class="s2">in </span><span class="s0">sorted_indices</span><span class="s3">]</span>
<a name="l713"><span class="ln">713  </span></a>    <span class="s0">current_colors</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span><span class="s4">'white'</span><span class="s3">)</span>
<a name="l714"><span class="ln">714  </span></a>
<a name="l715"><span class="ln">715  </span></a>    <span class="s1"># Create the waffle plot</span>
<a name="l716"><span class="ln">716  </span></a>    <span class="s2">try</span><span class="s3">:</span>
<a name="l717"><span class="ln">717  </span></a>        <span class="s0">Waffle</span><span class="s3">.</span><span class="s0">make_waffle</span><span class="s3">(</span>
<a name="l718"><span class="ln">718  </span></a>            <span class="s0">ax</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">,</span>
<a name="l719"><span class="ln">719  </span></a>            <span class="s0">rows</span><span class="s3">=</span><span class="s5">50</span><span class="s3">,</span>
<a name="l720"><span class="ln">720  </span></a>            <span class="s0">columns</span><span class="s3">=</span><span class="s5">10</span><span class="s3">,</span>
<a name="l721"><span class="ln">721  </span></a>            <span class="s0">values</span><span class="s3">=</span><span class="s0">values</span><span class="s3">,</span>
<a name="l722"><span class="ln">722  </span></a>            <span class="s0">vertical</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
<a name="l723"><span class="ln">723  </span></a>            <span class="s0">colors</span><span class="s3">=</span><span class="s0">current_colors</span><span class="s3">,</span>
<a name="l724"><span class="ln">724  </span></a>            <span class="s0">block_arranging_style</span><span class="s3">=</span><span class="s4">'snake'</span><span class="s3">,</span>
<a name="l725"><span class="ln">725  </span></a>            <span class="s0">starting_location</span><span class="s3">=</span><span class="s4">'SW'</span><span class="s3">,</span>
<a name="l726"><span class="ln">726  </span></a>            <span class="s0">rounding_rule</span><span class="s3">=</span><span class="s4">'nearest'</span><span class="s3">,</span>
<a name="l727"><span class="ln">727  </span></a>            <span class="s0">interval_ratio_x</span><span class="s3">=</span><span class="s5">0.15</span><span class="s3">,</span>
<a name="l728"><span class="ln">728  </span></a>            <span class="s0">interval_ratio_y</span><span class="s3">=</span><span class="s5">0.15</span>
<a name="l729"><span class="ln">729  </span></a>        <span class="s3">)</span>
<a name="l730"><span class="ln">730  </span></a>    <span class="s2">except </span><span class="s0">Exception </span><span class="s2">as </span><span class="s0">e</span><span class="s3">:</span>
<a name="l731"><span class="ln">731  </span></a>        <span class="s0">print</span><span class="s3">(</span><span class="s4">f&quot;Error creating waffle for year </span><span class="s2">{</span><span class="s0">year</span><span class="s2">}</span><span class="s4">: </span><span class="s2">{</span><span class="s0">e</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l732"><span class="ln">732  </span></a>        <span class="s2">continue</span>
<a name="l733"><span class="ln">733  </span></a>
<a name="l734"><span class="ln">734  </span></a>    <span class="s1"># Add the year label below</span>
<a name="l735"><span class="ln">735  </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s0">x</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">, </span><span class="s0">y</span><span class="s3">=-</span><span class="s5">0.06</span><span class="s3">, </span><span class="s0">s</span><span class="s3">=</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">int</span><span class="s3">(</span><span class="s0">year</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">,</span>
<a name="l736"><span class="ln">736  </span></a>            <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">18</span><span class="s3">, </span><span class="s0">ha</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">,</span>
<a name="l737"><span class="ln">737  </span></a>            <span class="s0">transform</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">.</span><span class="s0">transAxes</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span><span class="s3">)</span>
<a name="l738"><span class="ln">738  </span></a>
<a name="l739"><span class="ln">739  </span></a>    <span class="s1"># Add total emission value above</span>
<a name="l740"><span class="ln">740  </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s0">x</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">, </span><span class="s0">y</span><span class="s3">=</span><span class="s5">1.04</span><span class="s3">, </span><span class="s0">s</span><span class="s3">=</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">int</span><span class="s3">(</span><span class="s0">total_current</span><span class="s3">)</span><span class="s2">:</span><span class="s4">,</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">,</span>
<a name="l741"><span class="ln">741  </span></a>            <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">14</span><span class="s3">, </span><span class="s0">ha</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">,</span>
<a name="l742"><span class="ln">742  </span></a>            <span class="s0">transform</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">.</span><span class="s0">transAxes</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span><span class="s3">)</span>
<a name="l743"><span class="ln">743  </span></a>
<a name="l744"><span class="ln">744  </span></a>    <span class="s1"># Remove default spines for a cleaner look</span>
<a name="l745"><span class="ln">745  </span></a>    <span class="s2">for </span><span class="s0">spine </span><span class="s2">in </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">.</span><span class="s0">values</span><span class="s3">():</span>
<a name="l746"><span class="ln">746  </span></a>        <span class="s0">spine</span><span class="s3">.</span><span class="s0">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l747"><span class="ln">747  </span></a>
<a name="l748"><span class="ln">748  </span></a>    <span class="s1"># Hide x and y ticks</span>
<a name="l749"><span class="ln">749  </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xticks</span><span class="s3">([])</span>
<a name="l750"><span class="ln">750  </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">tick_params</span><span class="s3">(</span><span class="s0">axis</span><span class="s3">=</span><span class="s4">'x'</span><span class="s3">, </span><span class="s0">length</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
<a name="l751"><span class="ln">751  </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">set_yticks</span><span class="s3">([])</span>
<a name="l752"><span class="ln">752  </span></a>
<a name="l753"><span class="ln">753  </span></a><span class="s1"># Add custom Y-axis to the first subplot</span>
<a name="l754"><span class="ln">754  </span></a><span class="s0">num_y_ticks </span><span class="s3">= </span><span class="s5">6</span>
<a name="l755"><span class="ln">755  </span></a><span class="s0">y_tick_values </span><span class="s3">= </span><span class="s0">np</span><span class="s3">.</span><span class="s0">linspace</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s0">max_year_value</span><span class="s3">, </span><span class="s0">num_y_ticks</span><span class="s3">)</span>
<a name="l756"><span class="ln">756  </span></a><span class="s0">y_tick_values </span><span class="s3">= [</span><span class="s0">int</span><span class="s3">(</span><span class="s0">val</span><span class="s3">) </span><span class="s2">for </span><span class="s0">val </span><span class="s2">in </span><span class="s0">y_tick_values</span><span class="s3">]</span>
<a name="l757"><span class="ln">757  </span></a>
<a name="l758"><span class="ln">758  </span></a><span class="s2">for </span><span class="s0">y_tick </span><span class="s2">in </span><span class="s0">y_tick_values</span><span class="s3">:</span>
<a name="l759"><span class="ln">759  </span></a>    <span class="s1"># Add tick label</span>
<a name="l760"><span class="ln">760  </span></a>    <span class="s0">axs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s0">text</span><span class="s3">(</span>
<a name="l761"><span class="ln">761  </span></a>        <span class="s0">x</span><span class="s3">=-</span><span class="s5">0.25</span><span class="s3">,</span>
<a name="l762"><span class="ln">762  </span></a>        <span class="s0">y</span><span class="s3">=</span><span class="s0">y_tick </span><span class="s3">/ </span><span class="s0">max_year_value</span><span class="s3">,</span>
<a name="l763"><span class="ln">763  </span></a>        <span class="s0">s</span><span class="s3">=</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">y_tick</span><span class="s2">:</span><span class="s4">,</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">,</span>
<a name="l764"><span class="ln">764  </span></a>        <span class="s0">size</span><span class="s3">=</span><span class="s5">11</span><span class="s3">,</span>
<a name="l765"><span class="ln">765  </span></a>        <span class="s0">va</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">,</span>
<a name="l766"><span class="ln">766  </span></a>        <span class="s0">ha</span><span class="s3">=</span><span class="s4">&quot;right&quot;</span><span class="s3">,</span>
<a name="l767"><span class="ln">767  </span></a>        <span class="s0">transform</span><span class="s3">=</span><span class="s0">axs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s0">transAxes</span><span class="s3">,</span>
<a name="l768"><span class="ln">768  </span></a>        <span class="s0">color</span><span class="s3">=</span><span class="s4">'#555555'</span>
<a name="l769"><span class="ln">769  </span></a>    <span class="s3">)</span>
<a name="l770"><span class="ln">770  </span></a>    <span class="s1"># Add small tick mark</span>
<a name="l771"><span class="ln">771  </span></a>    <span class="s0">axs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s0">axhline</span><span class="s3">(</span>
<a name="l772"><span class="ln">772  </span></a>        <span class="s0">y</span><span class="s3">=</span><span class="s0">y_tick </span><span class="s3">/ </span><span class="s0">max_year_value</span><span class="s3">,</span>
<a name="l773"><span class="ln">773  </span></a>        <span class="s0">xmin</span><span class="s3">=-</span><span class="s5">0.20</span><span class="s3">,</span>
<a name="l774"><span class="ln">774  </span></a>        <span class="s0">xmax</span><span class="s3">=-</span><span class="s5">0.08</span><span class="s3">,</span>
<a name="l775"><span class="ln">775  </span></a>        <span class="s0">clip_on</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
<a name="l776"><span class="ln">776  </span></a>        <span class="s0">color</span><span class="s3">=</span><span class="s4">&quot;#333333&quot;</span><span class="s3">,</span>
<a name="l777"><span class="ln">777  </span></a>        <span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.2</span><span class="s3">,</span>
<a name="l778"><span class="ln">778  </span></a>    <span class="s3">)</span>
<a name="l779"><span class="ln">779  </span></a>
<a name="l780"><span class="ln">780  </span></a><span class="s1"># Add vertical Y-axis line</span>
<a name="l781"><span class="ln">781  </span></a><span class="s0">axs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s0">axvline</span><span class="s3">(</span><span class="s0">x</span><span class="s3">=-</span><span class="s5">0.018</span><span class="s3">, </span><span class="s0">ymin</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s0">ymax</span><span class="s3">=</span><span class="s5">1.05</span><span class="s3">, </span><span class="s0">clip_on</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
<a name="l782"><span class="ln">782  </span></a>               <span class="s0">color</span><span class="s3">=</span><span class="s4">&quot;#333333&quot;</span><span class="s3">, </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.5</span><span class="s3">)</span>
<a name="l783"><span class="ln">783  </span></a>
<a name="l784"><span class="ln">784  </span></a><span class="s1"># Add Y-axis label</span>
<a name="l785"><span class="ln">785  </span></a><span class="s0">axs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s0">text</span><span class="s3">(</span>
<a name="l786"><span class="ln">786  </span></a>    <span class="s0">x</span><span class="s3">=-</span><span class="s5">0.70</span><span class="s3">,</span>
<a name="l787"><span class="ln">787  </span></a>    <span class="s0">y</span><span class="s3">=</span><span class="s5">0.5</span><span class="s3">,</span>
<a name="l788"><span class="ln">788  </span></a>    <span class="s0">s</span><span class="s3">=</span><span class="s4">'Million tonnes CO₂'</span><span class="s3">,</span>
<a name="l789"><span class="ln">789  </span></a>    <span class="s0">rotation</span><span class="s3">=</span><span class="s5">90</span><span class="s3">,</span>
<a name="l790"><span class="ln">790  </span></a>    <span class="s0">va</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">,</span>
<a name="l791"><span class="ln">791  </span></a>    <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">,</span>
<a name="l792"><span class="ln">792  </span></a>    <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">,</span>
<a name="l793"><span class="ln">793  </span></a>    <span class="s0">color</span><span class="s3">=</span><span class="s4">'#555555'</span><span class="s3">,</span>
<a name="l794"><span class="ln">794  </span></a>    <span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'600'</span><span class="s3">,</span>
<a name="l795"><span class="ln">795  </span></a>    <span class="s0">transform</span><span class="s3">=</span><span class="s0">axs</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s0">transAxes</span>
<a name="l796"><span class="ln">796  </span></a><span class="s3">)</span>
<a name="l797"><span class="ln">797  </span></a>
<a name="l798"><span class="ln">798  </span></a><span class="s1"># Add main title and subtitle</span>
<a name="l799"><span class="ln">799  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.94</span><span class="s3">, </span><span class="s4">'Global CO₂ Emissions by Sector'</span><span class="s3">,</span>
<a name="l800"><span class="ln">800  </span></a>         <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">28</span><span class="s3">, </span><span class="s0">fontweight</span><span class="s3">=</span><span class="s4">'bold'</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#2C3E50'</span><span class="s3">)</span>
<a name="l801"><span class="ln">801  </span></a>
<a name="l802"><span class="ln">802  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.88</span><span class="s3">, </span><span class="s4">'Million tonnes of CO₂ | Evolution from 2015 to 2024'</span><span class="s3">,</span>
<a name="l803"><span class="ln">803  </span></a>         <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">15</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">'#7F8C8D'</span><span class="s3">)</span>
<a name="l804"><span class="ln">804  </span></a>
<a name="l805"><span class="ln">805  </span></a><span class="s1"># Create and add improved manual legend</span>
<a name="l806"><span class="ln">806  </span></a><span class="s0">legend_elements </span><span class="s3">= []</span>
<a name="l807"><span class="ln">807  </span></a><span class="s2">for </span><span class="s0">i</span><span class="s3">, </span><span class="s0">sector </span><span class="s2">in </span><span class="s0">enumerate</span><span class="s3">(</span><span class="s0">sector_order</span><span class="s3">):</span>
<a name="l808"><span class="ln">808  </span></a>    <span class="s0">legend_elements</span><span class="s3">.</span><span class="s0">append</span><span class="s3">(</span>
<a name="l809"><span class="ln">809  </span></a>        <span class="s0">mpatches</span><span class="s3">.</span><span class="s0">Patch</span><span class="s3">(</span><span class="s0">facecolor</span><span class="s3">=</span><span class="s0">colors</span><span class="s3">[</span><span class="s0">i</span><span class="s3">], </span><span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">,</span>
<a name="l810"><span class="ln">810  </span></a>                       <span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.5</span><span class="s3">, </span><span class="s0">label</span><span class="s3">=</span><span class="s0">sector</span><span class="s3">)</span>
<a name="l811"><span class="ln">811  </span></a>    <span class="s3">)</span>
<a name="l812"><span class="ln">812  </span></a>
<a name="l813"><span class="ln">813  </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">legend</span><span class="s3">(</span><span class="s0">handles</span><span class="s3">=</span><span class="s0">legend_elements</span><span class="s3">,</span>
<a name="l814"><span class="ln">814  </span></a>           <span class="s0">loc</span><span class="s3">=</span><span class="s4">'lower center'</span><span class="s3">, </span><span class="s0">ncol</span><span class="s3">=</span><span class="s5">4</span><span class="s3">, </span><span class="s0">frameon</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
<a name="l815"><span class="ln">815  </span></a>           <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">, </span><span class="s0">bbox_to_anchor</span><span class="s3">=(</span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.02</span><span class="s3">),</span>
<a name="l816"><span class="ln">816  </span></a>           <span class="s0">columnspacing</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s0">handlelength</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s0">handletextpad</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
<a name="l817"><span class="ln">817  </span></a>
<a name="l818"><span class="ln">818  </span></a><span class="s1"># Save the final plot</span>
<a name="l819"><span class="ln">819  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">savefig</span><span class="s3">(</span><span class="s4">'../Graphs/co2_sectores_waffle.png'</span><span class="s3">, </span><span class="s0">dpi</span><span class="s3">=</span><span class="s5">300</span><span class="s3">, </span><span class="s0">bbox_inches</span><span class="s3">=</span><span class="s4">'tight'</span><span class="s3">,</span>
<a name="l820"><span class="ln">820  </span></a>            <span class="s0">facecolor</span><span class="s3">=</span><span class="s4">'white'</span><span class="s3">, </span><span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">'none'</span><span class="s3">, </span><span class="s0">pad_inches</span><span class="s3">=</span><span class="s5">0.4</span><span class="s3">)</span>
<a name="l821"><span class="ln">821  </span></a>
<a name="l822"><span class="ln">822  </span></a><span class="s1"># Show the figure</span>
<a name="l823"><span class="ln">823  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span>
<a name="l824"><span class="ln">824  </span></a><hr class="ls0"><a name="l825"><span class="ln">825  </span></a><span class="s0">#%% md 
<a name="l826"><span class="ln">826  </span></a>Al analizar las emisiones de CO₂ a nivel global, es crucial también entender cómo se distribuyen estas emisiones entre los continentes. En 2024, la mayor parte de las emisiones globales provienen de Asia, lo que refleja el peso de economías industriales como China, que sigue siendo el mayor emisor mundial. En contraste, África y América del Sur representan una porción mucho menor, a pesar de sus contribuciones crecientes debido al desarrollo económico y el aumento de las actividades industriales. Este gráfico ayuda a visualizar la disparidad en las emisiones entre continentes, lo cual es esencial para diseñar políticas específicas y estrategias de reducción de emisiones en diferentes regiones. <hr class="ls0"><a name="l827"><span class="ln">827  </span></a>#%% 
<a name="l828"><span class="ln">828  </span></a></span>
<a name="l829"><span class="ln">829  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l830"><span class="ln">830  </span></a><span class="s1"># Import required libraries</span>
<a name="l831"><span class="ln">831  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l832"><span class="ln">832  </span></a><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd          </span><span class="s1"># For structured data handling and analysis</span>
<a name="l833"><span class="ln">833  </span></a><span class="s2">import </span><span class="s0">numpy </span><span class="s2">as </span><span class="s0">np           </span><span class="s1"># For numerical computations</span>
<a name="l834"><span class="ln">834  </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt  </span><span class="s1"># For creating plots and figures</span>
<a name="l835"><span class="ln">835  </span></a><span class="s2">import </span><span class="s0">seaborn </span><span class="s2">as </span><span class="s0">sns        </span><span class="s1"># For enhanced, high-level visualization</span>
<a name="l836"><span class="ln">836  </span></a>
<a name="l837"><span class="ln">837  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l838"><span class="ln">838  </span></a><span class="s1"># Load the dataset</span>
<a name="l839"><span class="ln">839  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l840"><span class="ln">840  </span></a><span class="s1"># The Excel file is part of the EDGAR (Emissions Database for Global Atmospheric Research)</span>
<a name="l841"><span class="ln">841  </span></a><span class="s1"># global greenhouse gas dataset. It contains CO₂ emission totals by country.</span>
<a name="l842"><span class="ln">842  </span></a><span class="s0">archivo </span><span class="s3">= </span><span class="s4">'../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx'</span>
<a name="l843"><span class="ln">843  </span></a>
<a name="l844"><span class="ln">844  </span></a><span class="s1"># Read the worksheet containing total fossil CO₂ emissions by country</span>
<a name="l845"><span class="ln">845  </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">archivo</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'fossil_CO2_totals_by_country'</span><span class="s3">)</span>
<a name="l846"><span class="ln">846  </span></a>
<a name="l847"><span class="ln">847  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l848"><span class="ln">848  </span></a><span class="s1"># Data Cleaning — Exclude aggregated or non-country entries</span>
<a name="l849"><span class="ln">849  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l850"><span class="ln">850  </span></a><span class="s1"># The dataset includes global and regional aggregates (e.g., &quot;GLOBAL TOTAL&quot;,</span>
<a name="l851"><span class="ln">851  </span></a><span class="s1"># &quot;EU27&quot;, &quot;INTERNATIONAL SHIPPING&quot;, &quot;INTERNATIONAL AVIATION&quot;) that should</span>
<a name="l852"><span class="ln">852  </span></a><span class="s1"># be excluded to focus only on national-level data.</span>
<a name="l853"><span class="ln">853  </span></a><span class="s0">exclusions </span><span class="s3">= [</span><span class="s4">'GLOBAL TOTAL'</span><span class="s3">, </span><span class="s4">'EU27'</span><span class="s3">, </span><span class="s4">'INTERNATIONAL SHIPPING'</span><span class="s3">, </span><span class="s4">'INTERNATIONAL AVIATION'</span><span class="s3">]</span>
<a name="l854"><span class="ln">854  </span></a>
<a name="l855"><span class="ln">855  </span></a><span class="s1"># Create a Boolean mask to keep only country-level rows</span>
<a name="l856"><span class="ln">856  </span></a><span class="s0">mask </span><span class="s3">= ~</span><span class="s0">df</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">].</span><span class="s0">str</span><span class="s3">.</span><span class="s0">upper</span><span class="s3">().</span><span class="s0">isin</span><span class="s3">(</span><span class="s0">exclusions</span><span class="s3">)</span>
<a name="l857"><span class="ln">857  </span></a>
<a name="l858"><span class="ln">858  </span></a><span class="s1"># Apply the mask and create a clean copy of the DataFrame</span>
<a name="l859"><span class="ln">859  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df</span><span class="s3">[</span><span class="s0">mask</span><span class="s3">].</span><span class="s0">copy</span><span class="s3">()</span>
<a name="l860"><span class="ln">860  </span></a>
<a name="l861"><span class="ln">861  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l862"><span class="ln">862  </span></a><span class="s1"># Extract 2024 CO₂ emission values</span>
<a name="l863"><span class="ln">863  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l864"><span class="ln">864  </span></a><span class="s1"># Ensure that the dataset contains a column for the year 2024.</span>
<a name="l865"><span class="ln">865  </span></a><span class="s1"># Depending on how the data was exported, the column name might be</span>
<a name="l866"><span class="ln">866  </span></a><span class="s1"># stored as either an integer or a string, so this code handles both cases.</span>
<a name="l867"><span class="ln">867  </span></a><span class="s0">year_col </span><span class="s3">= </span><span class="s5">2024 </span><span class="s2">if </span><span class="s5">2024 </span><span class="s2">in </span><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">columns </span><span class="s2">else </span><span class="s4">'2024'</span>
<a name="l868"><span class="ln">868  </span></a>
<a name="l869"><span class="ln">869  </span></a><span class="s1"># Select only the country name and the corresponding 2024 emission value</span>
<a name="l870"><span class="ln">870  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[[</span><span class="s4">'Country'</span><span class="s3">, </span><span class="s0">year_col</span><span class="s3">]].</span><span class="s0">copy</span><span class="s3">()</span>
<a name="l871"><span class="ln">871  </span></a><span class="s0">df_countries</span><span class="s3">.</span><span class="s0">columns </span><span class="s3">= [</span><span class="s4">'Country'</span><span class="s3">, </span><span class="s4">'CO2_2024'</span><span class="s3">]</span>
<a name="l872"><span class="ln">872  </span></a>
<a name="l873"><span class="ln">873  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l874"><span class="ln">874  </span></a><span class="s1"># Filter out invalid or missing emission values</span>
<a name="l875"><span class="ln">875  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l876"><span class="ln">876  </span></a><span class="s1"># Keep only records with positive (non-zero) CO₂ emission values</span>
<a name="l877"><span class="ln">877  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">] &gt; </span><span class="s5">0</span><span class="s3">].</span><span class="s0">dropna</span><span class="s3">()</span>
<a name="l878"><span class="ln">878  </span></a>
<a name="l879"><span class="ln">879  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l880"><span class="ln">880  </span></a><span class="s1"># Map each country to its corresponding continent</span>
<a name="l881"><span class="ln">881  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l882"><span class="ln">882  </span></a><span class="s1"># The EDGAR dataset does not provide continent classification directly,</span>
<a name="l883"><span class="ln">883  </span></a><span class="s1"># so we manually define a mapping for representative countries.</span>
<a name="l884"><span class="ln">884  </span></a><span class="s1"># This mapping can be extended or automated in future versions</span>
<a name="l885"><span class="ln">885  </span></a><span class="s1"># using a standardized country-to-continent dataset.</span>
<a name="l886"><span class="ln">886  </span></a><span class="s0">continent_map </span><span class="s3">= {</span>
<a name="l887"><span class="ln">887  </span></a>    <span class="s4">'USA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'CANADA'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">, </span><span class="s4">'MEXICO'</span><span class="s3">: </span><span class="s4">'North America'</span><span class="s3">,</span>
<a name="l888"><span class="ln">888  </span></a>    <span class="s4">'BRAZIL'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'ARGENTINA'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">, </span><span class="s4">'CHILE'</span><span class="s3">: </span><span class="s4">'South America'</span><span class="s3">,</span>
<a name="l889"><span class="ln">889  </span></a>    <span class="s4">'GERMANY'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'UNITED KINGDOM'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">, </span><span class="s4">'FRANCE'</span><span class="s3">: </span><span class="s4">'Europe'</span><span class="s3">,</span>
<a name="l890"><span class="ln">890  </span></a>    <span class="s4">'CHINA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'INDIA'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">, </span><span class="s4">'JAPAN'</span><span class="s3">: </span><span class="s4">'Asia'</span><span class="s3">,</span>
<a name="l891"><span class="ln">891  </span></a>    <span class="s4">'SOUTH AFRICA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'EGYPT'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">, </span><span class="s4">'NIGERIA'</span><span class="s3">: </span><span class="s4">'Africa'</span><span class="s3">,</span>
<a name="l892"><span class="ln">892  </span></a>    <span class="s4">'AUSTRALIA'</span><span class="s3">: </span><span class="s4">'Oceania'</span><span class="s3">, </span><span class="s4">'NEW ZEALAND'</span><span class="s3">: </span><span class="s4">'Oceania'</span>
<a name="l893"><span class="ln">893  </span></a><span class="s3">}</span>
<a name="l894"><span class="ln">894  </span></a>
<a name="l895"><span class="ln">895  </span></a><span class="s1"># Convert all country names to uppercase and trim extra spaces</span>
<a name="l896"><span class="ln">896  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Country_Upper'</span><span class="s3">] = </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">].</span><span class="s0">str</span><span class="s3">.</span><span class="s0">upper</span><span class="s3">().</span><span class="s0">str</span><span class="s3">.</span><span class="s0">strip</span><span class="s3">()</span>
<a name="l897"><span class="ln">897  </span></a>
<a name="l898"><span class="ln">898  </span></a><span class="s1"># Map each country to its continent using the dictionary above</span>
<a name="l899"><span class="ln">899  </span></a><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Continent'</span><span class="s3">] = </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Country_Upper'</span><span class="s3">].</span><span class="s0">map</span><span class="s3">(</span><span class="s0">continent_map</span><span class="s3">)</span>
<a name="l900"><span class="ln">900  </span></a>
<a name="l901"><span class="ln">901  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l902"><span class="ln">902  </span></a><span class="s1"># Filter out countries with no continent assigned</span>
<a name="l903"><span class="ln">903  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l904"><span class="ln">904  </span></a><span class="s1"># Some countries may not appear in the manual mapping above.</span>
<a name="l905"><span class="ln">905  </span></a><span class="s1"># These are excluded from the analysis to ensure consistency.</span>
<a name="l906"><span class="ln">906  </span></a><span class="s0">df_countries </span><span class="s3">= </span><span class="s0">df_countries</span><span class="s3">[</span><span class="s0">df_countries</span><span class="s3">[</span><span class="s4">'Continent'</span><span class="s3">].</span><span class="s0">notna</span><span class="s3">()].</span><span class="s0">copy</span><span class="s3">()</span>
<a name="l907"><span class="ln">907  </span></a>
<a name="l908"><span class="ln">908  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l909"><span class="ln">909  </span></a><span class="s1"># Aggregate total CO₂ emissions by continent</span>
<a name="l910"><span class="ln">910  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l911"><span class="ln">911  </span></a><span class="s1"># Group all countries belonging to the same continent</span>
<a name="l912"><span class="ln">912  </span></a><span class="s1"># and sum their emission values to obtain continental totals.</span>
<a name="l913"><span class="ln">913  </span></a><span class="s0">continent_totals </span><span class="s3">= (</span>
<a name="l914"><span class="ln">914  </span></a>    <span class="s0">df_countries</span>
<a name="l915"><span class="ln">915  </span></a>    <span class="s3">.</span><span class="s0">groupby</span><span class="s3">(</span><span class="s4">'Continent'</span><span class="s3">)[</span><span class="s4">'CO2_2024'</span><span class="s3">]</span>
<a name="l916"><span class="ln">916  </span></a>    <span class="s3">.</span><span class="s0">sum</span><span class="s3">()</span>
<a name="l917"><span class="ln">917  </span></a>    <span class="s3">.</span><span class="s0">reset_index</span><span class="s3">()</span>
<a name="l918"><span class="ln">918  </span></a><span class="s3">)</span>
<a name="l919"><span class="ln">919  </span></a>
<a name="l920"><span class="ln">920  </span></a><span class="s1"># Calculate the relative contribution (%) of each continent</span>
<a name="l921"><span class="ln">921  </span></a><span class="s0">continent_totals</span><span class="s3">[</span><span class="s4">'Percentage'</span><span class="s3">] = (</span>
<a name="l922"><span class="ln">922  </span></a>    <span class="s0">continent_totals</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">] /</span>
<a name="l923"><span class="ln">923  </span></a>    <span class="s0">continent_totals</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">].</span><span class="s0">sum</span><span class="s3">()</span>
<a name="l924"><span class="ln">924  </span></a><span class="s3">) * </span><span class="s5">100</span>
<a name="l925"><span class="ln">925  </span></a>
<a name="l926"><span class="ln">926  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l927"><span class="ln">927  </span></a><span class="s1"># Visualization — Bar Plot of CO₂ Emissions by Continent</span>
<a name="l928"><span class="ln">928  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l929"><span class="ln">929  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">figure</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">12</span><span class="s3">, </span><span class="s5">8</span><span class="s3">))</span>
<a name="l930"><span class="ln">930  </span></a>
<a name="l931"><span class="ln">931  </span></a><span class="s1"># Create a color-coded bar chart using Seaborn</span>
<a name="l932"><span class="ln">932  </span></a><span class="s1"># Each bar represents the total CO₂ emissions for a continent in 2024.</span>
<a name="l933"><span class="ln">933  </span></a><span class="s0">sns</span><span class="s3">.</span><span class="s0">barplot</span><span class="s3">(</span>
<a name="l934"><span class="ln">934  </span></a>    <span class="s0">x</span><span class="s3">=</span><span class="s4">'Continent'</span><span class="s3">,</span>
<a name="l935"><span class="ln">935  </span></a>    <span class="s0">y</span><span class="s3">=</span><span class="s4">'CO2_2024'</span><span class="s3">,</span>
<a name="l936"><span class="ln">936  </span></a>    <span class="s0">data</span><span class="s3">=</span><span class="s0">continent_totals</span><span class="s3">,</span>
<a name="l937"><span class="ln">937  </span></a>    <span class="s0">palette</span><span class="s3">=</span><span class="s4">'Set2'</span>
<a name="l938"><span class="ln">938  </span></a><span class="s3">)</span>
<a name="l939"><span class="ln">939  </span></a>
<a name="l940"><span class="ln">940  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l941"><span class="ln">941  </span></a><span class="s1"># Add descriptive labels and title</span>
<a name="l942"><span class="ln">942  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l943"><span class="ln">943  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">title</span><span class="s3">(</span><span class="s4">'CO₂ Emissions by Continent (2024)'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">18</span><span class="s3">)</span>
<a name="l944"><span class="ln">944  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">xlabel</span><span class="s3">(</span><span class="s4">'Continent'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">14</span><span class="s3">)</span>
<a name="l945"><span class="ln">945  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">ylabel</span><span class="s3">(</span><span class="s4">'CO₂ Emissions (Million Tonnes)'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">14</span><span class="s3">)</span>
<a name="l946"><span class="ln">946  </span></a>
<a name="l947"><span class="ln">947  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l948"><span class="ln">948  </span></a><span class="s1"># Annotate each bar with its percentage contribution</span>
<a name="l949"><span class="ln">949  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l950"><span class="ln">950  </span></a><span class="s1"># Place the text label slightly above each bar to indicate</span>
<a name="l951"><span class="ln">951  </span></a><span class="s1"># the share (%) of global emissions for that continent.</span>
<a name="l952"><span class="ln">952  </span></a><span class="s2">for </span><span class="s0">i</span><span class="s3">, </span><span class="s0">row </span><span class="s2">in </span><span class="s0">continent_totals</span><span class="s3">.</span><span class="s0">iterrows</span><span class="s3">():</span>
<a name="l953"><span class="ln">953  </span></a>    <span class="s0">plt</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span>
<a name="l954"><span class="ln">954  </span></a>        <span class="s0">i</span><span class="s3">,                             </span><span class="s1"># X position (bar index)</span>
<a name="l955"><span class="ln">955  </span></a>        <span class="s0">row</span><span class="s3">[</span><span class="s4">'CO2_2024'</span><span class="s3">] + </span><span class="s5">50</span><span class="s3">,          </span><span class="s1"># Y position (slightly above bar height)</span>
<a name="l956"><span class="ln">956  </span></a>        <span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">row</span><span class="s3">[</span><span class="s4">'Percentage'</span><span class="s3">]</span><span class="s2">:</span><span class="s4">.1f</span><span class="s2">}</span><span class="s4">%&quot;</span><span class="s3">,   </span><span class="s1"># Text showing percentage with one decimal</span>
<a name="l957"><span class="ln">957  </span></a>        <span class="s0">ha</span><span class="s3">=</span><span class="s4">'center'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span>
<a name="l958"><span class="ln">958  </span></a>    <span class="s3">)</span>
<a name="l959"><span class="ln">959  </span></a>
<a name="l960"><span class="ln">960  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l961"><span class="ln">961  </span></a><span class="s1"># Final adjustments and export</span>
<a name="l962"><span class="ln">962  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l963"><span class="ln">963  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">xticks</span><span class="s3">(</span><span class="s0">rotation</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)   </span><span class="s1"># Keep x-axis labels horizontal</span>
<a name="l964"><span class="ln">964  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">tight_layout</span><span class="s3">()       </span><span class="s1"># Optimize spacing to prevent label overlap</span>
<a name="l965"><span class="ln">965  </span></a>
<a name="l966"><span class="ln">966  </span></a><span class="s1"># Save the figure as a high-resolution PNG</span>
<a name="l967"><span class="ln">967  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">savefig</span><span class="s3">(</span>
<a name="l968"><span class="ln">968  </span></a>    <span class="s4">&quot;../Graphs/CO2_Emissions_by_Continent_(2024)&quot;</span><span class="s3">,</span>
<a name="l969"><span class="ln">969  </span></a>    <span class="s0">dpi</span><span class="s3">=</span><span class="s5">300</span><span class="s3">,</span>
<a name="l970"><span class="ln">970  </span></a>    <span class="s0">bbox_inches</span><span class="s3">=</span><span class="s4">&quot;tight&quot;</span>
<a name="l971"><span class="ln">971  </span></a><span class="s3">)</span>
<a name="l972"><span class="ln">972  </span></a>
<a name="l973"><span class="ln">973  </span></a><span class="s1"># Display the final chart</span>
<a name="l974"><span class="ln">974  </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span>
<a name="l975"><span class="ln">975  </span></a><hr class="ls0"><a name="l976"><span class="ln">976  </span></a><span class="s0">#%% md 
<a name="l977"><span class="ln">977  </span></a>Además de la distribución de las emisiones de CO₂ a nivel global y por sectores, es crucial entender la relación entre las emisiones per cápita de CO₂ y el desarrollo humano, específicamente la esperanza de vida. El gráfico siguiente muestra cómo, en general, los países con mayores emisiones de CO₂ per cápita tienden a tener una mayor esperanza de vida. Esto refleja la correlación entre el desarrollo económico, la disponibilidad de recursos y los niveles de calidad de vida en países de mayor ingreso. Sin embargo, también se observa que algunos países con menores emisiones per cápita, particularmente en África y Asia, tienen una esperanza de vida más baja. Esta relación subraya cómo las decisiones económicas y ambientales impactan directamente la salud y bienestar de las poblaciones. <hr class="ls0"><a name="l978"><span class="ln">978  </span></a>#%% 
<a name="l979"><span class="ln">979  </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l980"><span class="ln">980  </span></a><span class="s2">import </span><span class="s0">numpy </span><span class="s2">as </span><span class="s0">np</span>
<a name="l981"><span class="ln">981  </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt</span>
<a name="l982"><span class="ln">982  </span></a><span class="s2">import </span><span class="s0">seaborn </span><span class="s2">as </span><span class="s0">sns</span>
<a name="l983"><span class="ln">983  </span></a>
<a name="l984"><span class="ln">984  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l985"><span class="ln">985  </span></a><span class="s1"># Load the dataset</span>
<a name="l986"><span class="ln">986  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l987"><span class="ln">987  </span></a><span class="s1"># The dataset comes from Our World in Data (OWID) and contains</span>
<a name="l988"><span class="ln">988  </span></a><span class="s1"># information on life expectancy and CO₂ emissions per capita.</span>
<a name="l989"><span class="ln">989  </span></a><span class="s1"># It is used to explore potential correlations between human</span>
<a name="l990"><span class="ln">990  </span></a><span class="s1"># development (life expectancy) and carbon emissions.</span>
<a name="l991"><span class="ln">991  </span></a><span class="s0">input_file_path </span><span class="s3">= </span><span class="s4">'../Datos/life-expectancy-at-birth-vs-co-emissions-per-capita.xlsx'</span>
<a name="l992"><span class="ln">992  </span></a>
<a name="l993"><span class="ln">993  </span></a><span class="s1"># Read the Excel sheet containing life expectancy vs CO₂ emissions data</span>
<a name="l994"><span class="ln">994  </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">input_file_path</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'life-expectancy-at-birth-vs-co-'</span><span class="s3">)</span>
<a name="l995"><span class="ln">995  </span></a>
<a name="l996"><span class="ln">996  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l997"><span class="ln">997  </span></a><span class="s1"># Filter data for the most recent year (2023)</span>
<a name="l998"><span class="ln">998  </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l999"><span class="ln">999  </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df</span><span class="s3">[</span><span class="s0">df</span><span class="s3">[</span><span class="s4">'Year'</span><span class="s3">] == </span><span class="s5">2023</span><span class="s3">]</span>
<a name="l1000"><span class="ln">1000 </span></a>
<a name="l1001"><span class="ln">1001 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1002"><span class="ln">1002 </span></a><span class="s1"># Select relevant columns</span>
<a name="l1003"><span class="ln">1003 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1004"><span class="ln">1004 </span></a><span class="s1"># Keep only the variables of interest:</span>
<a name="l1005"><span class="ln">1005 </span></a><span class="s1">#   - Country (Entity)</span>
<a name="l1006"><span class="ln">1006 </span></a><span class="s1">#   - Life expectancy at birth</span>
<a name="l1007"><span class="ln">1007 </span></a><span class="s1">#   - CO₂ emissions per capita (in tonnes)</span>
<a name="l1008"><span class="ln">1008 </span></a><span class="s1">#   - Geographical region (as classified by OWID)</span>
<a name="l1009"><span class="ln">1009 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">[[</span>
<a name="l1010"><span class="ln">1010 </span></a>    <span class="s4">'Entity'</span><span class="s3">,</span>
<a name="l1011"><span class="ln">1011 </span></a>    <span class="s4">'Life expectancy - Sex: all - Age: 0 - Variant: estimates'</span><span class="s3">,</span>
<a name="l1012"><span class="ln">1012 </span></a>    <span class="s4">'Carbon dioxide (CO2) emissions excluding LULUCF per capita (t CO2e/capita)'</span><span class="s3">,</span>
<a name="l1013"><span class="ln">1013 </span></a>    <span class="s4">'World regions according to OWID'</span>
<a name="l1014"><span class="ln">1014 </span></a><span class="s3">]]</span>
<a name="l1015"><span class="ln">1015 </span></a>
<a name="l1016"><span class="ln">1016 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1017"><span class="ln">1017 </span></a><span class="s1"># Rename columns for clarity</span>
<a name="l1018"><span class="ln">1018 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1019"><span class="ln">1019 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">.</span><span class="s0">rename</span><span class="s3">(</span><span class="s0">columns</span><span class="s3">={</span>
<a name="l1020"><span class="ln">1020 </span></a>    <span class="s4">'Entity'</span><span class="s3">: </span><span class="s4">'Country'</span><span class="s3">,</span>
<a name="l1021"><span class="ln">1021 </span></a>    <span class="s4">'Life expectancy - Sex: all - Age: 0 - Variant: estimates'</span><span class="s3">: </span><span class="s4">'Life expectancy'</span><span class="s3">,</span>
<a name="l1022"><span class="ln">1022 </span></a>    <span class="s4">'Carbon dioxide (CO2) emissions excluding LULUCF per capita (t CO2e/capita)'</span><span class="s3">: </span><span class="s4">'CO2 emissions per capita'</span><span class="s3">,</span>
<a name="l1023"><span class="ln">1023 </span></a>    <span class="s4">'World regions according to OWID'</span><span class="s3">: </span><span class="s4">'Region'</span>
<a name="l1024"><span class="ln">1024 </span></a><span class="s3">})</span>
<a name="l1025"><span class="ln">1025 </span></a>
<a name="l1026"><span class="ln">1026 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1027"><span class="ln">1027 </span></a><span class="s1"># Remove missing or invalid data</span>
<a name="l1028"><span class="ln">1028 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1029"><span class="ln">1029 </span></a><span class="s1"># Any row that lacks data for life expectancy or CO₂ emissions</span>
<a name="l1030"><span class="ln">1030 </span></a><span class="s1"># is excluded to ensure reliable analysis and visualization.</span>
<a name="l1031"><span class="ln">1031 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">.</span><span class="s0">dropna</span><span class="s3">(</span><span class="s0">subset</span><span class="s3">=[</span><span class="s4">'Life expectancy'</span><span class="s3">, </span><span class="s4">'CO2 emissions per capita'</span><span class="s3">])</span>
<a name="l1032"><span class="ln">1032 </span></a>
<a name="l1033"><span class="ln">1033 </span></a><span class="s1"># (This redundant assignment is retained for consistency, though it has no effect)</span>
<a name="l1034"><span class="ln">1034 </span></a><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Life expectancy'</span><span class="s3">] = </span><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Life expectancy'</span><span class="s3">]</span>
<a name="l1035"><span class="ln">1035 </span></a>
<a name="l1036"><span class="ln">1036 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1037"><span class="ln">1037 </span></a><span class="s1"># Define a color palette for world regions</span>
<a name="l1038"><span class="ln">1038 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1039"><span class="ln">1039 </span></a><span class="s1"># A distinct color is assigned to each world region to improve</span>
<a name="l1040"><span class="ln">1040 </span></a><span class="s1"># readability of the scatter plot.</span>
<a name="l1041"><span class="ln">1041 </span></a><span class="s0">region_colors </span><span class="s3">= </span><span class="s0">sns</span><span class="s3">.</span><span class="s0">color_palette</span><span class="s3">(</span><span class="s4">&quot;Set1&quot;</span><span class="s3">, </span><span class="s0">len</span><span class="s3">(</span><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Region'</span><span class="s3">].</span><span class="s0">unique</span><span class="s3">()))</span>
<a name="l1042"><span class="ln">1042 </span></a>
<a name="l1043"><span class="ln">1043 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1044"><span class="ln">1044 </span></a><span class="s1"># Create the scatter plot</span>
<a name="l1045"><span class="ln">1045 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1046"><span class="ln">1046 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">figure</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">10</span><span class="s3">, </span><span class="s5">6</span><span class="s3">))</span>
<a name="l1047"><span class="ln">1047 </span></a><span class="s0">sns</span><span class="s3">.</span><span class="s0">set</span><span class="s3">(</span><span class="s0">style</span><span class="s3">=</span><span class="s4">&quot;whitegrid&quot;</span><span class="s3">)</span>
<a name="l1048"><span class="ln">1048 </span></a>
<a name="l1049"><span class="ln">1049 </span></a><span class="s1"># Plot one group (region) at a time with a different color</span>
<a name="l1050"><span class="ln">1050 </span></a><span class="s2">for </span><span class="s0">i</span><span class="s3">, </span><span class="s0">region </span><span class="s2">in </span><span class="s0">enumerate</span><span class="s3">(</span><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Region'</span><span class="s3">].</span><span class="s0">unique</span><span class="s3">()):</span>
<a name="l1051"><span class="ln">1051 </span></a>    <span class="s0">region_data </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">[</span><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Region'</span><span class="s3">] == </span><span class="s0">region</span><span class="s3">]</span>
<a name="l1052"><span class="ln">1052 </span></a>    <span class="s0">plt</span><span class="s3">.</span><span class="s0">scatter</span><span class="s3">(</span>
<a name="l1053"><span class="ln">1053 </span></a>        <span class="s0">region_data</span><span class="s3">[</span><span class="s4">'CO2 emissions per capita'</span><span class="s3">],</span>
<a name="l1054"><span class="ln">1054 </span></a>        <span class="s0">region_data</span><span class="s3">[</span><span class="s4">'Life expectancy'</span><span class="s3">],</span>
<a name="l1055"><span class="ln">1055 </span></a>        <span class="s0">label</span><span class="s3">=</span><span class="s0">region</span><span class="s3">,</span>
<a name="l1056"><span class="ln">1056 </span></a>        <span class="s0">color</span><span class="s3">=</span><span class="s0">region_colors</span><span class="s3">[</span><span class="s0">i</span><span class="s3">],</span>
<a name="l1057"><span class="ln">1057 </span></a>        <span class="s0">alpha</span><span class="s3">=</span><span class="s5">0.7</span><span class="s3">,   </span><span class="s1"># Slight transparency for overlapping points</span>
<a name="l1058"><span class="ln">1058 </span></a>        <span class="s0">s</span><span class="s3">=</span><span class="s5">100        </span><span class="s1"># Marker size</span>
<a name="l1059"><span class="ln">1059 </span></a>    <span class="s3">)</span>
<a name="l1060"><span class="ln">1060 </span></a>
<a name="l1061"><span class="ln">1061 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1062"><span class="ln">1062 </span></a><span class="s1"># Configure plot appearance</span>
<a name="l1063"><span class="ln">1063 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1064"><span class="ln">1064 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">xscale</span><span class="s3">(</span><span class="s4">'log'</span><span class="s3">)  </span><span class="s1"># Logarithmic X-axis helps visualize wide emission ranges</span>
<a name="l1065"><span class="ln">1065 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">title</span><span class="s3">(</span><span class="s4">'Life Expectancy vs CO$_2$ Emissions per Capita (2023)'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">16</span><span class="s3">)</span>
<a name="l1066"><span class="ln">1066 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">xlabel</span><span class="s3">(</span><span class="s4">'CO$_2$ emissions per capita (tonnes)'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">)</span>
<a name="l1067"><span class="ln">1067 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">ylabel</span><span class="s3">(</span><span class="s4">'Life expectancy at birth (years)'</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">12</span><span class="s3">)</span>
<a name="l1068"><span class="ln">1068 </span></a>
<a name="l1069"><span class="ln">1069 </span></a><span class="s1"># Add legend identifying regions</span>
<a name="l1070"><span class="ln">1070 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">legend</span><span class="s3">(</span><span class="s0">title</span><span class="s3">=</span><span class="s4">'Region'</span><span class="s3">, </span><span class="s0">bbox_to_anchor</span><span class="s3">=(</span><span class="s5">1.05</span><span class="s3">, </span><span class="s5">1</span><span class="s3">), </span><span class="s0">loc</span><span class="s3">=</span><span class="s4">'upper left'</span><span class="s3">)</span>
<a name="l1071"><span class="ln">1071 </span></a>
<a name="l1072"><span class="ln">1072 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1073"><span class="ln">1073 </span></a><span class="s1"># Save and display the figure</span>
<a name="l1074"><span class="ln">1074 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1075"><span class="ln">1075 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">tight_layout</span><span class="s3">()  </span><span class="s1"># Optimize layout to avoid overlap</span>
<a name="l1076"><span class="ln">1076 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">savefig</span><span class="s3">(</span>
<a name="l1077"><span class="ln">1077 </span></a>    <span class="s4">&quot;../Graphs/Life_Expectancy_vs_CO2_Emissions_per_Capita_(2023).png&quot;</span><span class="s3">,</span>
<a name="l1078"><span class="ln">1078 </span></a>    <span class="s0">dpi</span><span class="s3">=</span><span class="s5">300</span><span class="s3">,</span>
<a name="l1079"><span class="ln">1079 </span></a>    <span class="s0">bbox_inches</span><span class="s3">=</span><span class="s4">&quot;tight&quot;</span>
<a name="l1080"><span class="ln">1080 </span></a><span class="s3">)</span>
<a name="l1081"><span class="ln">1081 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span>
<a name="l1082"><span class="ln">1082 </span></a><hr class="ls0"><a name="l1083"><span class="ln">1083 </span></a><span class="s0">#%% 
<a name="l1084"><span class="ln">1084 </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l1085"><span class="ln">1085 </span></a><span class="s2">import </span><span class="s0">plotly</span><span class="s3">.</span><span class="s0">express </span><span class="s2">as </span><span class="s0">px</span>
<a name="l1086"><span class="ln">1086 </span></a>
<a name="l1087"><span class="ln">1087 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1088"><span class="ln">1088 </span></a><span class="s1"># Load the dataset</span>
<a name="l1089"><span class="ln">1089 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1090"><span class="ln">1090 </span></a><span class="s1"># The dataset is sourced from Our World in Data (OWID) and provides</span>
<a name="l1091"><span class="ln">1091 </span></a><span class="s1"># information on life expectancy at birth and CO₂ emissions per capita</span>
<a name="l1092"><span class="ln">1092 </span></a><span class="s1"># for multiple countries and regions worldwide.</span>
<a name="l1093"><span class="ln">1093 </span></a><span class="s1"># The goal is to explore the potential relationship between these two variables.</span>
<a name="l1094"><span class="ln">1094 </span></a><span class="s0">input_file_path </span><span class="s3">= </span><span class="s4">'../Datos/life-expectancy-at-birth-vs-co-emissions-per-capita.xlsx'</span>
<a name="l1095"><span class="ln">1095 </span></a>
<a name="l1096"><span class="ln">1096 </span></a><span class="s1"># Read the Excel file and specify the relevant sheet</span>
<a name="l1097"><span class="ln">1097 </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">input_file_path</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s4">'life-expectancy-at-birth-vs-co-'</span><span class="s3">)</span>
<a name="l1098"><span class="ln">1098 </span></a>
<a name="l1099"><span class="ln">1099 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1100"><span class="ln">1100 </span></a><span class="s1"># Filter data for the year 2023</span>
<a name="l1101"><span class="ln">1101 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1102"><span class="ln">1102 </span></a><span class="s1"># Selecting only the most recent year allows us to focus on</span>
<a name="l1103"><span class="ln">1103 </span></a><span class="s1"># the current global state rather than temporal trends.</span>
<a name="l1104"><span class="ln">1104 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df</span><span class="s3">[</span><span class="s0">df</span><span class="s3">[</span><span class="s4">'Year'</span><span class="s3">] == </span><span class="s5">2023</span><span class="s3">]</span>
<a name="l1105"><span class="ln">1105 </span></a>
<a name="l1106"><span class="ln">1106 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1107"><span class="ln">1107 </span></a><span class="s1"># Select relevant variables</span>
<a name="l1108"><span class="ln">1108 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1109"><span class="ln">1109 </span></a><span class="s1"># Only keep the columns that are necessary for the analysis:</span>
<a name="l1110"><span class="ln">1110 </span></a><span class="s1">#   - Country name</span>
<a name="l1111"><span class="ln">1111 </span></a><span class="s1">#   - Life expectancy at birth</span>
<a name="l1112"><span class="ln">1112 </span></a><span class="s1">#   - CO₂ emissions per capita</span>
<a name="l1113"><span class="ln">1113 </span></a><span class="s1">#   - World region (used for color grouping in the visualization)</span>
<a name="l1114"><span class="ln">1114 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">[[</span>
<a name="l1115"><span class="ln">1115 </span></a>    <span class="s4">'Entity'</span><span class="s3">,</span>
<a name="l1116"><span class="ln">1116 </span></a>    <span class="s4">'Life expectancy - Sex: all - Age: 0 - Variant: estimates'</span><span class="s3">,</span>
<a name="l1117"><span class="ln">1117 </span></a>    <span class="s4">'Carbon dioxide (CO2) emissions excluding LULUCF per capita (t CO2e/capita)'</span><span class="s3">,</span>
<a name="l1118"><span class="ln">1118 </span></a>    <span class="s4">'World regions according to OWID'</span>
<a name="l1119"><span class="ln">1119 </span></a><span class="s3">]]</span>
<a name="l1120"><span class="ln">1120 </span></a>
<a name="l1121"><span class="ln">1121 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1122"><span class="ln">1122 </span></a><span class="s1"># Rename columns for readability</span>
<a name="l1123"><span class="ln">1123 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1124"><span class="ln">1124 </span></a><span class="s1"># Shorter and clearer names are used to simplify data handling and improve plot labels.</span>
<a name="l1125"><span class="ln">1125 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">.</span><span class="s0">rename</span><span class="s3">(</span><span class="s0">columns</span><span class="s3">={</span>
<a name="l1126"><span class="ln">1126 </span></a>    <span class="s4">'Entity'</span><span class="s3">: </span><span class="s4">'Country'</span><span class="s3">,</span>
<a name="l1127"><span class="ln">1127 </span></a>    <span class="s4">'Life expectancy - Sex: all - Age: 0 - Variant: estimates'</span><span class="s3">: </span><span class="s4">'Life expectancy'</span><span class="s3">,</span>
<a name="l1128"><span class="ln">1128 </span></a>    <span class="s4">'Carbon dioxide (CO2) emissions excluding LULUCF per capita (t CO2e/capita)'</span><span class="s3">: </span><span class="s4">'CO2 emissions per capita'</span><span class="s3">,</span>
<a name="l1129"><span class="ln">1129 </span></a>    <span class="s4">'World regions according to OWID'</span><span class="s3">: </span><span class="s4">'Region'</span>
<a name="l1130"><span class="ln">1130 </span></a><span class="s3">})</span>
<a name="l1131"><span class="ln">1131 </span></a>
<a name="l1132"><span class="ln">1132 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1133"><span class="ln">1133 </span></a><span class="s1"># Clean missing data</span>
<a name="l1134"><span class="ln">1134 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1135"><span class="ln">1135 </span></a><span class="s1"># Remove any entries that lack essential information</span>
<a name="l1136"><span class="ln">1136 </span></a><span class="s1"># (either life expectancy or CO₂ emissions data).</span>
<a name="l1137"><span class="ln">1137 </span></a><span class="s0">df_2023 </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">.</span><span class="s0">dropna</span><span class="s3">(</span><span class="s0">subset</span><span class="s3">=[</span><span class="s4">'Life expectancy'</span><span class="s3">, </span><span class="s4">'CO2 emissions per capita'</span><span class="s3">])</span>
<a name="l1138"><span class="ln">1138 </span></a>
<a name="l1139"><span class="ln">1139 </span></a><span class="s1"># Also remove rows with missing or empty 'Region' values,</span>
<a name="l1140"><span class="ln">1140 </span></a><span class="s1"># ensuring consistent grouping in the visualization.</span>
<a name="l1141"><span class="ln">1141 </span></a><span class="s0">df_2023_cleaned </span><span class="s3">= </span><span class="s0">df_2023</span><span class="s3">[</span><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Region'</span><span class="s3">].</span><span class="s0">notna</span><span class="s3">() &amp; (</span><span class="s0">df_2023</span><span class="s3">[</span><span class="s4">'Region'</span><span class="s3">] != </span><span class="s4">''</span><span class="s3">)]</span>
<a name="l1142"><span class="ln">1142 </span></a>
<a name="l1143"><span class="ln">1143 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1144"><span class="ln">1144 </span></a><span class="s1"># Create an interactive scatter plot using Plotly</span>
<a name="l1145"><span class="ln">1145 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1146"><span class="ln">1146 </span></a><span class="s1"># Each point represents a country, colored by its world region.</span>
<a name="l1147"><span class="ln">1147 </span></a><span class="s1"># The X-axis uses a logarithmic scale to better visualize the</span>
<a name="l1148"><span class="ln">1148 </span></a><span class="s1"># wide range of CO₂ emission values across countries.</span>
<a name="l1149"><span class="ln">1149 </span></a><span class="s0">fig </span><span class="s3">= </span><span class="s0">px</span><span class="s3">.</span><span class="s0">scatter</span><span class="s3">(</span>
<a name="l1150"><span class="ln">1150 </span></a>    <span class="s0">df_2023_cleaned</span><span class="s3">,</span>
<a name="l1151"><span class="ln">1151 </span></a>    <span class="s0">x</span><span class="s3">=</span><span class="s4">'CO2 emissions per capita'</span><span class="s3">,</span>
<a name="l1152"><span class="ln">1152 </span></a>    <span class="s0">y</span><span class="s3">=</span><span class="s4">'Life expectancy'</span><span class="s3">,</span>
<a name="l1153"><span class="ln">1153 </span></a>    <span class="s0">color</span><span class="s3">=</span><span class="s4">'Region'</span><span class="s3">,</span>
<a name="l1154"><span class="ln">1154 </span></a>    <span class="s0">hover_name</span><span class="s3">=</span><span class="s4">'Country'</span><span class="s3">,  </span><span class="s1"># Display country name on hover</span>
<a name="l1155"><span class="ln">1155 </span></a>    <span class="s0">log_x</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,            </span><span class="s1"># Logarithmic X-axis to handle large value differences</span>
<a name="l1156"><span class="ln">1156 </span></a>    <span class="s0">title</span><span class="s3">=</span><span class="s4">&quot;Life Expectancy vs CO₂ Emissions per Capita (2023)&quot;</span><span class="s3">,</span>
<a name="l1157"><span class="ln">1157 </span></a>    <span class="s0">labels</span><span class="s3">={</span>
<a name="l1158"><span class="ln">1158 </span></a>        <span class="s4">'CO2 emissions per capita'</span><span class="s3">: </span><span class="s4">'CO₂ emissions per capita (tonnes per person; log scale)'</span><span class="s3">,</span>
<a name="l1159"><span class="ln">1159 </span></a>        <span class="s4">'Life expectancy'</span><span class="s3">: </span><span class="s4">'Life expectancy at birth (years)'</span>
<a name="l1160"><span class="ln">1160 </span></a>    <span class="s3">}</span>
<a name="l1161"><span class="ln">1161 </span></a><span class="s3">)</span>
<a name="l1162"><span class="ln">1162 </span></a>
<a name="l1163"><span class="ln">1163 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1164"><span class="ln">1164 </span></a><span class="s1"># Export the figure</span>
<a name="l1165"><span class="ln">1165 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1166"><span class="ln">1166 </span></a><span class="s1"># The interactive chart is saved as an HTML file, allowing users to</span>
<a name="l1167"><span class="ln">1167 </span></a><span class="s1"># explore the data dynamically (zoom, hover, filter, etc.) outside Python.</span>
<a name="l1168"><span class="ln">1168 </span></a><span class="s0">output_file_path </span><span class="s3">= </span><span class="s4">'../Graphs/life_expectancy_vs_co2_2023_cleaned.html'</span>
<a name="l1169"><span class="ln">1169 </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">write_html</span><span class="s3">(</span><span class="s0">output_file_path</span><span class="s3">)</span>
<a name="l1170"><span class="ln">1170 </span></a>
<a name="l1171"><span class="ln">1171 </span></a><span class="s1"># Display the interactive visualization in the notebook or browser</span>
<a name="l1172"><span class="ln">1172 </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span>
<a name="l1173"><span class="ln">1173 </span></a><hr class="ls0"><a name="l1174"><span class="ln">1174 </span></a><span class="s0">#%% md 
<a name="l1175"><span class="ln">1175 </span></a>En el contexto de América Latina, las emisiones de CO₂ varían considerablemente entre los países. Aunque el continente representa una fracción menor del total global, las emisiones de CO₂ dentro de la región están concentradas principalmente en Brasil, seguido por Argentina y Venezuela. Estos países destacan debido a su mayor nivel de industrialización y la producción de energía, especialmente en Brasil, que lidera las emisiones en la región. En este gráfico, podemos observar cómo las emisiones están distribuidas en los países de América del Sur, reflejando tanto el desarrollo económico como el uso de recursos naturales en cada uno. Este análisis es clave para comprender el impacto de la región en el cambio climático global y la necesidad de políticas regionales para reducir las emisiones. <hr class="ls0"><a name="l1176"><span class="ln">1176 </span></a>#%% 
<a name="l1177"><span class="ln">1177 </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l1178"><span class="ln">1178 </span></a><span class="s2">import </span><span class="s0">geopandas </span><span class="s2">as </span><span class="s0">gpd</span>
<a name="l1179"><span class="ln">1179 </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt</span>
<a name="l1180"><span class="ln">1180 </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">patheffects </span><span class="s2">as </span><span class="s0">path_effects</span>
<a name="l1181"><span class="ln">1181 </span></a><span class="s2">from </span><span class="s0">mpl_toolkits</span><span class="s3">.</span><span class="s0">axes_grid1</span><span class="s3">.</span><span class="s0">inset_locator </span><span class="s2">import </span><span class="s0">inset_axes</span>
<a name="l1182"><span class="ln">1182 </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">cm </span><span class="s2">as </span><span class="s0">cm</span>
<a name="l1183"><span class="ln">1183 </span></a>
<a name="l1184"><span class="ln">1184 </span></a><span class="s1"># ===============================</span>
<a name="l1185"><span class="ln">1185 </span></a><span class="s1"># Load data from Excel file</span>
<a name="l1186"><span class="ln">1186 </span></a><span class="s1"># ===============================</span>
<a name="l1187"><span class="ln">1187 </span></a><span class="s1"># Reads the Excel sheet named “fossil_CO2_totals_by_country”</span>
<a name="l1188"><span class="ln">1188 </span></a><span class="s1"># which contains CO₂ emissions per country per year.</span>
<a name="l1189"><span class="ln">1189 </span></a><span class="s0">file_path </span><span class="s3">= </span><span class="s4">&quot;../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx&quot;</span>
<a name="l1190"><span class="ln">1190 </span></a><span class="s0">sheet_name </span><span class="s3">= </span><span class="s4">&quot;fossil_CO2_totals_by_country&quot;</span>
<a name="l1191"><span class="ln">1191 </span></a>
<a name="l1192"><span class="ln">1192 </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">file_path</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s0">sheet_name</span><span class="s3">)</span>
<a name="l1193"><span class="ln">1193 </span></a>
<a name="l1194"><span class="ln">1194 </span></a><span class="s1"># ===============================</span>
<a name="l1195"><span class="ln">1195 </span></a><span class="s1"># Filter only South American countries</span>
<a name="l1196"><span class="ln">1196 </span></a><span class="s1"># ===============================</span>
<a name="l1197"><span class="ln">1197 </span></a><span class="s1"># We create a list of South American countries and keep</span>
<a name="l1198"><span class="ln">1198 </span></a><span class="s1"># only their emission values for 2024.</span>
<a name="l1199"><span class="ln">1199 </span></a><span class="s0">south_america </span><span class="s3">= [</span>
<a name="l1200"><span class="ln">1200 </span></a>    <span class="s4">'Argentina'</span><span class="s3">, </span><span class="s4">'Bolivia'</span><span class="s3">, </span><span class="s4">'Brazil'</span><span class="s3">, </span><span class="s4">'Chile'</span><span class="s3">, </span><span class="s4">'Colombia'</span><span class="s3">, </span><span class="s4">'Ecuador'</span><span class="s3">,</span>
<a name="l1201"><span class="ln">1201 </span></a>    <span class="s4">'Guyana'</span><span class="s3">, </span><span class="s4">'Paraguay'</span><span class="s3">, </span><span class="s4">'Peru'</span><span class="s3">, </span><span class="s4">'Suriname'</span><span class="s3">, </span><span class="s4">'Uruguay'</span><span class="s3">, </span><span class="s4">'Venezuela'</span>
<a name="l1202"><span class="ln">1202 </span></a><span class="s3">]</span>
<a name="l1203"><span class="ln">1203 </span></a><span class="s0">df_south </span><span class="s3">= </span><span class="s0">df</span><span class="s3">[</span><span class="s0">df</span><span class="s3">[</span><span class="s4">&quot;Country&quot;</span><span class="s3">].</span><span class="s0">isin</span><span class="s3">(</span><span class="s0">south_america</span><span class="s3">)][[</span><span class="s4">&quot;Country&quot;</span><span class="s3">, </span><span class="s5">2024</span><span class="s3">]].</span><span class="s0">rename</span><span class="s3">(</span><span class="s0">columns</span><span class="s3">={</span><span class="s5">2024</span><span class="s3">: </span><span class="s4">&quot;CO2&quot;</span><span class="s3">})</span>
<a name="l1204"><span class="ln">1204 </span></a>
<a name="l1205"><span class="ln">1205 </span></a><span class="s1"># ===============================</span>
<a name="l1206"><span class="ln">1206 </span></a><span class="s1"># Load the world map using GeoPandas</span>
<a name="l1207"><span class="ln">1207 </span></a><span class="s1"># ===============================</span>
<a name="l1208"><span class="ln">1208 </span></a><span class="s1"># The map is loaded from the Natural Earth dataset (in GeoJSON format).</span>
<a name="l1209"><span class="ln">1209 </span></a><span class="s1"># Then we extract only the South American continent and merge</span>
<a name="l1210"><span class="ln">1210 </span></a><span class="s1"># the geographic information with the CO₂ emission data.</span>
<a name="l1211"><span class="ln">1211 </span></a><span class="s0">world </span><span class="s3">= </span><span class="s0">gpd</span><span class="s3">.</span><span class="s0">read_file</span><span class="s3">(</span>
<a name="l1212"><span class="ln">1212 </span></a>    <span class="s4">&quot;https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson&quot;</span>
<a name="l1213"><span class="ln">1213 </span></a><span class="s3">)</span>
<a name="l1214"><span class="ln">1214 </span></a><span class="s0">geo </span><span class="s3">= </span><span class="s0">world</span><span class="s3">[</span><span class="s0">world</span><span class="s3">[</span><span class="s4">&quot;CONTINENT&quot;</span><span class="s3">] == </span><span class="s4">&quot;South America&quot;</span><span class="s3">].</span><span class="s0">merge</span><span class="s3">(</span><span class="s0">df_south</span><span class="s3">, </span><span class="s0">how</span><span class="s3">=</span><span class="s4">&quot;left&quot;</span><span class="s3">, </span><span class="s0">left_on</span><span class="s3">=</span><span class="s4">&quot;NAME_EN&quot;</span><span class="s3">, </span><span class="s0">right_on</span><span class="s3">=</span><span class="s4">&quot;Country&quot;</span><span class="s3">)</span>
<a name="l1215"><span class="ln">1215 </span></a>
<a name="l1216"><span class="ln">1216 </span></a><span class="s1"># ===============================</span>
<a name="l1217"><span class="ln">1217 </span></a><span class="s1"># Assign unique colors using tab20</span>
<a name="l1218"><span class="ln">1218 </span></a><span class="s1"># ===============================</span>
<a name="l1219"><span class="ln">1219 </span></a><span class="s1"># The colormap &quot;tab20b&quot; provides up to 20 easily distinguishable colors.</span>
<a name="l1220"><span class="ln">1220 </span></a><span class="s1"># Each country will receive a unique color from this palette.</span>
<a name="l1221"><span class="ln">1221 </span></a><span class="s0">cmap </span><span class="s3">= </span><span class="s0">cm</span><span class="s3">.</span><span class="s0">get_cmap</span><span class="s3">(</span><span class="s4">'tab20b'</span><span class="s3">, </span><span class="s0">len</span><span class="s3">(</span><span class="s0">geo</span><span class="s3">))</span>
<a name="l1222"><span class="ln">1222 </span></a>
<a name="l1223"><span class="ln">1223 </span></a><span class="s1"># Drop countries with missing CO₂ values and reset index</span>
<a name="l1224"><span class="ln">1224 </span></a><span class="s0">geo </span><span class="s3">= </span><span class="s0">geo</span><span class="s3">.</span><span class="s0">dropna</span><span class="s3">(</span><span class="s0">subset</span><span class="s3">=[</span><span class="s4">&quot;CO2&quot;</span><span class="s3">]).</span><span class="s0">reset_index</span><span class="s3">(</span><span class="s0">drop</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<a name="l1225"><span class="ln">1225 </span></a>
<a name="l1226"><span class="ln">1226 </span></a><span class="s1"># ===============================</span>
<a name="l1227"><span class="ln">1227 </span></a><span class="s1"># Sort geo dataframe by CO2 emissions</span>
<a name="l1228"><span class="ln">1228 </span></a><span class="s1"># ===============================</span>
<a name="l1229"><span class="ln">1229 </span></a><span class="s0">geo_sorted </span><span class="s3">= </span><span class="s0">geo</span><span class="s3">.</span><span class="s0">sort_values</span><span class="s3">(</span><span class="s0">by</span><span class="s3">=</span><span class="s4">&quot;CO2&quot;</span><span class="s3">, </span><span class="s0">ascending</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)  </span><span class="s1"># Sort countries by CO2 emissions</span>
<a name="l1230"><span class="ln">1230 </span></a>
<a name="l1231"><span class="ln">1231 </span></a><span class="s1"># Assign a color from the colormap to each country</span>
<a name="l1232"><span class="ln">1232 </span></a><span class="s0">geo_sorted</span><span class="s3">[</span><span class="s4">&quot;color&quot;</span><span class="s3">] = [</span><span class="s0">cmap</span><span class="s3">(</span><span class="s0">i</span><span class="s3">) </span><span class="s2">for </span><span class="s0">i </span><span class="s2">in </span><span class="s0">range</span><span class="s3">(</span><span class="s0">len</span><span class="s3">(</span><span class="s0">geo_sorted</span><span class="s3">))]  </span><span class="s1"># Assign colors to the sorted dataframe</span>
<a name="l1233"><span class="ln">1233 </span></a>
<a name="l1234"><span class="ln">1234 </span></a><span class="s1"># ===============================</span>
<a name="l1235"><span class="ln">1235 </span></a><span class="s1"># Create the main figure</span>
<a name="l1236"><span class="ln">1236 </span></a><span class="s1"># ===============================</span>
<a name="l1237"><span class="ln">1237 </span></a><span class="s1"># The map is drawn with soft background color and white borders.</span>
<a name="l1238"><span class="ln">1238 </span></a><span class="s0">fig</span><span class="s3">, </span><span class="s0">ax </span><span class="s3">= </span><span class="s0">plt</span><span class="s3">.</span><span class="s0">subplots</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">14</span><span class="s3">, </span><span class="s5">9</span><span class="s3">))</span>
<a name="l1239"><span class="ln">1239 </span></a><span class="s0">fig</span><span class="s3">.</span><span class="s0">patch</span><span class="s3">.</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">&quot;#fafafa&quot;</span><span class="s3">)</span>
<a name="l1240"><span class="ln">1240 </span></a>
<a name="l1241"><span class="ln">1241 </span></a><span class="s0">geo_sorted</span><span class="s3">.</span><span class="s0">plot</span><span class="s3">(</span><span class="s0">color</span><span class="s3">=</span><span class="s0">geo_sorted</span><span class="s3">[</span><span class="s4">&quot;color&quot;</span><span class="s3">], </span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.2</span><span class="s3">, </span><span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">&quot;white&quot;</span><span class="s3">, </span><span class="s0">ax</span><span class="s3">=</span><span class="s0">ax</span><span class="s3">)</span>
<a name="l1242"><span class="ln">1242 </span></a>
<a name="l1243"><span class="ln">1243 </span></a><span class="s1"># ===============================</span>
<a name="l1244"><span class="ln">1244 </span></a><span class="s1"># Determine label color dynamically</span>
<a name="l1245"><span class="ln">1245 </span></a><span class="s1"># ===============================</span>
<a name="l1246"><span class="ln">1246 </span></a><span class="s1"># This function calculates the perceived brightness (luminance)</span>
<a name="l1247"><span class="ln">1247 </span></a><span class="s1"># of each country's color and automatically chooses black or white text</span>
<a name="l1248"><span class="ln">1248 </span></a><span class="s1"># for optimal readability.</span>
<a name="l1249"><span class="ln">1249 </span></a><span class="s2">def </span><span class="s0">get_text_color</span><span class="s3">(</span><span class="s0">country</span><span class="s3">):</span>
<a name="l1250"><span class="ln">1250 </span></a>    <span class="s0">country_color </span><span class="s3">= </span><span class="s0">geo_sorted</span><span class="s3">.</span><span class="s0">loc</span><span class="s3">[</span><span class="s0">geo_sorted</span><span class="s3">[</span><span class="s4">'Country'</span><span class="s3">] == </span><span class="s0">country</span><span class="s3">, </span><span class="s4">'color'</span><span class="s3">].</span><span class="s0">values</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
<a name="l1251"><span class="ln">1251 </span></a>    <span class="s0">r</span><span class="s3">, </span><span class="s0">g</span><span class="s3">, </span><span class="s0">b</span><span class="s3">, </span><span class="s0">_ </span><span class="s3">= </span><span class="s0">country_color</span>
<a name="l1252"><span class="ln">1252 </span></a>    <span class="s0">luminance </span><span class="s3">= </span><span class="s5">0.2126 </span><span class="s3">* </span><span class="s0">r </span><span class="s3">+ </span><span class="s5">0.7152 </span><span class="s3">* </span><span class="s0">g </span><span class="s3">+ </span><span class="s5">0.0722 </span><span class="s3">* </span><span class="s0">b</span>
<a name="l1253"><span class="ln">1253 </span></a>    <span class="s2">return </span><span class="s4">&quot;black&quot; </span><span class="s2">if </span><span class="s0">luminance </span><span class="s3">&gt; </span><span class="s5">0.6 </span><span class="s2">else </span><span class="s4">&quot;white&quot;</span>
<a name="l1254"><span class="ln">1254 </span></a>
<a name="l1255"><span class="ln">1255 </span></a><span class="s1"># ===============================</span>
<a name="l1256"><span class="ln">1256 </span></a><span class="s1"># Add country labels to the map</span>
<a name="l1257"><span class="ln">1257 </span></a><span class="s1"># ===============================</span>
<a name="l1258"><span class="ln">1258 </span></a><span class="s1"># Labels are placed at the centroid of each country shape.</span>
<a name="l1259"><span class="ln">1259 </span></a><span class="s1"># Some are slightly offset to prevent overlap.</span>
<a name="l1260"><span class="ln">1260 </span></a><span class="s0">label_offsets </span><span class="s3">= {</span>
<a name="l1261"><span class="ln">1261 </span></a>    <span class="s4">&quot;GUY&quot;</span><span class="s3">: (</span><span class="s5">0.8</span><span class="s3">, </span><span class="s5">0.8</span><span class="s3">),</span>
<a name="l1262"><span class="ln">1262 </span></a>    <span class="s4">&quot;SUR&quot;</span><span class="s3">: (-</span><span class="s5">0.8</span><span class="s3">, -</span><span class="s5">0.8</span><span class="s3">)</span>
<a name="l1263"><span class="ln">1263 </span></a><span class="s3">}</span>
<a name="l1264"><span class="ln">1264 </span></a>
<a name="l1265"><span class="ln">1265 </span></a><span class="s2">for </span><span class="s0">_</span><span class="s3">, </span><span class="s0">row </span><span class="s2">in </span><span class="s0">geo_sorted</span><span class="s3">.</span><span class="s0">iterrows</span><span class="s3">():</span>
<a name="l1266"><span class="ln">1266 </span></a>    <span class="s2">if </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">isna</span><span class="s3">(</span><span class="s0">row</span><span class="s3">[</span><span class="s4">&quot;CO2&quot;</span><span class="s3">]):</span>
<a name="l1267"><span class="ln">1267 </span></a>        <span class="s2">continue</span>
<a name="l1268"><span class="ln">1268 </span></a>    <span class="s0">centroid </span><span class="s3">= </span><span class="s0">row</span><span class="s3">[</span><span class="s4">&quot;geometry&quot;</span><span class="s3">].</span><span class="s0">representative_point</span><span class="s3">()</span>
<a name="l1269"><span class="ln">1269 </span></a>    <span class="s0">iso </span><span class="s3">= </span><span class="s0">row</span><span class="s3">[</span><span class="s4">&quot;ISO_A3&quot;</span><span class="s3">]</span>
<a name="l1270"><span class="ln">1270 </span></a>    <span class="s0">dx</span><span class="s3">, </span><span class="s0">dy </span><span class="s3">= </span><span class="s0">label_offsets</span><span class="s3">.</span><span class="s0">get</span><span class="s3">(</span><span class="s0">iso</span><span class="s3">, (</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">))</span>
<a name="l1271"><span class="ln">1271 </span></a>    <span class="s0">label </span><span class="s3">= </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s0">iso</span><span class="s2">}\n{</span><span class="s0">row</span><span class="s3">[</span><span class="s4">'CO2'</span><span class="s3">]</span><span class="s2">:</span><span class="s4">.0f</span><span class="s2">} </span><span class="s4">Mt&quot;  </span><span class="s1"># ISO code and emission value (in megatonnes)</span>
<a name="l1272"><span class="ln">1272 </span></a>    <span class="s0">color_text </span><span class="s3">= </span><span class="s0">get_text_color</span><span class="s3">(</span><span class="s0">row</span><span class="s3">[</span><span class="s4">&quot;Country&quot;</span><span class="s3">])</span>
<a name="l1273"><span class="ln">1273 </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span>
<a name="l1274"><span class="ln">1274 </span></a>        <span class="s0">centroid</span><span class="s3">.</span><span class="s0">x </span><span class="s3">+ </span><span class="s0">dx</span><span class="s3">, </span><span class="s0">centroid</span><span class="s3">.</span><span class="s0">y </span><span class="s3">+ </span><span class="s0">dy</span><span class="s3">, </span><span class="s0">label</span><span class="s3">,</span>
<a name="l1275"><span class="ln">1275 </span></a>        <span class="s0">ha</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">, </span><span class="s0">va</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">10.5</span><span class="s3">,</span>
<a name="l1276"><span class="ln">1276 </span></a>        <span class="s0">color</span><span class="s3">=</span><span class="s0">color_text</span><span class="s3">,</span>
<a name="l1277"><span class="ln">1277 </span></a>        <span class="s0">path_effects</span><span class="s3">=[</span><span class="s0">path_effects</span><span class="s3">.</span><span class="s0">withStroke</span><span class="s3">(</span><span class="s0">linewidth</span><span class="s3">=</span><span class="s5">1.2</span><span class="s3">, </span><span class="s0">foreground</span><span class="s3">=</span><span class="s4">&quot;black&quot;</span><span class="s3">, </span><span class="s0">alpha</span><span class="s3">=</span><span class="s5">0.3</span><span class="s3">)]</span>
<a name="l1278"><span class="ln">1278 </span></a>    <span class="s3">)</span>
<a name="l1279"><span class="ln">1279 </span></a>
<a name="l1280"><span class="ln">1280 </span></a><span class="s1"># --- Map title and formatting ---</span>
<a name="l1281"><span class="ln">1281 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_title</span><span class="s3">(</span>
<a name="l1282"><span class="ln">1282 </span></a>    <span class="s4">&quot;CO$_2$ Emissions by Country in South America (2024)&quot;</span><span class="s3">,</span>
<a name="l1283"><span class="ln">1283 </span></a>    <span class="s0">fontsize</span><span class="s3">=</span><span class="s5">22</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s4">&quot;#222&quot;</span><span class="s3">, </span><span class="s0">pad</span><span class="s3">=</span><span class="s5">20</span>
<a name="l1284"><span class="ln">1284 </span></a><span class="s3">)</span>
<a name="l1285"><span class="ln">1285 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">axis</span><span class="s3">(</span><span class="s4">&quot;off&quot;</span><span class="s3">)</span>
<a name="l1286"><span class="ln">1286 </span></a>
<a name="l1287"><span class="ln">1287 </span></a><span class="s1"># Automatically adjust the map limits to include all countries nicely</span>
<a name="l1288"><span class="ln">1288 </span></a><span class="s0">bounds </span><span class="s3">= </span><span class="s0">geo_sorted</span><span class="s3">.</span><span class="s0">total_bounds</span>
<a name="l1289"><span class="ln">1289 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xlim</span><span class="s3">(</span><span class="s0">bounds</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] - </span><span class="s5">5</span><span class="s3">, </span><span class="s0">bounds</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] + </span><span class="s5">5</span><span class="s3">)</span>
<a name="l1290"><span class="ln">1290 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_ylim</span><span class="s3">(</span><span class="s0">bounds</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] - </span><span class="s5">5</span><span class="s3">, </span><span class="s0">bounds</span><span class="s3">[</span><span class="s5">3</span><span class="s3">] + </span><span class="s5">5</span><span class="s3">)</span>
<a name="l1291"><span class="ln">1291 </span></a>
<a name="l1292"><span class="ln">1292 </span></a><span class="s1"># ===============================</span>
<a name="l1293"><span class="ln">1293 </span></a><span class="s1"># Add the inset barplot (bottom-right corner)</span>
<a name="l1294"><span class="ln">1294 </span></a><span class="s1"># ===============================</span>
<a name="l1295"><span class="ln">1295 </span></a><span class="s1"># The barplot compares emission magnitudes between countries.</span>
<a name="l1296"><span class="ln">1296 </span></a><span class="s1"># It’s embedded inside the same figure using inset_axes().</span>
<a name="l1297"><span class="ln">1297 </span></a><span class="s0">ax_inset </span><span class="s3">= </span><span class="s0">inset_axes</span><span class="s3">(</span><span class="s0">ax</span><span class="s3">, </span><span class="s0">width</span><span class="s3">=</span><span class="s4">&quot;38%&quot;</span><span class="s3">, </span><span class="s0">height</span><span class="s3">=</span><span class="s4">&quot;25%&quot;</span><span class="s3">, </span><span class="s0">loc</span><span class="s3">=</span><span class="s4">&quot;lower right&quot;</span><span class="s3">, </span><span class="s0">borderpad</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>
<a name="l1298"><span class="ln">1298 </span></a>
<a name="l1299"><span class="ln">1299 </span></a><span class="s1"># Sort countries by CO₂ emissions (ascending)</span>
<a name="l1300"><span class="ln">1300 </span></a><span class="s0">bar_colors </span><span class="s3">= </span><span class="s0">geo_sorted</span><span class="s3">[</span><span class="s4">&quot;color&quot;</span><span class="s3">]</span>
<a name="l1301"><span class="ln">1301 </span></a>
<a name="l1302"><span class="ln">1302 </span></a><span class="s1"># Horizontal barplot with the same color as the map</span>
<a name="l1303"><span class="ln">1303 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">barh</span><span class="s3">(</span><span class="s0">geo_sorted</span><span class="s3">[</span><span class="s4">&quot;Country&quot;</span><span class="s3">], </span><span class="s0">geo_sorted</span><span class="s3">[</span><span class="s4">&quot;CO2&quot;</span><span class="s3">], </span><span class="s0">color</span><span class="s3">=</span><span class="s0">bar_colors</span><span class="s3">, </span><span class="s0">edgecolor</span><span class="s3">=</span><span class="s4">&quot;none&quot;</span><span class="s3">, </span><span class="s0">height</span><span class="s3">=</span><span class="s5">0.55</span><span class="s3">)</span>
<a name="l1304"><span class="ln">1304 </span></a>
<a name="l1305"><span class="ln">1305 </span></a><span class="s1"># --- Barplot style adjustments ---</span>
<a name="l1306"><span class="ln">1306 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">set_facecolor</span><span class="s3">(</span><span class="s4">&quot;#fafafa&quot;</span><span class="s3">)</span>
<a name="l1307"><span class="ln">1307 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">tick_params</span><span class="s3">(</span><span class="s0">axis</span><span class="s3">=</span><span class="s4">&quot;x&quot;</span><span class="s3">, </span><span class="s0">labelsize</span><span class="s3">=</span><span class="s5">8</span><span class="s3">)</span>
<a name="l1308"><span class="ln">1308 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">tick_params</span><span class="s3">(</span><span class="s0">axis</span><span class="s3">=</span><span class="s4">&quot;y&quot;</span><span class="s3">, </span><span class="s0">labelsize</span><span class="s3">=</span><span class="s5">8</span><span class="s3">)</span>
<a name="l1309"><span class="ln">1309 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">set_xlabel</span><span class="s3">(</span><span class="s4">&quot;Emissions (Mt)&quot;</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">9</span><span class="s3">, </span><span class="s0">labelpad</span><span class="s3">=</span><span class="s5">4</span><span class="s3">)</span>
<a name="l1310"><span class="ln">1310 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">set_ylabel</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">9</span><span class="s3">)</span>
<a name="l1311"><span class="ln">1311 </span></a>
<a name="l1312"><span class="ln">1312 </span></a><span class="s1"># Remove unnecessary borders</span>
<a name="l1313"><span class="ln">1313 </span></a><span class="s2">for </span><span class="s0">spine </span><span class="s2">in </span><span class="s3">[</span><span class="s4">&quot;top&quot;</span><span class="s3">, </span><span class="s4">&quot;right&quot;</span><span class="s3">, </span><span class="s4">&quot;left&quot;</span><span class="s3">, </span><span class="s4">&quot;bottom&quot;</span><span class="s3">]:</span>
<a name="l1314"><span class="ln">1314 </span></a>    <span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">spines</span><span class="s3">[</span><span class="s0">spine</span><span class="s3">].</span><span class="s0">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l1315"><span class="ln">1315 </span></a>
<a name="l1316"><span class="ln">1316 </span></a><span class="s0">ax_inset</span><span class="s3">.</span><span class="s0">grid</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
<a name="l1317"><span class="ln">1317 </span></a>
<a name="l1318"><span class="ln">1318 </span></a><span class="s1"># ===============================</span>
<a name="l1319"><span class="ln">1319 </span></a><span class="s1"># Save and display the final figure</span>
<a name="l1320"><span class="ln">1320 </span></a><span class="s1"># ===============================</span>
<a name="l1321"><span class="ln">1321 </span></a><span class="s1"># The final image is exported at high resolution (300 dpi)</span>
<a name="l1322"><span class="ln">1322 </span></a><span class="s1"># and displayed on screen.</span>
<a name="l1323"><span class="ln">1323 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">tight_layout</span><span class="s3">()</span>
<a name="l1324"><span class="ln">1324 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">savefig</span><span class="s3">(</span><span class="s4">&quot;../Graphs/mapa_CO2_Sudamerica.png&quot;</span><span class="s3">, </span><span class="s0">dpi</span><span class="s3">=</span><span class="s5">300</span><span class="s3">, </span><span class="s0">bbox_inches</span><span class="s3">=</span><span class="s4">&quot;tight&quot;</span><span class="s3">)</span>
<a name="l1325"><span class="ln">1325 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span><hr class="ls0"><a name="l1326"><span class="ln">1326 </span></a><span class="s0">#%% md 
<a name="l1327"><span class="ln">1327 </span></a>Al analizar las emisiones de CO₂ por país, es importante poner a Colombia como un control en el contexto global, ya que es el país en el que residimos. En 1970, las emisiones de Colombia eran significativamente bajas en comparación con los grandes emisores como Estados Unidos y Rusia. Este gráfico refleja cómo las emisiones de CO₂ en Colombia se ubicaban en un rango mucho menor que las de los países industrializados, lo que subraya su papel secundario en el contexto de las emisiones globales de esa época. <hr class="ls0"><a name="l1328"><span class="ln">1328 </span></a>#%% 
<a name="l1329"><span class="ln">1329 </span></a></span><span class="s2">import </span><span class="s0">pandas </span><span class="s2">as </span><span class="s0">pd</span>
<a name="l1330"><span class="ln">1330 </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">pyplot </span><span class="s2">as </span><span class="s0">plt</span>
<a name="l1331"><span class="ln">1331 </span></a><span class="s2">import </span><span class="s0">matplotlib</span><span class="s3">.</span><span class="s0">animation </span><span class="s2">as </span><span class="s0">animation</span>
<a name="l1332"><span class="ln">1332 </span></a><span class="s2">import </span><span class="s0">numpy </span><span class="s2">as </span><span class="s0">np</span>
<a name="l1333"><span class="ln">1333 </span></a>
<a name="l1334"><span class="ln">1334 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1335"><span class="ln">1335 </span></a><span class="s1"># Load dataset</span>
<a name="l1336"><span class="ln">1336 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1337"><span class="ln">1337 </span></a><span class="s1"># The dataset comes from the EDGAR (Emissions Database for Global Atmospheric Research)</span>
<a name="l1338"><span class="ln">1338 </span></a><span class="s1"># fossil CO₂ emissions report. It contains annual emission totals by country.</span>
<a name="l1339"><span class="ln">1339 </span></a><span class="s0">EXCEL_PATH </span><span class="s3">= </span><span class="s4">&quot;../Datos/EDGAR_2025_GHG_booklet_2025_fossilCO2only.xlsx&quot;</span>
<a name="l1340"><span class="ln">1340 </span></a><span class="s0">SHEET </span><span class="s3">= </span><span class="s4">&quot;fossil_CO2_totals_by_country&quot;</span>
<a name="l1341"><span class="ln">1341 </span></a>
<a name="l1342"><span class="ln">1342 </span></a><span class="s1"># Read the Excel sheet into a DataFrame</span>
<a name="l1343"><span class="ln">1343 </span></a><span class="s0">df </span><span class="s3">= </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">read_excel</span><span class="s3">(</span><span class="s0">EXCEL_PATH</span><span class="s3">, </span><span class="s0">sheet_name</span><span class="s3">=</span><span class="s0">SHEET</span><span class="s3">)</span>
<a name="l1344"><span class="ln">1344 </span></a>
<a name="l1345"><span class="ln">1345 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1346"><span class="ln">1346 </span></a><span class="s1"># Clean and standardize column names</span>
<a name="l1347"><span class="ln">1347 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1348"><span class="ln">1348 </span></a><span class="s1"># Convert all column names to lowercase, remove extra spaces,</span>
<a name="l1349"><span class="ln">1349 </span></a><span class="s1"># and replace spaces with underscores for easier referencing.</span>
<a name="l1350"><span class="ln">1350 </span></a><span class="s0">df</span><span class="s3">.</span><span class="s0">columns </span><span class="s3">= [</span><span class="s0">str</span><span class="s3">(</span><span class="s0">col</span><span class="s3">).</span><span class="s0">strip</span><span class="s3">().</span><span class="s0">lower</span><span class="s3">().</span><span class="s0">replace</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">, </span><span class="s4">&quot;_&quot;</span><span class="s3">) </span><span class="s2">for </span><span class="s0">col </span><span class="s2">in </span><span class="s0">df</span><span class="s3">.</span><span class="s0">columns</span><span class="s3">]</span>
<a name="l1351"><span class="ln">1351 </span></a>
<a name="l1352"><span class="ln">1352 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1353"><span class="ln">1353 </span></a><span class="s1"># Reshape dataset: wide → long format</span>
<a name="l1354"><span class="ln">1354 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1355"><span class="ln">1355 </span></a><span class="s1"># Each column representing a year is converted into rows, creating</span>
<a name="l1356"><span class="ln">1356 </span></a><span class="s1"># a tidy dataset with 'year' and 'fossil_co2_total' columns.</span>
<a name="l1357"><span class="ln">1357 </span></a><span class="s0">df_long </span><span class="s3">= </span><span class="s0">df</span><span class="s3">.</span><span class="s0">melt</span><span class="s3">(</span>
<a name="l1358"><span class="ln">1358 </span></a>    <span class="s0">id_vars</span><span class="s3">=[</span><span class="s4">&quot;substance&quot;</span><span class="s3">, </span><span class="s4">&quot;edgar_country_code&quot;</span><span class="s3">, </span><span class="s4">&quot;country&quot;</span><span class="s3">],</span>
<a name="l1359"><span class="ln">1359 </span></a>    <span class="s0">value_vars</span><span class="s3">=[</span><span class="s0">col </span><span class="s2">for </span><span class="s0">col </span><span class="s2">in </span><span class="s0">df</span><span class="s3">.</span><span class="s0">columns </span><span class="s2">if </span><span class="s0">col</span><span class="s3">.</span><span class="s0">isdigit</span><span class="s3">()],</span>
<a name="l1360"><span class="ln">1360 </span></a>    <span class="s0">var_name</span><span class="s3">=</span><span class="s4">&quot;year&quot;</span><span class="s3">,</span>
<a name="l1361"><span class="ln">1361 </span></a>    <span class="s0">value_name</span><span class="s3">=</span><span class="s4">&quot;fossil_co2_total&quot;</span>
<a name="l1362"><span class="ln">1362 </span></a><span class="s3">)</span>
<a name="l1363"><span class="ln">1363 </span></a>
<a name="l1364"><span class="ln">1364 </span></a><span class="s1"># Convert 'year' to numeric type</span>
<a name="l1365"><span class="ln">1365 </span></a><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">] = </span><span class="s0">pd</span><span class="s3">.</span><span class="s0">to_numeric</span><span class="s3">(</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">])</span>
<a name="l1366"><span class="ln">1366 </span></a>
<a name="l1367"><span class="ln">1367 </span></a><span class="s1"># Keep only CO₂ data (exclude other GHGs, if any)</span>
<a name="l1368"><span class="ln">1368 </span></a><span class="s0">df_long </span><span class="s3">= </span><span class="s0">df_long</span><span class="s3">[</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;substance&quot;</span><span class="s3">] == </span><span class="s4">&quot;CO2&quot;</span><span class="s3">].</span><span class="s0">dropna</span><span class="s3">(</span><span class="s0">subset</span><span class="s3">=[</span><span class="s4">&quot;fossil_co2_total&quot;</span><span class="s3">])</span>
<a name="l1369"><span class="ln">1369 </span></a>
<a name="l1370"><span class="ln">1370 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1371"><span class="ln">1371 </span></a><span class="s1"># Select specific countries for visualization</span>
<a name="l1372"><span class="ln">1372 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1373"><span class="ln">1373 </span></a><span class="s1"># Focus on top global emitters and Colombia for regional comparison.</span>
<a name="l1374"><span class="ln">1374 </span></a><span class="s0">selected_countries </span><span class="s3">= [</span><span class="s4">&quot;United States&quot;</span><span class="s3">, </span><span class="s4">&quot;China&quot;</span><span class="s3">, </span><span class="s4">&quot;India&quot;</span><span class="s3">, </span><span class="s4">&quot;Russia&quot;</span><span class="s3">, </span><span class="s4">&quot;Japan&quot;</span><span class="s3">, </span><span class="s4">&quot;Colombia&quot;</span><span class="s3">]</span>
<a name="l1375"><span class="ln">1375 </span></a>
<a name="l1376"><span class="ln">1376 </span></a><span class="s0">df_long </span><span class="s3">= </span><span class="s0">df_long</span><span class="s3">[</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;country&quot;</span><span class="s3">].</span><span class="s0">isin</span><span class="s3">(</span><span class="s0">selected_countries</span><span class="s3">)]</span>
<a name="l1377"><span class="ln">1377 </span></a><span class="s0">df_long </span><span class="s3">= </span><span class="s0">df_long</span><span class="s3">.</span><span class="s0">sort_values</span><span class="s3">(</span><span class="s0">by</span><span class="s3">=[</span><span class="s4">&quot;year&quot;</span><span class="s3">, </span><span class="s4">&quot;country&quot;</span><span class="s3">])</span>
<a name="l1378"><span class="ln">1378 </span></a>
<a name="l1379"><span class="ln">1379 </span></a><span class="s1"># Filter out negative or missing emission values</span>
<a name="l1380"><span class="ln">1380 </span></a><span class="s0">df_long </span><span class="s3">= </span><span class="s0">df_long</span><span class="s3">[</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;fossil_co2_total&quot;</span><span class="s3">] &gt; </span><span class="s5">0</span><span class="s3">]</span>
<a name="l1381"><span class="ln">1381 </span></a>
<a name="l1382"><span class="ln">1382 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1383"><span class="ln">1383 </span></a><span class="s1"># Create the figure and define axis parameters</span>
<a name="l1384"><span class="ln">1384 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1385"><span class="ln">1385 </span></a><span class="s0">fig</span><span class="s3">, </span><span class="s0">ax </span><span class="s3">= </span><span class="s0">plt</span><span class="s3">.</span><span class="s0">subplots</span><span class="s3">(</span><span class="s0">figsize</span><span class="s3">=(</span><span class="s5">12</span><span class="s3">, </span><span class="s5">6</span><span class="s3">))</span>
<a name="l1386"><span class="ln">1386 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xlim</span><span class="s3">(</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">].</span><span class="s0">min</span><span class="s3">(), </span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">].</span><span class="s0">max</span><span class="s3">() + </span><span class="s5">10</span><span class="s3">)</span>
<a name="l1387"><span class="ln">1387 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_ylim</span><span class="s3">(-</span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">14000</span><span class="s3">)  </span><span class="s1"># Set consistent Y-axis limit across frames</span>
<a name="l1388"><span class="ln">1388 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_xlabel</span><span class="s3">(</span><span class="s4">&quot;Year&quot;</span><span class="s3">)</span>
<a name="l1389"><span class="ln">1389 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_ylabel</span><span class="s3">(</span><span class="s4">&quot;Fossil CO$_2$ emissions (MtCO$_2$)&quot;</span><span class="s3">)</span>
<a name="l1390"><span class="ln">1390 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">set_title</span><span class="s3">(</span><span class="s4">&quot;CO$_2$ Emissions — Top Emitters in America + Global Trend&quot;</span><span class="s3">)</span>
<a name="l1391"><span class="ln">1391 </span></a>
<a name="l1392"><span class="ln">1392 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1393"><span class="ln">1393 </span></a><span class="s1"># Assign unique colors to each country</span>
<a name="l1394"><span class="ln">1394 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1395"><span class="ln">1395 </span></a><span class="s1"># Using the 'tab10' colormap for visual distinction between countries.</span>
<a name="l1396"><span class="ln">1396 </span></a><span class="s0">cmap </span><span class="s3">= </span><span class="s0">plt</span><span class="s3">.</span><span class="s0">colormaps</span><span class="s3">.</span><span class="s0">get_cmap</span><span class="s3">(</span><span class="s4">&quot;tab10&quot;</span><span class="s3">)</span>
<a name="l1397"><span class="ln">1397 </span></a><span class="s0">countries </span><span class="s3">= </span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;country&quot;</span><span class="s3">].</span><span class="s0">unique</span><span class="s3">()</span>
<a name="l1398"><span class="ln">1398 </span></a><span class="s0">colors </span><span class="s3">= [</span><span class="s0">cmap</span><span class="s3">(</span><span class="s0">i </span><span class="s3">/ </span><span class="s0">len</span><span class="s3">(</span><span class="s0">countries</span><span class="s3">)) </span><span class="s2">for </span><span class="s0">i </span><span class="s2">in </span><span class="s0">range</span><span class="s3">(</span><span class="s0">len</span><span class="s3">(</span><span class="s0">countries</span><span class="s3">))]</span>
<a name="l1399"><span class="ln">1399 </span></a>
<a name="l1400"><span class="ln">1400 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1401"><span class="ln">1401 </span></a><span class="s1"># Initialize line objects and text labels for each country</span>
<a name="l1402"><span class="ln">1402 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1403"><span class="ln">1403 </span></a><span class="s1"># Each country has:</span>
<a name="l1404"><span class="ln">1404 </span></a><span class="s1">#   - A line representing its emissions over time</span>
<a name="l1405"><span class="ln">1405 </span></a><span class="s1">#   - A label showing its name near the end of the line</span>
<a name="l1406"><span class="ln">1406 </span></a><span class="s0">lines</span><span class="s3">, </span><span class="s0">labels </span><span class="s3">= {}, {}</span>
<a name="l1407"><span class="ln">1407 </span></a>
<a name="l1408"><span class="ln">1408 </span></a><span class="s2">for </span><span class="s0">i</span><span class="s3">, </span><span class="s0">country </span><span class="s2">in </span><span class="s0">enumerate</span><span class="s3">(</span><span class="s0">countries</span><span class="s3">):</span>
<a name="l1409"><span class="ln">1409 </span></a>    <span class="s1"># Highlight Colombia with a thicker line</span>
<a name="l1410"><span class="ln">1410 </span></a>    <span class="s0">style </span><span class="s3">= {</span><span class="s4">&quot;color&quot;</span><span class="s3">: </span><span class="s0">colors</span><span class="s3">[</span><span class="s0">i</span><span class="s3">], </span><span class="s4">&quot;lw&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">} </span><span class="s2">if </span><span class="s0">country </span><span class="s3">!= </span><span class="s4">&quot;Colombia&quot; </span><span class="s2">else </span><span class="s3">{</span><span class="s4">&quot;color&quot;</span><span class="s3">: </span><span class="s0">colors</span><span class="s3">[</span><span class="s0">i</span><span class="s3">], </span><span class="s4">&quot;lw&quot;</span><span class="s3">: </span><span class="s5">3.2</span><span class="s3">}</span>
<a name="l1411"><span class="ln">1411 </span></a>    <span class="s0">line</span><span class="s3">, = </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">plot</span><span class="s3">([], [], </span><span class="s0">label</span><span class="s3">=</span><span class="s0">country</span><span class="s3">, **</span><span class="s0">style</span><span class="s3">)</span>
<a name="l1412"><span class="ln">1412 </span></a>    <span class="s0">lines</span><span class="s3">[</span><span class="s0">country</span><span class="s3">] = </span><span class="s0">line</span>
<a name="l1413"><span class="ln">1413 </span></a>    <span class="s0">labels</span><span class="s3">[</span><span class="s0">country</span><span class="s3">] = </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">text</span><span class="s3">(</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">].</span><span class="s0">max</span><span class="s3">() + </span><span class="s5">2</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s5">9</span><span class="s3">, </span><span class="s0">color</span><span class="s3">=</span><span class="s0">style</span><span class="s3">[</span><span class="s4">&quot;color&quot;</span><span class="s3">], </span><span class="s0">va</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">)</span>
<a name="l1414"><span class="ln">1414 </span></a>
<a name="l1415"><span class="ln">1415 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1416"><span class="ln">1416 </span></a><span class="s1"># Static legend (fixed position)</span>
<a name="l1417"><span class="ln">1417 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1418"><span class="ln">1418 </span></a><span class="s0">ax</span><span class="s3">.</span><span class="s0">legend</span><span class="s3">(</span><span class="s0">loc</span><span class="s3">=</span><span class="s4">&quot;center left&quot;</span><span class="s3">, </span><span class="s0">bbox_to_anchor</span><span class="s3">=(-</span><span class="s5">0.28</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">), </span><span class="s0">fontsize</span><span class="s3">=</span><span class="s4">&quot;small&quot;</span><span class="s3">, </span><span class="s0">title</span><span class="s3">=</span><span class="s4">&quot;Countries&quot;</span><span class="s3">)</span>
<a name="l1419"><span class="ln">1419 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">subplots_adjust</span><span class="s3">(</span><span class="s0">left</span><span class="s3">=</span><span class="s5">0.18</span><span class="s3">, </span><span class="s0">right</span><span class="s3">=</span><span class="s5">0.93</span><span class="s3">)</span>
<a name="l1420"><span class="ln">1420 </span></a>
<a name="l1421"><span class="ln">1421 </span></a><span class="s1"># Extract all unique years (frames for animation)</span>
<a name="l1422"><span class="ln">1422 </span></a><span class="s0">years </span><span class="s3">= </span><span class="s0">sorted</span><span class="s3">(</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">].</span><span class="s0">unique</span><span class="s3">())</span>
<a name="l1423"><span class="ln">1423 </span></a>
<a name="l1424"><span class="ln">1424 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1425"><span class="ln">1425 </span></a><span class="s1"># Helper function: adjust label positions</span>
<a name="l1426"><span class="ln">1426 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1427"><span class="ln">1427 </span></a><span class="s2">def </span><span class="s0">ordenar_etiquetas</span><span class="s3">(</span><span class="s0">posiciones</span><span class="s3">):</span>
<a name="l1428"><span class="ln">1428 </span></a>    <span class="s6">&quot;&quot;&quot; 
<a name="l1429"><span class="ln">1429 </span></a>    Prevents label overlap by slightly shifting them vertically 
<a name="l1430"><span class="ln">1430 </span></a>    when they are too close to each other at the end of the animation. 
<a name="l1431"><span class="ln">1431 </span></a>    &quot;&quot;&quot;</span>
<a name="l1432"><span class="ln">1432 </span></a>    <span class="s0">posiciones_ordenadas </span><span class="s3">= </span><span class="s0">sorted</span><span class="s3">(</span><span class="s0">posiciones</span><span class="s3">, </span><span class="s0">key</span><span class="s3">=</span><span class="s2">lambda </span><span class="s0">x</span><span class="s3">: </span><span class="s0">x</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
<a name="l1433"><span class="ln">1433 </span></a>    <span class="s0">separacion_min </span><span class="s3">= </span><span class="s5">0.03 </span><span class="s3">* </span><span class="s0">ax</span><span class="s3">.</span><span class="s0">get_ylim</span><span class="s3">()[</span><span class="s5">1</span><span class="s3">]</span>
<a name="l1434"><span class="ln">1434 </span></a>
<a name="l1435"><span class="ln">1435 </span></a>    <span class="s2">for </span><span class="s0">i </span><span class="s2">in </span><span class="s0">range</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s0">len</span><span class="s3">(</span><span class="s0">posiciones_ordenadas</span><span class="s3">)):</span>
<a name="l1436"><span class="ln">1436 </span></a>        <span class="s2">if </span><span class="s0">posiciones_ordenadas</span><span class="s3">[</span><span class="s0">i</span><span class="s3">][</span><span class="s5">1</span><span class="s3">] - </span><span class="s0">posiciones_ordenadas</span><span class="s3">[</span><span class="s0">i </span><span class="s3">- </span><span class="s5">1</span><span class="s3">][</span><span class="s5">1</span><span class="s3">] &lt; </span><span class="s0">separacion_min</span><span class="s3">:</span>
<a name="l1437"><span class="ln">1437 </span></a>            <span class="s0">posiciones_ordenadas</span><span class="s3">[</span><span class="s0">i</span><span class="s3">] = (</span>
<a name="l1438"><span class="ln">1438 </span></a>                <span class="s0">posiciones_ordenadas</span><span class="s3">[</span><span class="s0">i</span><span class="s3">][</span><span class="s5">0</span><span class="s3">],</span>
<a name="l1439"><span class="ln">1439 </span></a>                <span class="s0">posiciones_ordenadas</span><span class="s3">[</span><span class="s0">i </span><span class="s3">- </span><span class="s5">1</span><span class="s3">][</span><span class="s5">1</span><span class="s3">] + </span><span class="s0">separacion_min</span><span class="s3">,</span>
<a name="l1440"><span class="ln">1440 </span></a>                <span class="s0">posiciones_ordenadas</span><span class="s3">[</span><span class="s0">i</span><span class="s3">][</span><span class="s5">2</span><span class="s3">]</span>
<a name="l1441"><span class="ln">1441 </span></a>            <span class="s3">)</span>
<a name="l1442"><span class="ln">1442 </span></a>
<a name="l1443"><span class="ln">1443 </span></a>    <span class="s2">return </span><span class="s3">{</span><span class="s0">p</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]: (</span><span class="s0">p</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s0">p</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]) </span><span class="s2">for </span><span class="s0">p </span><span class="s2">in </span><span class="s0">posiciones_ordenadas</span><span class="s3">}</span>
<a name="l1444"><span class="ln">1444 </span></a>
<a name="l1445"><span class="ln">1445 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1446"><span class="ln">1446 </span></a><span class="s1"># Animation update function</span>
<a name="l1447"><span class="ln">1447 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1448"><span class="ln">1448 </span></a><span class="s2">def </span><span class="s0">update</span><span class="s3">(</span><span class="s0">frame</span><span class="s3">):</span>
<a name="l1449"><span class="ln">1449 </span></a>    <span class="s6">&quot;&quot;&quot; 
<a name="l1450"><span class="ln">1450 </span></a>    Updates the plot for each frame (year): 
<a name="l1451"><span class="ln">1451 </span></a>      - Draws each country's emission line up to the current year. 
<a name="l1452"><span class="ln">1452 </span></a>      - Updates label positions and text dynamically. 
<a name="l1453"><span class="ln">1453 </span></a>    &quot;&quot;&quot;</span>
<a name="l1454"><span class="ln">1454 </span></a>    <span class="s0">year </span><span class="s3">= </span><span class="s0">years</span><span class="s3">[</span><span class="s0">frame</span><span class="s3">]</span>
<a name="l1455"><span class="ln">1455 </span></a>    <span class="s0">ax</span><span class="s3">.</span><span class="s0">set_title</span><span class="s3">(</span><span class="s4">f&quot;Top Emitters + Colombia — </span><span class="s2">{</span><span class="s0">year</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
<a name="l1456"><span class="ln">1456 </span></a>
<a name="l1457"><span class="ln">1457 </span></a>    <span class="s0">posiciones </span><span class="s3">= []</span>
<a name="l1458"><span class="ln">1458 </span></a>    <span class="s2">for </span><span class="s0">country </span><span class="s2">in </span><span class="s0">countries</span><span class="s3">:</span>
<a name="l1459"><span class="ln">1459 </span></a>        <span class="s0">data </span><span class="s3">= </span><span class="s0">df_long</span><span class="s3">[</span><span class="s0">df_long</span><span class="s3">[</span><span class="s4">&quot;country&quot;</span><span class="s3">] == </span><span class="s0">country</span><span class="s3">]</span>
<a name="l1460"><span class="ln">1460 </span></a>        <span class="s0">past </span><span class="s3">= </span><span class="s0">data</span><span class="s3">[</span><span class="s0">data</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">] &lt;= </span><span class="s0">year</span><span class="s3">]</span>
<a name="l1461"><span class="ln">1461 </span></a>        <span class="s0">lines</span><span class="s3">[</span><span class="s0">country</span><span class="s3">].</span><span class="s0">set_data</span><span class="s3">(</span><span class="s0">past</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">], </span><span class="s0">past</span><span class="s3">[</span><span class="s4">&quot;fossil_co2_total&quot;</span><span class="s3">])</span>
<a name="l1462"><span class="ln">1462 </span></a>
<a name="l1463"><span class="ln">1463 </span></a>        <span class="s2">if not </span><span class="s0">past</span><span class="s3">.</span><span class="s0">empty</span><span class="s3">:</span>
<a name="l1464"><span class="ln">1464 </span></a>            <span class="s0">x </span><span class="s3">= </span><span class="s0">past</span><span class="s3">[</span><span class="s4">&quot;year&quot;</span><span class="s3">].</span><span class="s0">iloc</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">]</span>
<a name="l1465"><span class="ln">1465 </span></a>            <span class="s0">y </span><span class="s3">= </span><span class="s0">past</span><span class="s3">[</span><span class="s4">&quot;fossil_co2_total&quot;</span><span class="s3">].</span><span class="s0">iloc</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">]</span>
<a name="l1466"><span class="ln">1466 </span></a>            <span class="s0">posiciones</span><span class="s3">.</span><span class="s0">append</span><span class="s3">((</span><span class="s0">x </span><span class="s3">+ </span><span class="s5">2</span><span class="s3">, </span><span class="s0">y</span><span class="s3">, </span><span class="s0">country</span><span class="s3">))</span>
<a name="l1467"><span class="ln">1467 </span></a>
<a name="l1468"><span class="ln">1468 </span></a>    <span class="s1"># In the final frame, fix label positions to prevent overlap</span>
<a name="l1469"><span class="ln">1469 </span></a>    <span class="s2">if </span><span class="s0">frame </span><span class="s3">== </span><span class="s0">len</span><span class="s3">(</span><span class="s0">years</span><span class="s3">) - </span><span class="s5">1</span><span class="s3">:</span>
<a name="l1470"><span class="ln">1470 </span></a>        <span class="s0">ordenadas </span><span class="s3">= </span><span class="s0">ordenar_etiquetas</span><span class="s3">(</span><span class="s0">posiciones</span><span class="s3">)</span>
<a name="l1471"><span class="ln">1471 </span></a>        <span class="s2">for </span><span class="s0">country</span><span class="s3">, (</span><span class="s0">x</span><span class="s3">, </span><span class="s0">y</span><span class="s3">) </span><span class="s2">in </span><span class="s0">ordenadas</span><span class="s3">.</span><span class="s0">items</span><span class="s3">():</span>
<a name="l1472"><span class="ln">1472 </span></a>            <span class="s0">labels</span><span class="s3">[</span><span class="s0">country</span><span class="s3">].</span><span class="s0">set_position</span><span class="s3">((</span><span class="s0">x</span><span class="s3">, </span><span class="s0">y</span><span class="s3">))</span>
<a name="l1473"><span class="ln">1473 </span></a>            <span class="s0">labels</span><span class="s3">[</span><span class="s0">country</span><span class="s3">].</span><span class="s0">set_text</span><span class="s3">(</span><span class="s0">country</span><span class="s3">)</span>
<a name="l1474"><span class="ln">1474 </span></a>    <span class="s2">else</span><span class="s3">:</span>
<a name="l1475"><span class="ln">1475 </span></a>        <span class="s2">for </span><span class="s3">(</span><span class="s0">x</span><span class="s3">, </span><span class="s0">y</span><span class="s3">, </span><span class="s0">country</span><span class="s3">) </span><span class="s2">in </span><span class="s0">posiciones</span><span class="s3">:</span>
<a name="l1476"><span class="ln">1476 </span></a>            <span class="s0">labels</span><span class="s3">[</span><span class="s0">country</span><span class="s3">].</span><span class="s0">set_position</span><span class="s3">((</span><span class="s0">x</span><span class="s3">, </span><span class="s0">y</span><span class="s3">))</span>
<a name="l1477"><span class="ln">1477 </span></a>            <span class="s0">labels</span><span class="s3">[</span><span class="s0">country</span><span class="s3">].</span><span class="s0">set_text</span><span class="s3">(</span><span class="s0">country</span><span class="s3">)</span>
<a name="l1478"><span class="ln">1478 </span></a>
<a name="l1479"><span class="ln">1479 </span></a>    <span class="s2">return </span><span class="s0">list</span><span class="s3">(</span><span class="s0">lines</span><span class="s3">.</span><span class="s0">values</span><span class="s3">()) + </span><span class="s0">list</span><span class="s3">(</span><span class="s0">labels</span><span class="s3">.</span><span class="s0">values</span><span class="s3">())</span>
<a name="l1480"><span class="ln">1480 </span></a>
<a name="l1481"><span class="ln">1481 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1482"><span class="ln">1482 </span></a><span class="s1"># Generate the animation</span>
<a name="l1483"><span class="ln">1483 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1484"><span class="ln">1484 </span></a><span class="s1"># Each frame corresponds to a year from the dataset.</span>
<a name="l1485"><span class="ln">1485 </span></a><span class="s0">ani </span><span class="s3">= </span><span class="s0">animation</span><span class="s3">.</span><span class="s0">FuncAnimation</span><span class="s3">(</span>
<a name="l1486"><span class="ln">1486 </span></a>    <span class="s0">fig</span><span class="s3">,</span>
<a name="l1487"><span class="ln">1487 </span></a>    <span class="s0">update</span><span class="s3">,</span>
<a name="l1488"><span class="ln">1488 </span></a>    <span class="s0">frames</span><span class="s3">=</span><span class="s0">len</span><span class="s3">(</span><span class="s0">years</span><span class="s3">),</span>
<a name="l1489"><span class="ln">1489 </span></a>    <span class="s0">interval</span><span class="s3">=</span><span class="s5">120</span><span class="s3">,  </span><span class="s1"># milliseconds between frames</span>
<a name="l1490"><span class="ln">1490 </span></a>    <span class="s0">repeat</span><span class="s3">=</span><span class="s2">True</span>
<a name="l1491"><span class="ln">1491 </span></a><span class="s3">)</span>
<a name="l1492"><span class="ln">1492 </span></a>
<a name="l1493"><span class="ln">1493 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1494"><span class="ln">1494 </span></a><span class="s1"># Export animation as GIF</span>
<a name="l1495"><span class="ln">1495 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1496"><span class="ln">1496 </span></a><span class="s0">ani</span><span class="s3">.</span><span class="s0">save</span><span class="s3">(</span><span class="s4">&quot;../Graphs/CO2_TopEmitters_Colombia.gif&quot;</span><span class="s3">, </span><span class="s0">writer</span><span class="s3">=</span><span class="s4">&quot;pillow&quot;</span><span class="s3">, </span><span class="s0">fps</span><span class="s3">=</span><span class="s5">7</span><span class="s3">)</span>
<a name="l1497"><span class="ln">1497 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">show</span><span class="s3">()</span>
<a name="l1498"><span class="ln">1498 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1499"><span class="ln">1499 </span></a><span class="s1"># Save final static image</span>
<a name="l1500"><span class="ln">1500 </span></a><span class="s1"># --------------------------------------------------------------</span>
<a name="l1501"><span class="ln">1501 </span></a><span class="s1"># Capture the last frame (latest year) for a publication-quality figure.</span>
<a name="l1502"><span class="ln">1502 </span></a><span class="s0">update</span><span class="s3">(</span><span class="s0">len</span><span class="s3">(</span><span class="s0">years</span><span class="s3">) - </span><span class="s5">1</span><span class="s3">)</span>
<a name="l1503"><span class="ln">1503 </span></a><span class="s0">plt</span><span class="s3">.</span><span class="s0">savefig</span><span class="s3">(</span><span class="s4">&quot;../Graphs/CO2_TopEmitters_Colombia_Final.jpg&quot;</span><span class="s3">, </span><span class="s0">dpi</span><span class="s3">=</span><span class="s5">400</span><span class="s3">, </span><span class="s0">bbox_inches</span><span class="s3">=</span><span class="s4">&quot;tight&quot;</span><span class="s3">)</span>
<a name="l1504"><span class="ln">1504 </span></a>
<a name="l1505"><span class="ln">1505 </span></a>
<a name="l1506"><span class="ln">1506 </span></a><hr class="ls0"><a name="l1507"><span class="ln">1507 </span></a><span class="s0">#%% md 
<a name="l1508"><span class="ln">1508 </span></a>El análisis histórico de las emisiones de CO₂ y el uso de Colombia como control en este estudio permite observar la evolución de las emisiones no solo a nivel global, sino también en un contexto nacional. Mientras Colombia comienza con emisiones relativamente bajas en 1970, los datos actuales muestran un aumento proporcional a su crecimiento industrial y económico. Sin embargo, la comparación con los grandes emisores, como China y Estados Unidos, muestra que el país sigue teniendo una huella de carbono considerablemente más baja en relación con estos. Esta comparación subraya la necesidad de estrategias diferenciadas para países en vías de desarrollo, como Colombia, que enfrentan el reto de mejorar su economía sin comprometer el medio ambiente.</span></pre>
</body>
</html>